---
title: Erstellen von Schattenkopien von Assemblys
ms.date: 03/30/2017
helpviewer_keywords:
- assemblies [.NET Framework], shadow copying
- application domains, shadow copying assemblies
- shadow copying assemblies
ms.assetid: de8b8759-fca7-4260-896b-5a4973157672
ms.openlocfilehash: 9fc8a4aeeeca40f71ed9114a9db40b9a56e5fe6b
ms.sourcegitcommit: 81ad1f09b93f3b3e6706a7f2e4ddf50ef229ea3d
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 11/20/2019
ms.locfileid: "74204573"
---
# <a name="shadow-copying-assemblies"></a><span data-ttu-id="1f11f-102">Erstellen von Schattenkopien von Assemblys</span><span class="sxs-lookup"><span data-stu-id="1f11f-102">Shadow Copying Assemblies</span></span>

<span data-ttu-id="1f11f-103">Schattenkopien sorgen dafür, dass Assemblys, die in einer Anwendungsdomäne verwendet werden, aktualisiert werden können, ohne die Anwendungsdomäne zu entladen.</span><span class="sxs-lookup"><span data-stu-id="1f11f-103">Shadow copying enables assemblies that are used in an application domain to be updated without unloading the application domain.</span></span> <span data-ttu-id="1f11f-104">Dies ist besonders hilfreich für Anwendungen, die permanent verfügbar sein müssen, wie ASP.NET-Websites.</span><span class="sxs-lookup"><span data-stu-id="1f11f-104">This is particularly useful for applications that must be available continuously, such as ASP.NET sites.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="1f11f-105">Schattenkopien werden in Windows 8.x-Store-Apps nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="1f11f-105">Shadow copying is not supported in Windows 8.x Store apps.</span></span>

<span data-ttu-id="1f11f-106">Die Common Language Runtime sperrt eine Assemblydatei, wenn die Assembly geladen ist, daher kann die Datei erst aktualisiert werden, wenn die Assembly entladen wurde.</span><span class="sxs-lookup"><span data-stu-id="1f11f-106">The common language runtime locks an assembly file when the assembly is loaded, so the file cannot be updated until the assembly is unloaded.</span></span> <span data-ttu-id="1f11f-107">Die einzige Möglichkeit zum Entladen einer Assembly aus einer Anwendungsdomäne besteht darin, die Anwendungsdomäne zu entladen, sodass eine Assembly unter normalen Umständen erst auf dem Datenträger aktualisiert werden kann, wenn alle Anwendungsdomänen, in der sie genutzt wird, entladen wurden.</span><span class="sxs-lookup"><span data-stu-id="1f11f-107">The only way to unload an assembly from an application domain is by unloading the application domain, so under normal circumstances, an assembly cannot be updated on disk until all the application domains that are using it have been unloaded.</span></span>

<span data-ttu-id="1f11f-108">Wenn eine Anwendungdomäne für die Erstellung von Schattenkopien von Dateien konfiguriert ist, werden Assemblys aus dem Anwendungspfad an einen anderen Speicherort kopiert und von dort aus geladen.</span><span class="sxs-lookup"><span data-stu-id="1f11f-108">When an application domain is configured to shadow copy files, assemblies from the application path are copied to another location and loaded from that location.</span></span> <span data-ttu-id="1f11f-109">Die Kopie wird gesperrt, aber die ursprüngliche Assemblydatei wird entsperrt und kann aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="1f11f-109">The copy is locked, but the original assembly file is unlocked and can be updated.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="1f11f-110">Die einzigen Assemblys, von denen Schattenkopien erstellt werden können, sind diejenigen, die im Anwendungsverzeichnis oder dessen Unterverzeichnissen gespeichert sind, die bei der Konfiguration der Anwendungsdomäne von den Eigenschaften <xref:System.AppDomainSetup.ApplicationBase%2A> und <xref:System.AppDomainSetup.PrivateBinPath%2A> festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="1f11f-110">The only assemblies that can be shadow copied are those stored in the application directory or its subdirectories, specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties when the application domain is configured.</span></span> <span data-ttu-id="1f11f-111">Von Assemblys, die im globalen Assemblycache gespeichert sind, werden keine Schattenkopien erstellt.</span><span class="sxs-lookup"><span data-stu-id="1f11f-111">Assemblies stored in the global assembly cache are not shadow copied.</span></span>

<span data-ttu-id="1f11f-112">Dieser Artikel enthält folgende Abschnitte:</span><span class="sxs-lookup"><span data-stu-id="1f11f-112">This article contains the following sections:</span></span>

- <span data-ttu-id="1f11f-113">[Aktivieren und Verwenden der Schattenkopiefunktion](#EnablingAndUsing) beschreibt die grundlegende Verwendung sowie die Optionen in Verbindung mit Schattenkopien.</span><span class="sxs-lookup"><span data-stu-id="1f11f-113">[Enabling and Using Shadow Copying](#EnablingAndUsing) describes the basic use and the options that are available for shadow copying.</span></span>

- <span data-ttu-id="1f11f-114">[Startleistung](#StartupPerformance) beschreibt die Änderungen, die an der Schattenkopiefunktion in .NET Framework 4 vorgenommen werden, um die Startleistung zu verbessern. Außerdem wird erläutert, wie das Verhalten vorheriger Versionen wiederhergestellt werden kann.</span><span class="sxs-lookup"><span data-stu-id="1f11f-114">[Startup Performance](#StartupPerformance) describes the changes that are made to shadow copying in the .NET Framework 4 to improve startup performance, and how to revert to the behavior of earlier versions.</span></span>

- <span data-ttu-id="1f11f-115">[Veraltete Methoden](#ObsoleteMethods) beschreibt die Änderungen, die an den Eigenschaften und Methoden vorgenommen wurden, die die Schattenkopiefunktion in .NET Framework 2.0 steuern.</span><span class="sxs-lookup"><span data-stu-id="1f11f-115">[Obsolete Methods](#ObsoleteMethods) describes the changes that were made to the properties and methods that control shadow copying in the .NET Framework 2.0.</span></span>

<a name="EnablingAndUsing"></a>

## <a name="enabling-and-using-shadow-copying"></a><span data-ttu-id="1f11f-116">Aktivieren und Verwenden der Schattenkopiefunktion</span><span class="sxs-lookup"><span data-stu-id="1f11f-116">Enabling and Using Shadow Copying</span></span>

<span data-ttu-id="1f11f-117">Sie können die Eigenschaften der <xref:System.AppDomainSetup>-Klasse wie folgt verwenden, um eine Anwendungsdomäne für Schattenkopien zu konfigurieren:</span><span class="sxs-lookup"><span data-stu-id="1f11f-117">You can use the properties of the <xref:System.AppDomainSetup> class as follows to configure an application domain for shadow copying:</span></span>

- <span data-ttu-id="1f11f-118">Aktivieren Sie die Schattenkopiefunktion, indem Sie die <xref:System.AppDomainSetup.ShadowCopyFiles%2A>-Eigenschaft auf den Zeichenfolgenwert `"true"` festlegen.</span><span class="sxs-lookup"><span data-stu-id="1f11f-118">Enable shadow copying by setting the <xref:System.AppDomainSetup.ShadowCopyFiles%2A> property to the string value `"true"`.</span></span>

  <span data-ttu-id="1f11f-119">Standardmäßig bewirkt diese Einstellung, dass alle Assemblys im Anwendungspfad in einen Downloadcache kopiert werden, bevor sie geladen werden.</span><span class="sxs-lookup"><span data-stu-id="1f11f-119">By default, this setting causes all assemblies in the application path to be copied to a download cache before they are loaded.</span></span> <span data-ttu-id="1f11f-120">Dies ist der gleiche Cache, der von der Common Language Runtime zum Speichern von Dateien verwendet wird, die von anderen Computern heruntergeladen wurden, und die Common Language Runtime löscht diese Dateien automatisch, wenn sie nicht mehr benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="1f11f-120">This is the same cache maintained by the common language runtime to store files downloaded from other computers, and the common language runtime automatically deletes the files when they are no longer needed.</span></span>

- <span data-ttu-id="1f11f-121">Legen Sie optional einen benutzerdefinierten Speicherort für die Schattenkopien von Dateien fest, indem Sie die Eigenschaften <xref:System.AppDomainSetup.CachePath%2A> und <xref:System.AppDomainSetup.ApplicationName%2A> verwenden.</span><span class="sxs-lookup"><span data-stu-id="1f11f-121">Optionally set a custom location for shadow copied files by using the <xref:System.AppDomainSetup.CachePath%2A> property and the <xref:System.AppDomainSetup.ApplicationName%2A> property.</span></span>

  <span data-ttu-id="1f11f-122">Der Basispfad für den Speicherort wird gebildet, indem die Eigenschaft <xref:System.AppDomainSetup.ApplicationName%2A> mit der Eigenschaft <xref:System.AppDomainSetup.CachePath%2A> als Unterverzeichnis verkettet wird.</span><span class="sxs-lookup"><span data-stu-id="1f11f-122">The base path for the location is formed by concatenating the <xref:System.AppDomainSetup.ApplicationName%2A> property to the <xref:System.AppDomainSetup.CachePath%2A> property as a subdirectory.</span></span> <span data-ttu-id="1f11f-123">Schattenkopien von Assemblys werden in die Unterverzeichnisse dieses Pfades gesetzt und nicht in den Basispfad selbst.</span><span class="sxs-lookup"><span data-stu-id="1f11f-123">Assemblies are shadow copied to subdirectories of this path, not to the base path itself.</span></span>

  > [!NOTE]
  > <span data-ttu-id="1f11f-124">Wenn die <xref:System.AppDomainSetup.ApplicationName%2A>-Eigenschaft nicht festgelegt wird, wird die <xref:System.AppDomainSetup.CachePath%2A>-Eigenschaft ignoriert und der Downloadcache wird verwendet.</span><span class="sxs-lookup"><span data-stu-id="1f11f-124">If the <xref:System.AppDomainSetup.ApplicationName%2A> property is not set, the <xref:System.AppDomainSetup.CachePath%2A> property is ignored and the download cache is used.</span></span> <span data-ttu-id="1f11f-125">Es werden keine Ausnahmen ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="1f11f-125">No exception is thrown.</span></span>

  <span data-ttu-id="1f11f-126">Wenn Sie einen benutzerdefinierten Speicherort festlegen, sind Sie selbst für die Bereinigung der Verzeichnisse und das Löschen der kopierten Dateien zuständig, wenn diese nicht mehr benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="1f11f-126">If you specify a custom location, you are responsible for cleaning up the directories and copied files when they are no longer needed.</span></span> <span data-ttu-id="1f11f-127">Sie werden nicht automatisch gelöscht.</span><span class="sxs-lookup"><span data-stu-id="1f11f-127">They are not deleted automatically.</span></span>

  <span data-ttu-id="1f11f-128">Es gibt einige Gründe, warum Sie ggf. einen benutzerdefinierten Speicherort für Schattenkopien von Dateien anlegen sollten.</span><span class="sxs-lookup"><span data-stu-id="1f11f-128">There are a few reasons why you might want to set a custom location for shadow copied files.</span></span> <span data-ttu-id="1f11f-129">Möglicherweise möchten Sie einen benutzerdefinierten Speicherort für Schattenkopien von Dateien anlegen, wenn Ihre Anwendung eine große Anzahl Kopien erstellt.</span><span class="sxs-lookup"><span data-stu-id="1f11f-129">You might want to set a custom location for shadow copied files if your application generates a large number of copies.</span></span> <span data-ttu-id="1f11f-130">Der Downloadcache ist in der Größe und nicht in der Lebensdauer begrenzt, daher ist es möglich, dass die Common Language Runtime versucht, eine Datei zu löschen, die noch verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="1f11f-130">The download cache is limited by size, not by lifetime, so it is possible that the common language runtime will attempt to delete a file that is still in use.</span></span> <span data-ttu-id="1f11f-131">Ein weiterer Grund für das Einrichten eines benutzerdefinierten Speicherorts ist folgender: Wenn Benutzer, die Ihre Anwendung ausführen, keinen Schreibzugriff auf den Verzeichnisspeicherort haben, den die Common Language Runtime als Downloadcache verwendet.</span><span class="sxs-lookup"><span data-stu-id="1f11f-131">Another reason to set a custom location is when users running your application do not have write access to the directory location the common language runtime uses for the download cache.</span></span>

- <span data-ttu-id="1f11f-132">Begrenzen Sie optional die Assemblys, von denen Schattenkopien erstellt werden, indem Sie die <xref:System.AppDomainSetup.ShadowCopyDirectories%2A>-Eigenschaft verwenden.</span><span class="sxs-lookup"><span data-stu-id="1f11f-132">Optionally limit the assemblies that are shadow copied by using the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property.</span></span>

  <span data-ttu-id="1f11f-133">Wenn Sie die Schattenkopiefunktion für eine Anwendungsdomäne aktivieren, werden standardmäßig alle Assemblys im Anwendungspfad kopiert, d. h. in den Verzeichnissen, die von den Eigenschaften <xref:System.AppDomainSetup.ApplicationBase%2A> und <xref:System.AppDomainSetup.PrivateBinPath%2A> festgelegt wurden.</span><span class="sxs-lookup"><span data-stu-id="1f11f-133">When you enable shadow copying for an application domain, the default is to copy all assemblies in the application path — that is, in the directories specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties.</span></span> <span data-ttu-id="1f11f-134">Sie können den Kopiervorgang auf ausgewählte Verzeichnisse beschränken, indem Sie eine Zeichenfolge erstellen, der nur die Verzeichnisse enthält, in denen Schattenkopien erstellt werden sollen. Weisen Sie die Zeichenfolge dann der <xref:System.AppDomainSetup.ShadowCopyDirectories%2A>-Eigenschaft zu.</span><span class="sxs-lookup"><span data-stu-id="1f11f-134">You can limit the copying to selected directories by creating a string that contains only those directories you want to shadow copy, and assigning the string to the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property.</span></span> <span data-ttu-id="1f11f-135">Trennen Sie die Verzeichnisse mit Semikolons.</span><span class="sxs-lookup"><span data-stu-id="1f11f-135">Separate the directories with semicolons.</span></span> <span data-ttu-id="1f11f-136">Die einzigen Assemblys, von denen Schattenkopien erstellt werden, sind nun die in den ausgewählten Verzeichnissen.</span><span class="sxs-lookup"><span data-stu-id="1f11f-136">The only assemblies that are shadow copied are the ones in the selected directories.</span></span>

  > [!NOTE]
  > <span data-ttu-id="1f11f-137">Wenn Sie der <xref:System.AppDomainSetup.ShadowCopyDirectories%2A>-Eigenschaft keine Zeichenfolge zuweisen oder wenn Sie diese Eigenschaft nicht auf `null` festlegen, werden von allen Assemblys in den Verzeichnissen, die mit den Eigenschaften <xref:System.AppDomainSetup.ApplicationBase%2A> und <xref:System.AppDomainSetup.PrivateBinPath%2A> angegeben werden, Schattenkopien erstellt.</span><span class="sxs-lookup"><span data-stu-id="1f11f-137">If you don’t assign a string to the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property, or if you set this property to `null`, all assemblies in the directories specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties are shadow copied.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="1f11f-138">Verzeichnispfade dürfen keine Semikolons enthalten, da das Semikolon das Trennzeichen ist.</span><span class="sxs-lookup"><span data-stu-id="1f11f-138">Directory paths must not contain semicolons, because the semicolon is the delimiter character.</span></span> <span data-ttu-id="1f11f-139">Es gibt kein Escapezeichen für Semikolons.</span><span class="sxs-lookup"><span data-stu-id="1f11f-139">There is no escape character for semicolons.</span></span>

<a name="StartupPerformance"></a>

## <a name="startup-performance"></a><span data-ttu-id="1f11f-140">Startleistung</span><span class="sxs-lookup"><span data-stu-id="1f11f-140">Startup Performance</span></span>

<span data-ttu-id="1f11f-141">Wenn eine Anwendungsdomäne, in der die Schattenkopiefunktion verwendet wird, gestartet wird, kommt es zu einer Verzögerung, während die Assemblys im Anwendungsverzeichnis in das Verzeichnis für Schattenkopien kopiert oder während überprüft wird, ob sie sich bereits an diesem Speicherort befinden.</span><span class="sxs-lookup"><span data-stu-id="1f11f-141">When an application domain that uses shadow copying starts, there is a delay while assemblies in the application directory are copied to the shadow copy directory, or verified if they are already in that location.</span></span> <span data-ttu-id="1f11f-142">Vor .NET Framework 4.0 wurden alle Assemblys in ein temporäres Verzeichnis kopiert.</span><span class="sxs-lookup"><span data-stu-id="1f11f-142">Before the .NET Framework 4, all assemblies were copied to a temporary directory.</span></span> <span data-ttu-id="1f11f-143">Jede Assembly wurde geöffnet, um den Assemblynamen zu überprüfen, und der starke Name wurde validiert.</span><span class="sxs-lookup"><span data-stu-id="1f11f-143">Each assembly was opened to verify the assembly name, and the strong name was validated.</span></span> <span data-ttu-id="1f11f-144">Jede Assembly wurde überprüft, um zu sehen, ob sie aktueller als die Kopie im Schattenkopieverzeichnis ist.</span><span class="sxs-lookup"><span data-stu-id="1f11f-144">Each assembly was checked to see whether it had been updated more recently than the copy in the shadow copy directory.</span></span> <span data-ttu-id="1f11f-145">Falls ja, wurde sie in das Schattenkopieverzeichnis kopiert.</span><span class="sxs-lookup"><span data-stu-id="1f11f-145">If so, it was copied to the shadow copy directory.</span></span> <span data-ttu-id="1f11f-146">Abschließend wurden die temporären Kopien verworfen.</span><span class="sxs-lookup"><span data-stu-id="1f11f-146">Finally, the temporary copies were discarded.</span></span>

<span data-ttu-id="1f11f-147">Ab .NET Framework 4 besteht das standardmäßige Startverhalten darin, Datum und Uhrzeit jeder Assembly im Anwendungsverzeichnis direkt mit dem Datum und der Uhrzeit der Kopie im Schattenkopieverzeichnis zu vergleichen.</span><span class="sxs-lookup"><span data-stu-id="1f11f-147">Beginning with the .NET Framework 4, the default startup behavior is to directly compare the file date and time of each assembly in the application directory with the file date and time of the copy in the shadow copy directory.</span></span> <span data-ttu-id="1f11f-148">Wenn die Assembly aktualisiert wurde, wird sie mit der gleichen Prozedur wie in älteren Versionen von .NET Framework kopiert; andernfalls wird die Schattenkopie im Schattenkopieverzeichnis geladen.</span><span class="sxs-lookup"><span data-stu-id="1f11f-148">If the assembly has been updated, it is copied by using the same procedure as in earlier versions of the .NET Framework; otherwise, the copy in the shadow copy directory is loaded.</span></span>

<span data-ttu-id="1f11f-149">Die sich hieraus ergebende Leistungsverbesserung ist enorm für Anwendungen, in denen Assemblys nicht häufig geändert werden und Änderungen in der Regel nur an einer kleinen Teilmenge von Assemblys vorgenommen werden.</span><span class="sxs-lookup"><span data-stu-id="1f11f-149">The resulting performance improvement is largest for applications in which assemblies do not change frequently and changes usually occur in a small subset of assemblies.</span></span> <span data-ttu-id="1f11f-150">Wenn ein Großteil der Assemblys in einer Anwendung häufig geändert wird, kann das neue Standardverhalten zu einem Leistungsverlust führen.</span><span class="sxs-lookup"><span data-stu-id="1f11f-150">If a majority of assemblies in an application change frequently, the new default behavior might cause a performance regression.</span></span> <span data-ttu-id="1f11f-151">Sie können das Startverhalten vorheriger Versionen von .NET Framework wiederherstellen, indem Sie das [\<<shadowCopyVerifyByTimestamp>-Element](../configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md) mit `enabled="false"` zur Konfigurationsdatei hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="1f11f-151">You can restore the startup behavior of previous versions of the .NET Framework by adding the [\<shadowCopyVerifyByTimestamp> element](../configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md) to the configuration file, with `enabled="false"`.</span></span>

<a name="ObsoleteMethods"></a>

## <a name="obsolete-methods"></a><span data-ttu-id="1f11f-152">Veraltete Methoden</span><span class="sxs-lookup"><span data-stu-id="1f11f-152">Obsolete Methods</span></span>

<span data-ttu-id="1f11f-153">Die <xref:System.AppDomain>-Klasse verfügt über mehrere Methoden, wie <xref:System.AppDomain.SetShadowCopyFiles%2A> und <xref:System.AppDomain.ClearShadowCopyPath%2A>, die verwendet werden können, um die Erstellung von Schattenkopien in einer Anwendungsdomäne zu steuern, diese wurde in .NET Framework 2.0 jedoch als veraltet deklariert.</span><span class="sxs-lookup"><span data-stu-id="1f11f-153">The <xref:System.AppDomain> class has several methods, such as <xref:System.AppDomain.SetShadowCopyFiles%2A> and <xref:System.AppDomain.ClearShadowCopyPath%2A>, that can be used to control shadow copying on an application domain, but these have been marked obsolete in the .NET Framework version 2.0.</span></span> <span data-ttu-id="1f11f-154">Die empfohlenen Methode zum Konfigurieren einer Anwendungsdomäne für die Schattenkopiefunktion besteht drin, die Eigenschaften der <xref:System.AppDomainSetup>-Klasse zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="1f11f-154">The recommended way to configure an application domain for shadow copying is to use the properties of the <xref:System.AppDomainSetup> class.</span></span>

## <a name="see-also"></a><span data-ttu-id="1f11f-155">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="1f11f-155">See also</span></span>

- <xref:System.AppDomainSetup.ShadowCopyFiles%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.CachePath%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.ApplicationName%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.ShadowCopyDirectories%2A?displayProperty=nameWithType>
- [<span data-ttu-id="1f11f-156">\<shadowCopyVerifyByTimestamp>-Element</span><span class="sxs-lookup"><span data-stu-id="1f11f-156">\<shadowCopyVerifyByTimestamp> Element</span></span>](../configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md)
