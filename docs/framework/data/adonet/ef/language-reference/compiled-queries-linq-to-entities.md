---
title: Kompilierte Abfragen (LINQ to Entities)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 8025ba1d-29c7-4407-841b-d5a3bed40b7a
ms.openlocfilehash: d4101eae755ac698d4cef5b2e1334d01e02c3e35
ms.sourcegitcommit: 957c49696eaf048c284ef8f9f8ffeb562357ad95
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 05/07/2020
ms.locfileid: "82895422"
---
# <a name="compiled-queries--linq-to-entities"></a><span data-ttu-id="7ccc6-102">Kompilierte Abfragen (LINQ to Entities)</span><span class="sxs-lookup"><span data-stu-id="7ccc6-102">Compiled Queries  (LINQ to Entities)</span></span>
<span data-ttu-id="7ccc6-103">Wenn eine Anwendung im Entity Framework häufig strukturell ähnliche Abfragen ausführt, kann in vielen Fällen die Leistung gesteigert werden, indem die Abfrage einmal kompiliert und anschließend mehrmals mit verschiedenen Parametern ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-103">When you have an application that executes structurally similar queries many times in the Entity Framework, you can frequently increase performance by compiling the query one time and executing it several times with different parameters.</span></span> <span data-ttu-id="7ccc6-104">So können beispielsweise mithilfe einer Anwendung alle Kunden in einer bestimmten Stadt abgerufen werden, wobei die Stadt zur Laufzeit vom Benutzer in einem Formular festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-104">For example, an application might have to retrieve all the customers in a particular city; the city is specified at runtime by the user in a form.</span></span> <span data-ttu-id="7ccc6-105">Für derartige Aufgaben unterstützt LINQ to Entities die Verwendung kompilierter Abfragen.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-105">LINQ to Entities supports using compiled queries for this purpose.</span></span>  
  
 <span data-ttu-id="7ccc6-106">Ab .NET Framework 4.5 werden LINQ-Abfragen automatisch zwischengespeichert.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-106">Starting with the .NET Framework 4.5, LINQ queries are cached automatically.</span></span> <span data-ttu-id="7ccc6-107">Sie können jedoch weiterhin kompilierte LINQ-Abfragen verwenden, um diesen Aufwand in späteren Ausführungen zu reduzieren. Kompilierte Abfragen können effizienter als LINQ-Abfragen sein, die automatisch zwischengespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-107">However, you can still use compiled LINQ queries to reduce this cost in later executions and compiled queries can be more efficient than LINQ queries that are automatically cached.</span></span> <span data-ttu-id="7ccc6-108">Beachten Sie, dass LINQ to Entities-Abfragen, die den `Enumerable.Contains`-Operator auf Auflistungen im Arbeitsspeicher anwenden, nicht automatisch zwischengespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-108">Note that LINQ to Entities queries that apply the `Enumerable.Contains` operator to in-memory collections are not automatically cached.</span></span> <span data-ttu-id="7ccc6-109">Darüber hinaus ist das Parametrisieren von Auflistungen im Arbeitsspeicher in kompilierten LINQ-Abfragen nicht zulässig.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-109">Also parameterizing in-memory collections in compiled LINQ queries is not allowed.</span></span>  
  
 <span data-ttu-id="7ccc6-110">Die <xref:System.Data.Objects.CompiledQuery>-Klasse ermöglicht das Kompilieren und Zwischenspeichern von Abfragen zur Wiederverwendung.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-110">The <xref:System.Data.Objects.CompiledQuery> class provides compilation and caching of queries for reuse.</span></span> <span data-ttu-id="7ccc6-111">Diese Klasse enthält eine <xref:System.Data.Objects.CompiledQuery>-Methode einer `Compile` mit mehreren Überladungen.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-111">Conceptually, this class contains a <xref:System.Data.Objects.CompiledQuery>'s `Compile` method with several overloads.</span></span> <span data-ttu-id="7ccc6-112">Rufen Sie die `Compile`-Methode auf, um einen neuen Delegaten für die Darstellung der kompilierten Abfrage zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-112">Call the `Compile` method to create a new delegate to represent the compiled query.</span></span> <span data-ttu-id="7ccc6-113">Die mit einem `Compile` und Parameterwerten ausgestatteten <xref:System.Data.Objects.ObjectContext>-Methoden geben einen Delegat zurück, der ein Ergebnis ausgibt (z. B. eine <xref:System.Linq.IQueryable%601>-Instanz).</span><span class="sxs-lookup"><span data-stu-id="7ccc6-113">The `Compile` methods, provided with a <xref:System.Data.Objects.ObjectContext> and parameter values, return a delegate that produces some result (such as an <xref:System.Linq.IQueryable%601> instance).</span></span> <span data-ttu-id="7ccc6-114">Die Abfrage wird nur einmal während der ersten Ausführung kompiliert.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-114">The query compiles once during only the first execution.</span></span> <span data-ttu-id="7ccc6-115">Die für die Abfrage zur Kompilierungszeit festgelegten Mergeoptionen können später nicht geändert werden.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-115">The merge options set for the query at the time of the compilation cannot be changed later.</span></span> <span data-ttu-id="7ccc6-116">Nachdem die Abfrage kompiliert ist, können Sie nur Parameter mit einem primitiven Typ angeben. Sie können keine Teile der Abfrage ersetzen, die das generierte SQL ändern.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-116">Once the query is compiled you can only supply parameters of primitive type but you cannot replace parts of the query that would change the generated SQL.</span></span> <span data-ttu-id="7ccc6-117">Weitere Informationen finden Sie unter [EF-mergeoptionen und kompilierte Abfragen](https://docs.microsoft.com/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries).</span><span class="sxs-lookup"><span data-stu-id="7ccc6-117">For more information, see [EF Merge Options and Compiled Queries](https://docs.microsoft.com/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries).</span></span>
  
 <span data-ttu-id="7ccc6-118">Der LINQ to Entities Abfrage Ausdruck, der <xref:System.Data.Objects.CompiledQuery>von `Compile` der-Methode der-Methode kompiliert wird, wird `Func` durch einen der generischen Delegaten wie dargestellt <xref:System.Func%605>.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-118">The LINQ to Entities query expression that the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method compiles is represented by one of the generic `Func` delegates, such as <xref:System.Func%605>.</span></span> <span data-ttu-id="7ccc6-119">Der Abfrageausdruck kann höchstens einen `ObjectContext`-Parameter, einen Rückgabeparameter und 16 Abfrageparameter kapseln.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-119">At most, the query expression can encapsulate an `ObjectContext` parameter, a return parameter, and 16 query parameters.</span></span> <span data-ttu-id="7ccc6-120">Sind mehr als 16 Abfrageparameter erforderlich, können Sie eine Struktur erstellen, deren Eigenschaften Abfrageparameter darstellen.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-120">If more than 16 query parameters are required, you can create a structure whose properties represent query parameters.</span></span> <span data-ttu-id="7ccc6-121">Sie können anschließend die Eigenschaften für die Struktur im Abfrageausdruck verwenden, nachdem die Eigenschaften festgelegt wurden.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-121">You can then use the properties on the structure in the query expression after you set the properties.</span></span>  
  
## <a name="example-1"></a><span data-ttu-id="7ccc6-122">Beispiel 1</span><span class="sxs-lookup"><span data-stu-id="7ccc6-122">Example 1</span></span>  
 <span data-ttu-id="7ccc6-123">Im folgenden Beispiel wird eine Abfrage kompiliert und anschließend aufgerufen, die einen <xref:System.Decimal>-Eingabeparameter akzeptiert und eine Auftragssequenz zurückgibt, in der der fällige Gesamtbetrag 200,00 US-Dollar oder mehr beträgt:</span><span class="sxs-lookup"><span data-stu-id="7ccc6-123">The following example compiles and then invokes a query that accepts a <xref:System.Decimal> input parameter and returns a sequence of orders where the total due is greater than or equal to $200.00:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#CompiledQuery2](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery2)]
 [!code-vb[DP L2E Conceptual Examples#CompiledQuery2](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery2)]  
  
## <a name="example-2"></a><span data-ttu-id="7ccc6-124">Beispiel 2</span><span class="sxs-lookup"><span data-stu-id="7ccc6-124">Example 2</span></span>  
 <span data-ttu-id="7ccc6-125">Im folgenden Beispiel wird eine Abfrage kompiliert und anschließend aufgerufen, die eine <xref:System.Data.Objects.ObjectQuery%601>-Instanz zurückgibt:</span><span class="sxs-lookup"><span data-stu-id="7ccc6-125">The following example compiles and then invokes a query that returns an <xref:System.Data.Objects.ObjectQuery%601> instance:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#CompiledQuery1_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery1_mq)]
 [!code-vb[DP L2E Conceptual Examples#CompiledQuery1_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery1_mq)]  
  
## <a name="example-3"></a><span data-ttu-id="7ccc6-126">Beispiel 3</span><span class="sxs-lookup"><span data-stu-id="7ccc6-126">Example 3</span></span>  
 <span data-ttu-id="7ccc6-127">Im folgenden Beispiel wird eine Abfrage kompiliert und anschließend aufgerufen, die den Durchschnitt der Produktlistenpreise als <xref:System.Decimal>-Wert zurückgibt:</span><span class="sxs-lookup"><span data-stu-id="7ccc6-127">The following example compiles and then invokes a query that returns the average of the product list prices as a <xref:System.Decimal> value:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#CompiledQuery3_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery3_mq)]
 [!code-vb[DP L2E Conceptual Examples#CompiledQuery3_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery3_mq)]  
  
## <a name="example-4"></a><span data-ttu-id="7ccc6-128">Beispiel 4</span><span class="sxs-lookup"><span data-stu-id="7ccc6-128">Example 4</span></span>  
 <span data-ttu-id="7ccc6-129">Im folgenden Beispiel wird eine Abfrage kompiliert und anschließend aufgerufen, die einen <xref:System.String> Eingabeparameter akzeptiert. Anschließend wird `Contact` ein-Wert zurückgegeben, dessen e-Mail-Adresse mit der angegebenen Zeichenfolge beginnt:</span><span class="sxs-lookup"><span data-stu-id="7ccc6-129">The following example compiles and then invokes a query that accepts a <xref:System.String> input parameter and then returns a `Contact` whose email address starts with the specified string:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#CompiledQuery4_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery4_mq)]
 [!code-vb[DP L2E Conceptual Examples#CompiledQuery4_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery4_mq)]  
  
## <a name="example-5"></a><span data-ttu-id="7ccc6-130">Beispiel 5</span><span class="sxs-lookup"><span data-stu-id="7ccc6-130">Example 5</span></span>  
 <span data-ttu-id="7ccc6-131">Im folgenden Beispiel wird eine Abfrage kompiliert und anschließend aufgerufen, der ein <xref:System.DateTime>-Eingabeparameter und ein <xref:System.Decimal>-Eingabeparameter übergeben wird und die eine Sequenz von Aufträgen zurückgibt, in denen das Auftragsdatum nach dem 3. März 2008 liegt und der fällige Gesamtbetrag weniger als 300,00 Dollar beträgt:</span><span class="sxs-lookup"><span data-stu-id="7ccc6-131">The following example compiles and then invokes a query that accepts <xref:System.DateTime> and <xref:System.Decimal> input parameters and returns a sequence of orders where the order date is later than March 8, 2003, and the total due is less than $300.00:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#CompiledQuery5](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery5)]
 [!code-vb[DP L2E Conceptual Examples#CompiledQuery5](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery5)]  
  
## <a name="example-6"></a><span data-ttu-id="7ccc6-132">Beispiel 6</span><span class="sxs-lookup"><span data-stu-id="7ccc6-132">Example 6</span></span>  
 <span data-ttu-id="7ccc6-133">Im folgenden Beispiel wird eine Abfrage kompiliert und anschließend aufgerufen, der ein <xref:System.DateTime>-Eingabeparameter übergeben wird und die eine Sequenz von Aufträgen zurückgibt, in denen das Bestelldatum nach dem 8. März 2004 liegt:</span><span class="sxs-lookup"><span data-stu-id="7ccc6-133">The following example compiles and then invokes a query that accepts a <xref:System.DateTime> input parameter and returns a sequence of orders where the order date is later than March 8, 2004.</span></span> <span data-ttu-id="7ccc6-134">Diese Abfrage gibt die Bestellinformationen als Sequenz anonymer Typen zurück.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-134">This query returns the order information as a sequence of anonymous types.</span></span> <span data-ttu-id="7ccc6-135">Anonyme Typen werden vom Compiler abgeleitet, sodass in der <xref:System.Data.Objects.CompiledQuery>-Methode von `Compile` keine Typparameter angegeben werden können. Der Typ wird in der Abfrage selbst definiert.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-135">Anonymous types are inferred by the compiler, so you cannot specify type parameters in the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method and the type is defined in the query itself.</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#CompiledQuery6](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery6)]
 [!code-vb[DP L2E Conceptual Examples#CompiledQuery6](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery6)]  
  
## <a name="example-7"></a><span data-ttu-id="7ccc6-136">Beispiel 7</span><span class="sxs-lookup"><span data-stu-id="7ccc6-136">Example 7</span></span>  
 <span data-ttu-id="7ccc6-137">Im folgenden Beispiel wird eine Abfrage kompiliert und anschließend aufgerufen, die einen Eingabeparameter mit einer benutzerdefinierten Struktur akzeptiert und eine Sequenz von Aufträgen zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-137">The following example compiles and then invokes a query that accepts a user-defined structure input parameter and returns a sequence of orders.</span></span> <span data-ttu-id="7ccc6-138">Die Struktur definiert die Abfrageparameter für Startdatum, Enddatum und den fälligen Gesamtbetrag. Die Abfrage gibt die zwischen dem 3. und 8. März 2003 versendeten Bestellungen mit einem fälligen Gesamtbetrag von über 700,00 US-Dollar zurück.</span><span class="sxs-lookup"><span data-stu-id="7ccc6-138">The structure defines start date, end date, and total due query parameters, and the query returns orders shipped between March 3 and March 8, 2003 with a total due greater than $700.00.</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#CompiledQuery7](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery7)]
 [!code-vb[DP L2E Conceptual Examples#CompiledQuery7](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery7)]  
  
 <span data-ttu-id="7ccc6-139">Die Struktur, die die Abfrageparameter definiert:</span><span class="sxs-lookup"><span data-stu-id="7ccc6-139">The structure that defines the query parameters:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#MyParamsStruct](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#myparamsstruct)]
 [!code-vb[DP L2E Conceptual Examples#MyParamsStruct](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#myparamsstruct)]  
  
## <a name="see-also"></a><span data-ttu-id="7ccc6-140">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="7ccc6-140">See also</span></span>

- [<span data-ttu-id="7ccc6-141">ADO.NET Entity Framework</span><span class="sxs-lookup"><span data-stu-id="7ccc6-141">ADO.NET Entity Framework</span></span>](../index.md)
- [<span data-ttu-id="7ccc6-142">LINQ to Entities</span><span class="sxs-lookup"><span data-stu-id="7ccc6-142">LINQ to Entities</span></span>](linq-to-entities.md)
- [<span data-ttu-id="7ccc6-143">EF-mergeoptionen und kompilierte Abfragen</span><span class="sxs-lookup"><span data-stu-id="7ccc6-143">EF Merge Options and Compiled Queries</span></span>](https://docs.microsoft.com/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries)
