---
title: Erstellen eines Workflowdiensts mit langer Ausführungszeit
ms.date: 03/30/2017
ms.assetid: 4c39bd04-5b8a-4562-a343-2c63c2821345
ms.openlocfilehash: 4ae01201230bf848c045158424db60097d8dd767
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 06/09/2020
ms.locfileid: "84599346"
---
# <a name="create-a-long-running-workflow-service"></a><span data-ttu-id="609b4-102">Erstellen eines Workflow Dienstanbieter mit langer Laufzeit</span><span class="sxs-lookup"><span data-stu-id="609b4-102">Create a Long-running Workflow Service</span></span>

<span data-ttu-id="609b4-103">In diesem Thema wird beschrieben, wie ein Workflowdienst mit langer Laufzeit erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="609b4-103">This topic describes how to create a long-running workflow service.</span></span> <span data-ttu-id="609b4-104">Workflowdienste mit langer Laufzeit können über einen sehr großen Zeitraum hinweg ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="609b4-104">Long running workflow services may run for long periods of time.</span></span> <span data-ttu-id="609b4-105">Währenddessen kann der Workflow in den Leerlauf wechseln und auf weitere Informationen warten.</span><span class="sxs-lookup"><span data-stu-id="609b4-105">At some point the workflow may go idle waiting for some additional information.</span></span> <span data-ttu-id="609b4-106">In diesem Fall wird der Workflow in einer SQL-Datenbank beibehalten und aus dem Arbeitsspeicher entfernt.</span><span class="sxs-lookup"><span data-stu-id="609b4-106">When this occurs the workflow is persisted to a SQL database and is removed from memory.</span></span> <span data-ttu-id="609b4-107">Wenn weitere Informationen für die Workflowinstanz verfügbar sind, wird diese wieder in den Arbeitsspeicher geladen, und die Ausführung wird fortgesetzt.</span><span class="sxs-lookup"><span data-stu-id="609b4-107">When the additional information becomes available the workflow instance is loaded back into memory and continues executing.</span></span>  <span data-ttu-id="609b4-108">In diesem Szenario implementieren Sie ein stark vereinfachtes Bestellsystem.</span><span class="sxs-lookup"><span data-stu-id="609b4-108">In this scenario you are implementing a very simplified ordering system.</span></span>  <span data-ttu-id="609b4-109">Zunächst wird eine Nachricht vom Client an den Workflow gesendet, um die Bestellung zu beginnen.</span><span class="sxs-lookup"><span data-stu-id="609b4-109">The client sends an initial message to the workflow service to start the order.</span></span> <span data-ttu-id="609b4-110">Die Bestell-ID wird an den Client zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="609b4-110">It returns an order ID to the client.</span></span> <span data-ttu-id="609b4-111">Der Workflowdienst wartet nun auf eine weitere Nachricht vom Client, wechselt in den Leerlauf und wird in der SQL-Datenbank beibehalten.</span><span class="sxs-lookup"><span data-stu-id="609b4-111">At this point the workflow service is waiting for another message from the client and goes into the idle state and is persisted to a SQL Server database.</span></span>  <span data-ttu-id="609b4-112">Wenn die nächste Nachricht vom Client mit der Bestellung eines Artikels empfangen wird, wird der Workflowdienst wieder in den Arbeitsspeicher geladen, und die Bestellung wird abschließend bearbeitet.</span><span class="sxs-lookup"><span data-stu-id="609b4-112">When the client sends the next message to order an item, the workflow service is loaded back into memory and finishes processing the order.</span></span> <span data-ttu-id="609b4-113">In diesem Codebeispiel wird eine Zeichenfolge zurückgegeben, die angibt, dass der Artikel der Bestellung hinzugefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="609b4-113">In the code sample it returns a string stating the item has been added to the order.</span></span> <span data-ttu-id="609b4-114">Das Codebeispiel ist nicht als reale Anwendung der Technologie gedacht. Es soll vielmehr auf einfache Weise einen Workflowdienst mit langer Laufzeit veranschaulichen.</span><span class="sxs-lookup"><span data-stu-id="609b4-114">The code sample is not meant to be a real world application of the technology, but rather a simple sample that illustrates long running workflow services.</span></span> <span data-ttu-id="609b4-115">In diesem Thema wird davon ausgegangen, dass Sie wissen, wie Visual Studio 2012-Projekte und-Lösungen erstellt werden</span><span class="sxs-lookup"><span data-stu-id="609b4-115">This topic assumes you know how to create Visual Studio 2012 projects and solutions.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="609b4-116">Voraussetzungen</span><span class="sxs-lookup"><span data-stu-id="609b4-116">Prerequisites</span></span>

<span data-ttu-id="609b4-117">Sie müssen folgende Software installiert haben, um diese exemplarische Vorgehensweise verwenden zu können:</span><span class="sxs-lookup"><span data-stu-id="609b4-117">You must have the following software installed to use this walkthrough:</span></span>

1. <span data-ttu-id="609b4-118">Microsoft SQL Server 2008</span><span class="sxs-lookup"><span data-stu-id="609b4-118">Microsoft SQL Server 2008</span></span>

2. <span data-ttu-id="609b4-119">Visual Studio 2012</span><span class="sxs-lookup"><span data-stu-id="609b4-119">Visual Studio 2012</span></span>

3. <span data-ttu-id="609b4-120">Microsoft [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)]</span><span class="sxs-lookup"><span data-stu-id="609b4-120">Microsoft  [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)]</span></span>

4. <span data-ttu-id="609b4-121">Sie sind mit WCF und Visual Studio 2012 vertraut und wissen, wie Projekte/Projektmappen erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="609b4-121">You are familiar with WCF and Visual Studio 2012 and know how to create projects/solutions.</span></span>

## <a name="set-up-the-sql-database"></a><span data-ttu-id="609b4-122">Einrichten der SQL-Datenbank</span><span class="sxs-lookup"><span data-stu-id="609b4-122">Set up the SQL Database</span></span>

1. <span data-ttu-id="609b4-123">Damit Workflowdienstinstanzen beibehalten werden können, muss Microsoft SQL Server installiert sein, und Sie müssen eine Datenbank konfiguriert haben, in der die beibehaltenen Workflowinstanzen gespeichert werden können.</span><span class="sxs-lookup"><span data-stu-id="609b4-123">In order for workflow service instances to be persisted you must have Microsoft SQL Server installed and you must configure a database to store the persisted workflow instances.</span></span> <span data-ttu-id="609b4-124">Klicken Sie auf die Schaltfläche **Start** , und wählen Sie **Alle Programme**, **Microsoft SQL Server 2008**und **Microsoft SQL Management Studio**aus, um Microsoft SQL Management Studio auszuführen.</span><span class="sxs-lookup"><span data-stu-id="609b4-124">Run Microsoft SQL Management Studio by clicking the **Start** button, selecting **All Programs**, **Microsoft SQL Server 2008**, and **Microsoft SQL Management Studio**.</span></span>

2. <span data-ttu-id="609b4-125">Klicken Sie auf die Schaltfläche **verbinden** , um sich bei der SQL Server Instanz anzumelden.</span><span class="sxs-lookup"><span data-stu-id="609b4-125">Click the **Connect** button to log on to the SQL Server instance</span></span>

3. <span data-ttu-id="609b4-126">Klicken Sie in der Strukturansicht mit der rechten Maustaste auf **Datenbanken** , und wählen Sie **neue Datenbank**</span><span class="sxs-lookup"><span data-stu-id="609b4-126">Right click **Databases** in the tree view and select **New Database..**</span></span> <span data-ttu-id="609b4-127">zum Erstellen einer neuen Datenbank mit dem Namen `SQLPersistenceStore` .</span><span class="sxs-lookup"><span data-stu-id="609b4-127">to create a new database called `SQLPersistenceStore`.</span></span>

4. <span data-ttu-id="609b4-128">Führen Sie die Skriptdatei SqlWorkflowInstanceStoreSchema.sql unter C:\Windows\Microsoft.NET\Framework\v4.0\SQL\en in der SQLPersistenceStore-Datenbank aus, um die erforderlichen Datenbankschemas einzurichten.</span><span class="sxs-lookup"><span data-stu-id="609b4-128">Run the SqlWorkflowInstanceStoreSchema.sql script file located in the C:\Windows\Microsoft.NET\Framework\v4.0\SQL\en directory on the SQLPersistenceStore database to set up the needed database schemas.</span></span>

5. <span data-ttu-id="609b4-129">Führen Sie die Skriptdatei SqlWorkflowInstanceStoreLogic.sql unter C:\Windows\Microsoft.NET\Framework\v4.0\SQL\en in der SQLPersistenceStore-Datenbank aus, um die erforderliche Datenbanklogik einzurichten.</span><span class="sxs-lookup"><span data-stu-id="609b4-129">Run the SqlWorkflowInstanceStoreLogic.sql script file located in the C:\Windows\Microsoft.NET\Framework\v4.0\SQL\en directory on the SQLPersistenceStore database to set up the needed database logic.</span></span>

## <a name="create-the-web-hosted-workflow-service"></a><span data-ttu-id="609b4-130">Erstellen des webgehosteten Workflow Diensts</span><span class="sxs-lookup"><span data-stu-id="609b4-130">Create the Web Hosted Workflow Service</span></span>

1. <span data-ttu-id="609b4-131">Erstellen Sie eine leere Visual Studio 2012-Projekt Mappe, und benennen Sie Sie `OrderProcessing` .</span><span class="sxs-lookup"><span data-stu-id="609b4-131">Create an empty Visual Studio 2012 solution, name it `OrderProcessing`.</span></span>

2. <span data-ttu-id="609b4-132">Fügen Sie der Projektmappe ein neues Projekt für eine WCF-Workflowdienstanwendung mit dem Namen `OrderService` hinzu.</span><span class="sxs-lookup"><span data-stu-id="609b4-132">Add a new WCF Workflow Service Application project called `OrderService` to the solution.</span></span>

3. <span data-ttu-id="609b4-133">Wählen Sie im Dialogfeld Projekteigenschaften die Registerkarte **Web** aus.</span><span class="sxs-lookup"><span data-stu-id="609b4-133">In the project properties dialog, select the **Web** tab.</span></span>

    1. <span data-ttu-id="609b4-134">Wählen Sie unter **Start Aktion** **bestimmte Seite** aus, und geben Sie an `Service1.xamlx` .</span><span class="sxs-lookup"><span data-stu-id="609b4-134">Under **Start Action** select **Specific Page** and specify `Service1.xamlx`.</span></span>

        <span data-ttu-id="609b4-135">![Workflowdienstprojekt-Webeigenschaften](./media/creating-a-long-running-workflow-service/start-action-specific-page-option.png "Erstellen der Dienst spezifischen Seiten Option für den webgehosteten Workflow")</span><span class="sxs-lookup"><span data-stu-id="609b4-135">![Workflow Service Project Web Properties](./media/creating-a-long-running-workflow-service/start-action-specific-page-option.png "Create the web hosted workflow service - Specific Page option")</span></span>

    2. <span data-ttu-id="609b4-136">Wählen Sie unter **Server** die Option **lokalen IIS-Webserver verwenden**aus.</span><span class="sxs-lookup"><span data-stu-id="609b4-136">Under **Servers** select **Use Local IIS Web server**.</span></span>

        <span data-ttu-id="609b4-137">![Lokale Webservereinstellungen](./media/creating-a-long-running-workflow-service/use-local-web-server.png "Erstellen des webgehosteten Workflow Diensts-Option "lokalen IIS-Webserver verwenden"")</span><span class="sxs-lookup"><span data-stu-id="609b4-137">![Local Web Server Settings](./media/creating-a-long-running-workflow-service/use-local-web-server.png "Create the web hosted workflow service - Use Local IIS Web Server option")</span></span>

        > [!WARNING]
        > <span data-ttu-id="609b4-138">Sie müssen Visual Studio 2012 im Administrator Modus ausführen, um diese Einstellung vorzunehmen.</span><span class="sxs-lookup"><span data-stu-id="609b4-138">You must run Visual Studio 2012 in administrator mode to make this setting.</span></span>

        <span data-ttu-id="609b4-139">Mit diesen beiden Schritten wird das Workflowdienstprojekt konfiguriert, das von IIS gehostet werden soll.</span><span class="sxs-lookup"><span data-stu-id="609b4-139">These two steps configure the workflow service project to be hosted by IIS.</span></span>

4. <span data-ttu-id="609b4-140">Öffnen `Service1.xamlx` Sie, wenn es nicht bereits geöffnet ist, und löschen Sie die vorhandenen Aktivitäten **ReceiveRequest** und **SendResponse** .</span><span class="sxs-lookup"><span data-stu-id="609b4-140">Open `Service1.xamlx` if it is not open already and delete the existing **ReceiveRequest** and **SendResponse** activities.</span></span>

5. <span data-ttu-id="609b4-141">Wählen Sie die Aktivität **sequenzieller Dienst** aus, klicken Sie auf den Link **Variablen** , und fügen Sie die in der folgenden Abbildung gezeigten Variablen hinzu</span><span class="sxs-lookup"><span data-stu-id="609b4-141">Select the **Sequential Service** activity and click the **Variables** link and add the variables shown in the following illustration.</span></span> <span data-ttu-id="609b4-142">Dadurch werden einige Variablen hinzugefügt, die im weiteren Verlauf in diesem Workflow verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="609b4-142">Doing this adds some variables that will be used later on in the workflow service.</span></span>

    > [!NOTE]
    > <span data-ttu-id="609b4-143">Wenn correlationhandle nicht in der Dropdown Liste Variablentyp angezeigt wird, wählen Sie in der Dropdown Liste die Option **nach Typen suchen** aus.</span><span class="sxs-lookup"><span data-stu-id="609b4-143">If CorrelationHandle is not in the Variable Type drop-down, select **Browse for types** from the drop-down.</span></span> <span data-ttu-id="609b4-144">Geben Sie correlationhandle in das Feld **Typname** ein, wählen Sie correlationhandle aus dem Listenfeld aus, und klicken Sie auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="609b4-144">Type CorrelationHandle in the **Type name** box, select CorrelationHandle from the listbox and click **OK**.</span></span>

    <span data-ttu-id="609b4-145">![Variablen hinzufügen](./media/creating-a-long-running-workflow-service/add-variables-sequential-service-activity.gif "Fügen Sie der sequenziellen Dienst Aktivität Variablen hinzu.")</span><span class="sxs-lookup"><span data-stu-id="609b4-145">![Add Variables](./media/creating-a-long-running-workflow-service/add-variables-sequential-service-activity.gif "Add variables to the Sequential Service activity.")</span></span>

6. <span data-ttu-id="609b4-146">Ziehen Sie eine **receiveandsendreply** -Aktivitäts Vorlage per Drag & Drop in die Aktivität **sequenzieller Dienst** .</span><span class="sxs-lookup"><span data-stu-id="609b4-146">Drag and drop a **ReceiveAndSendReply** activity template into the **Sequential Service** activity.</span></span> <span data-ttu-id="609b4-147">Diese Gruppe von Aktivitäten empfängt eine Nachricht von einem Client und sendet eine Antwort.</span><span class="sxs-lookup"><span data-stu-id="609b4-147">This set of activities will receive a message from a client and send a reply back.</span></span>

    1. <span data-ttu-id="609b4-148">Wählen Sie die **Receive** -Aktivität aus, und legen Sie die in der folgenden Abbildung markierten Eigenschaften fest.</span><span class="sxs-lookup"><span data-stu-id="609b4-148">Select the **Receive** activity and set the properties highlighted in the following illustration.</span></span>

        <span data-ttu-id="609b4-149">![Receive-Aktivitätseigenschaften festlegen](./media/creating-a-long-running-workflow-service/set-receive-activity-properties.png "Legen Sie die Eigenschaften der Empfangs Aktivität fest.")</span><span class="sxs-lookup"><span data-stu-id="609b4-149">![Set Receive Activity Properties](./media/creating-a-long-running-workflow-service/set-receive-activity-properties.png "Set the Receive activity properties.")</span></span>

        <span data-ttu-id="609b4-150">Mit der DisplayName-Eigenschaft wird der angezeigte Name für die Receive-Aktivität im Designer festgelegt.</span><span class="sxs-lookup"><span data-stu-id="609b4-150">The DisplayName property sets the name displayed for the Receive activity in the designer.</span></span> <span data-ttu-id="609b4-151">Mit der ServiceContractName-Eigenschaft und der OperationName-Eigenschaft wird der Name des Dienstvertrags und des Vorgangs angegeben, die von der Receive-Aktivität implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="609b4-151">The ServiceContractName and OperationName properties specify the name of the service contract and operation that are implemented by the Receive activity.</span></span> <span data-ttu-id="609b4-152">Weitere Informationen zur Verwendung von Verträgen in Workflow Diensten finden Sie unter [Verwenden von Verträgen im Workflow](using-contracts-in-workflow.md).</span><span class="sxs-lookup"><span data-stu-id="609b4-152">For more information about how contracts are used in Workflow services see [Using Contracts in Workflow](using-contracts-in-workflow.md).</span></span>

    2. <span data-ttu-id="609b4-153">Klicken Sie in der **receivestartor der** -Aktivität auf den Link **definieren...** , und legen Sie die Eigenschaften fest, die in der folgenden Abbildung dargestellt sind.</span><span class="sxs-lookup"><span data-stu-id="609b4-153">Click the **Define...** link in the **ReceiveStartOrder** activity and set the properties shown in the following illustration.</span></span>  <span data-ttu-id="609b4-154">Beachten Sie, dass das Optionsfeld **Parameter** ausgewählt ist, dass ein Parameter `p_customerName` mit dem Namen an die Variable gebunden ist `customerName` .</span><span class="sxs-lookup"><span data-stu-id="609b4-154">Notice that the **Parameters** radio button is selected, a parameter named `p_customerName` is bound to the `customerName` variable.</span></span> <span data-ttu-id="609b4-155">Dadurch wird die **Receive** -Aktivität konfiguriert, um einige Daten zu empfangen und diese Daten an lokale Variablen zu binden.</span><span class="sxs-lookup"><span data-stu-id="609b4-155">This configures the **Receive** activity to receive some data and bind that data to local variables.</span></span>

        <span data-ttu-id="609b4-156">![Festlegen der von der Receive-Aktivität empfangenen Daten](./media/creating-a-long-running-workflow-service/set-properties-for-receive-content.png "Legen Sie die Eigenschaften für die von der Receive-Aktivität empfangenen Daten fest.")</span><span class="sxs-lookup"><span data-stu-id="609b4-156">![Setting the data received by the Receive activity](./media/creating-a-long-running-workflow-service/set-properties-for-receive-content.png "Set the properties for data received by the Receive activity.")</span></span>

    3. <span data-ttu-id="609b4-157">Wählen Sie die **sendreplytor eceive** -Aktivität aus, und legen Sie die in der folgenden Abbildung gezeigte hervorgehobene Eigenschaft fest.</span><span class="sxs-lookup"><span data-stu-id="609b4-157">Select The **SendReplyToReceive** activity and set the highlighted property shown in the following illustration.</span></span>

        <span data-ttu-id="609b4-158">![Festlegen der Eigenschaften der SendReply-Aktivität](./media/creating-a-long-running-workflow-service/set-properties-for-reply-activities.png "SetReplyProperties")</span><span class="sxs-lookup"><span data-stu-id="609b4-158">![Setting the properties of the SendReply activity](./media/creating-a-long-running-workflow-service/set-properties-for-reply-activities.png "SetReplyProperties")</span></span>

    4. <span data-ttu-id="609b4-159">Klicken Sie in der **sendreplyderstartor** -Aktivität auf den Link **definieren...** , und legen Sie die Eigenschaften fest, die in der folgenden Abbildung dargestellt sind.</span><span class="sxs-lookup"><span data-stu-id="609b4-159">Click the **Define...** link in the **SendReplyToStartOrder** activity and set the properties shown in the following illustration.</span></span> <span data-ttu-id="609b4-160">Beachten Sie, dass das Optionsfeld **Parameter** ausgewählt ist. ein Parameter `p_orderId` mit dem Namen ist an die `orderId` Variable gebunden.</span><span class="sxs-lookup"><span data-stu-id="609b4-160">Notice that the **Parameters** radio button is selected; a parameter named `p_orderId` is bound to the `orderId` variable.</span></span> <span data-ttu-id="609b4-161">Mit dieser Einstellung wird festgelegt, dass von der SendReplyToStartOrder-Aktivität ein Wert vom Typ Zeichenfolge an den Aufrufer zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="609b4-161">This setting specifies that the SendReplyToStartOrder activity will return a value of type string to the caller.</span></span>

        <span data-ttu-id="609b4-162">![Konfigurieren der SendReply-Aktivitätsinhaltsdaten](./media/creating-a-long-running-workflow-service/setreplycontent-for-sendreplytostartorder-activity.png "Einstellung für die Aktivität "Aktivität festlegen"")</span><span class="sxs-lookup"><span data-stu-id="609b4-162">![Configuring the SendReply activity content data](./media/creating-a-long-running-workflow-service/setreplycontent-for-sendreplytostartorder-activity.png "Configure setting for SetReplyToStartOrder activity.")</span></span>

    5. <span data-ttu-id="609b4-163">Ziehen Sie eine Assign-Aktivität per Drag & Drop zwischen den **Receive** -und **SendReply** -Aktivitäten, und legen Sie die Eigenschaften wie in der folgenden Abbildung dargestellt fest:</span><span class="sxs-lookup"><span data-stu-id="609b4-163">Drag and drop an Assign activity in between the **Receive** and **SendReply** activities and set the properties as shown in the following illustration:</span></span>

        <span data-ttu-id="609b4-164">![Hinzufügen einer Zuweisungsaktivität](./media/creating-a-long-running-workflow-service/add-an-assign-activity.png "Fügen Sie eine Assign-Aktivität hinzu.")</span><span class="sxs-lookup"><span data-stu-id="609b4-164">![Adding an assign activity](./media/creating-a-long-running-workflow-service/add-an-assign-activity.png "Add an assign activity.")</span></span>

        <span data-ttu-id="609b4-165">Dadurch wird eine neue Bestell-ID erstellt, und der Wert wird in der orderId-Variablen platziert.</span><span class="sxs-lookup"><span data-stu-id="609b4-165">This creates a new order ID and places the value in the orderId variable.</span></span>

    6. <span data-ttu-id="609b4-166">Wählen Sie die Aktivität **ReplyTo startor der** aus.</span><span class="sxs-lookup"><span data-stu-id="609b4-166">Select the **ReplyToStartOrder** activity.</span></span> <span data-ttu-id="609b4-167">Klicken Sie im Eigenschaften Fenster auf die Schaltfläche mit den Auslassungs Punkten für **correlationinitializers**.</span><span class="sxs-lookup"><span data-stu-id="609b4-167">In the properties window click the ellipsis button for **CorrelationInitializers**.</span></span> <span data-ttu-id="609b4-168">Wählen Sie den Link **Initialisierer hinzufügen** aus, geben Sie `orderIdHandle` in das Textfeld Initialisierer ein, wählen Sie als Korrelationstyp Abfrage korrelationsinitialisierer aus, und wählen Sie p_orderId im Dropdown Feld XPath-Abfragen aus.</span><span class="sxs-lookup"><span data-stu-id="609b4-168">Select the **Add initializer** link, enter `orderIdHandle` in the Initializer text box, select Query correlation initializer for the Correlation type, and select p_orderId under the XPATH Queries dropdown box.</span></span> <span data-ttu-id="609b4-169">Diese Einstellungen werden in der folgenden Abbildung gezeigt.</span><span class="sxs-lookup"><span data-stu-id="609b4-169">These settings are shown in the following illustration.</span></span> <span data-ttu-id="609b4-170">Klicken Sie auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="609b4-170">Click **OK**.</span></span>  <span data-ttu-id="609b4-171">Dadurch wird eine Korrelation zwischen dem Client und dieser Instanz des Workflowdiensts initialisiert.</span><span class="sxs-lookup"><span data-stu-id="609b4-171">This initializes a correlation between the client and this instance of the workflow service.</span></span> <span data-ttu-id="609b4-172">Wenn eine Nachricht mit dieser Bestell-ID empfangen wird, wird sie an diese Instanz des Workflowdiensts weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="609b4-172">When a message containing this order ID is received it is routed to this instance of the workflow service.</span></span>

        <span data-ttu-id="609b4-173">![Hinzufügen eines Korrelationsinitialisierers](./media/creating-a-long-running-workflow-service/add-correlationinitializers.png "Fügen Sie einen korrelationsinitialisierer hinzu.")</span><span class="sxs-lookup"><span data-stu-id="609b4-173">![Adding a correlation initializer](./media/creating-a-long-running-workflow-service/add-correlationinitializers.png "Add a correlation initializer.")</span></span>

7. <span data-ttu-id="609b4-174">Ziehen Sie eine andere **receiveandsendreply** -Aktivität per Drag & Drop an das Ende des Workflows (außerhalb der **Sequenz** , in der die ersten **Receive** -und **SendReply** -Aktivitäten enthalten sind).</span><span class="sxs-lookup"><span data-stu-id="609b4-174">Drag and drop another **ReceiveAndSendReply** activity to the end of the workflow (outside the **Sequence** containing the first **Receive** and **SendReply** activities).</span></span> <span data-ttu-id="609b4-175">Dadurch wird die zweite Meldung empfangen, die vom Client gesendet wurde, und beantwortet.</span><span class="sxs-lookup"><span data-stu-id="609b4-175">This will receive the second message sent by the client and respond to it.</span></span>

    1. <span data-ttu-id="609b4-176">Wählen Sie die **Sequenz** mit den neu hinzugefügten **Receive** -und **SendReply** -Aktivitäten aus, und klicken Sie auf die Schaltfläche **Variablen**</span><span class="sxs-lookup"><span data-stu-id="609b4-176">Select the **Sequence** that contains the newly added **Receive** and **SendReply** activities and click the **Variables** button.</span></span> <span data-ttu-id="609b4-177">Fügen Sie die in der folgenden Abbildung hervorgehobene Variable hinzu:</span><span class="sxs-lookup"><span data-stu-id="609b4-177">Add the variable highlighted in the following illustration:</span></span>

        <span data-ttu-id="609b4-178">![Hinzufügen von neuen Variablen](./media/creating-a-long-running-workflow-service/add-the-itemid-variable.png "Fügen Sie die Itemid-Variable hinzu.")</span><span class="sxs-lookup"><span data-stu-id="609b4-178">![Adding new variables](./media/creating-a-long-running-workflow-service/add-the-itemid-variable.png "Add the ItemId variable.")</span></span>

        <span data-ttu-id="609b4-179">Fügen Sie außerdem `orderResult` als **Zeichenfolge** im `Sequence` Bereich hinzu.</span><span class="sxs-lookup"><span data-stu-id="609b4-179">Also add `orderResult` as **String** in the `Sequence` scope.</span></span>

    2. <span data-ttu-id="609b4-180">Wählen Sie die **Receive** -Aktivität aus, und legen Sie die in der folgenden Abbildung gezeigten Eigenschaften fest:</span><span class="sxs-lookup"><span data-stu-id="609b4-180">Select the **Receive** activity and set the properties shown in the following illustration:</span></span>

        <span data-ttu-id="609b4-181">![Festlegen der Eigenschaften der Empfangs Aktivität](./media/creating-a-long-running-workflow-service/set-receive-activities-properties.png "Legen Sie die Eigenschaften der Empfangs Aktivitäten fest.")</span><span class="sxs-lookup"><span data-stu-id="609b4-181">![Set the Receive activity properties](./media/creating-a-long-running-workflow-service/set-receive-activities-properties.png "Set the Receive activities properties.")</span></span>

        > [!NOTE]
        > <span data-ttu-id="609b4-182">Vergessen Sie nicht, das **servicecontractname** -Feld mit zu ändern `../IAddItem` .</span><span class="sxs-lookup"><span data-stu-id="609b4-182">Don't forget to change **ServiceContractName** field with `../IAddItem`.</span></span>

    3. <span data-ttu-id="609b4-183">Klicken Sie in der **receiveadditem** -Aktivität auf den Link **definieren...** , und fügen Sie die in der folgenden Abbildung gezeigten Parameter hinzu: Dadurch wird die Receive-Aktivität so konfiguriert, dass zwei Parameter, die Bestell-ID und die ID des bestellten Elements akzeptiert werden.</span><span class="sxs-lookup"><span data-stu-id="609b4-183">Click the **Define...** link in the **ReceiveAddItem** activity and add the parameters shown in the following illustration:This configures the receive activity to accept two parameters, the order ID and the ID of the item being ordered.</span></span>

        <span data-ttu-id="609b4-184">![Angeben von Parametern für den zweiten Empfang](./media/creating-a-long-running-workflow-service/add-receive-two-parameters.png "Konfigurieren Sie die Receive-Aktivität, um zwei Parameter zu empfangen.")</span><span class="sxs-lookup"><span data-stu-id="609b4-184">![Specifying parameters for the second receive](./media/creating-a-long-running-workflow-service/add-receive-two-parameters.png "Configure the receive activity to receive two parameters.")</span></span>

    4. <span data-ttu-id="609b4-185">Klicken Sie auf die Schaltfläche **correlateon** Auslassungs Punkte, und geben Sie ein `orderIdHandle` .</span><span class="sxs-lookup"><span data-stu-id="609b4-185">Click the **CorrelateOn** ellipsis button and enter `orderIdHandle`.</span></span> <span data-ttu-id="609b4-186">Klicken Sie unter **XPath-Abfragen**auf den Dropdown Pfeil, und wählen Sie aus `p_orderId` .</span><span class="sxs-lookup"><span data-stu-id="609b4-186">Under **XPath Queries**, click the drop down arrow and select `p_orderId`.</span></span> <span data-ttu-id="609b4-187">Dadurch wird die Korrelation für die zweite Receive-Aktivität konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="609b4-187">This configures the correlation on the second receive activity.</span></span> <span data-ttu-id="609b4-188">Weitere Informationen zur Korrelation finden Sie unter [Korrelation](correlation.md).</span><span class="sxs-lookup"><span data-stu-id="609b4-188">For more information about correlation see [Correlation](correlation.md).</span></span>

        <span data-ttu-id="609b4-189">![Festlegen der CorrelatesOn-Eigenschaft](./media/creating-a-long-running-workflow-service/correlateson-setting.png "Legen Sie die CorrelatesOn-Eigenschaft fest.")</span><span class="sxs-lookup"><span data-stu-id="609b4-189">![Setting the CorrelatesOn property](./media/creating-a-long-running-workflow-service/correlateson-setting.png "Set the CorrelatesOn property.")</span></span>

    5. <span data-ttu-id="609b4-190">Ziehen Sie eine **if** -Aktivität direkt nach der **receiveadditem** -Aktivität per Drag & Drop.</span><span class="sxs-lookup"><span data-stu-id="609b4-190">Drag and drop an **If** activity immediately after the **ReceiveAddItem** activity.</span></span> <span data-ttu-id="609b4-191">Diese Aktivität verhält sich analog zu einer Anweisung.</span><span class="sxs-lookup"><span data-stu-id="609b4-191">This activity acts just like an if statement.</span></span>

        1. <span data-ttu-id="609b4-192">Legen Sie die **Condition** -Eigenschaft auf fest`itemId=="Zune HD" (itemId="Zune HD" for Visual Basic)`</span><span class="sxs-lookup"><span data-stu-id="609b4-192">Set the **Condition** property to `itemId=="Zune HD" (itemId="Zune HD" for Visual Basic)`</span></span>

        2. <span data-ttu-id="609b4-193">Ziehen Sie eine **assign** -Aktivität in den Abschnitt **Then** und einen weiteren in den Abschnitt **else** , und legen Sie die Eigenschaften der **assign** -Aktivitäten fest, wie in der folgenden Abbildung dargestellt.</span><span class="sxs-lookup"><span data-stu-id="609b4-193">Drag and drop an **Assign** activity in to the **Then** section and another into the **Else** section set the properties of the **Assign** activities as shown in the following illustration.</span></span>

            <span data-ttu-id="609b4-194">![Zuweisen des Ergebnisses des Dienstaufrufs](./media/creating-a-long-running-workflow-service/assign-result-of-service-call.png "Weisen Sie das Ergebnis des Dienst Aufrufes zu.")</span><span class="sxs-lookup"><span data-stu-id="609b4-194">![Assigning the result of the service call](./media/creating-a-long-running-workflow-service/assign-result-of-service-call.png "Assign the result of the service call.")</span></span>

            <span data-ttu-id="609b4-195">Wenn die Bedingung ist, `true` wird der **Then** -Abschnitt ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="609b4-195">If the condition is `true` the **Then** section will be executed.</span></span> <span data-ttu-id="609b4-196">Wenn die Bedingung ist, `false` wird der **else** -Abschnitt ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="609b4-196">If the condition is `false` the **Else** section is executed.</span></span>

        3. <span data-ttu-id="609b4-197">Wählen Sie die **sendreplytor eceive** -Aktivität aus, und legen Sie die **Display Name** -Eigenschaft fest, wie in der folgenden Abbildung dargestellt.</span><span class="sxs-lookup"><span data-stu-id="609b4-197">Select the **SendReplyToReceive** activity and set the **DisplayName** property shown in the following illustration.</span></span>

            <span data-ttu-id="609b4-198">![Festlegen der SendReply-Aktivitätseigenschaften](./media/creating-a-long-running-workflow-service/send-reply-activity-property.png "Legen Sie die SendReply-Aktivitäts Eigenschaft fest.")</span><span class="sxs-lookup"><span data-stu-id="609b4-198">![Setting the SendReply activity properties](./media/creating-a-long-running-workflow-service/send-reply-activity-property.png "Set the SendReply activity property.")</span></span>

        4. <span data-ttu-id="609b4-199">Klicken Sie in der Aktivität " **streplyshadditem** " auf den Link **definieren...** , und konfigurieren Sie ihn wie in der folgenden Abbildung dargestellt.</span><span class="sxs-lookup"><span data-stu-id="609b4-199">Click the **Define ...** link in the **SetReplyToAddItem** activity and configure it as shown in the following illustration.</span></span> <span data-ttu-id="609b4-200">Dadurch wird die **sendreplythadditem** -Aktivität so konfiguriert, dass der Wert in der Variablen zurückgegeben wird `orderResult` .</span><span class="sxs-lookup"><span data-stu-id="609b4-200">This configures the **SendReplyToAddItem** activity to return the value in the `orderResult` variable.</span></span>

            <span data-ttu-id="609b4-201">![Festlegen der Datenbindung für die SendReply-Aktivität](./media/creating-a-long-running-workflow-service/set-property-for-sendreplytoadditem.gif "Legen Sie die Eigenschaft für die sendreplythadditem-Aktivität fest.")</span><span class="sxs-lookup"><span data-stu-id="609b4-201">![Setting the data binding for the SendReply activity](./media/creating-a-long-running-workflow-service/set-property-for-sendreplytoadditem.gif "Set property for SendReplyToAddItem activity.")</span></span>

8. <span data-ttu-id="609b4-202">Öffnen Sie die Datei Web. config, und fügen Sie im Abschnitt die folgenden Elemente hinzu \<behavior> , um die Workflow Persistenz zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="609b4-202">Open the web.config file and add the following elements in the \<behavior> section to enable workflow persistence.</span></span>

    ```xml
    <sqlWorkflowInstanceStore connectionString="Data Source=your-machine\SQLExpress;Initial Catalog=SQLPersistenceStore;Integrated Security=True;Asynchronous Processing=True" instanceEncodingOption="None" instanceCompletionAction="DeleteAll" instanceLockedExceptionAction="BasicRetry" hostLockRenewalPeriod="00:00:30" runnableInstancesDetectionPeriod="00:00:02" />
              <workflowIdle timeToUnload="0"/>
    ```

    > [!WARNING]
    > <span data-ttu-id="609b4-203">Ersetzen Sie den Namen des Hosts und der SQL Server-Instanz aus dem vorherigen Codeausschnitt.</span><span class="sxs-lookup"><span data-stu-id="609b4-203">Make sure to replace your host and SQL server instance name in the previous code snippet.</span></span>

9. <span data-ttu-id="609b4-204">Erstellen Sie die Projektmappe.</span><span class="sxs-lookup"><span data-stu-id="609b4-204">Build the solution.</span></span>

## <a name="create-a-client-application-to-call-the-workflow-service"></a><span data-ttu-id="609b4-205">Erstellen Sie eine Client Anwendung, um den Workflow Dienst aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="609b4-205">Create a Client Application to Call the Workflow Service</span></span>

1. <span data-ttu-id="609b4-206">Fügen Sie der Projektmappe ein neues Konsolenanwendungsprojekt mit dem Namen `OrderClient` hinzu.</span><span class="sxs-lookup"><span data-stu-id="609b4-206">Add a new Console application project called `OrderClient` to the solution.</span></span>

2. <span data-ttu-id="609b4-207">Fügen Sie dem `OrderClient`-Projekt Verweise auf die folgenden Assemblys hinzu:</span><span class="sxs-lookup"><span data-stu-id="609b4-207">Add references to the following assemblies to the `OrderClient` project</span></span>

    1. <span data-ttu-id="609b4-208">System.ServiceModel.dll</span><span class="sxs-lookup"><span data-stu-id="609b4-208">System.ServiceModel.dll</span></span>

    2. <span data-ttu-id="609b4-209">System.ServiceModel.Activities.dll</span><span class="sxs-lookup"><span data-stu-id="609b4-209">System.ServiceModel.Activities.dll</span></span>

3. <span data-ttu-id="609b4-210">Fügen Sie dem Workflowdienst einen Dienstverweis hinzu, und geben Sie `OrderService` als Namespace an.</span><span class="sxs-lookup"><span data-stu-id="609b4-210">Add a service reference to the workflow service and specify `OrderService` as the namespace.</span></span>

4. <span data-ttu-id="609b4-211">Fügen Sie der `Main()`-Methode des Clientprojekts den folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="609b4-211">In the `Main()` method of the client project add the following code:</span></span>

    ```csharp
    static void Main(string[] args)
    {
       // Send initial message to start the workflow service
       Console.WriteLine("Sending start message");
       StartOrderClient startProxy = new StartOrderClient();
       string orderId = startProxy.StartOrder("Kim Abercrombie");

       // The workflow service is now waiting for the second message to be sent
       Console.WriteLine("Workflow service is idle...");
       Console.WriteLine("Press [ENTER] to send an add item message to reactivate the workflow service...");
       Console.ReadLine();

       // Send the second message
       Console.WriteLine("Sending add item message");
       AddItemClient addProxy = new AddItemClient();
       AddItem item = new AddItem();
       item.p_itemId = "Zune HD";
       item.p_orderId = orderId;

       string orderResult = addProxy.AddItem(item);
       Console.WriteLine("Service returned: " + orderResult);
    }
    ```

5. <span data-ttu-id="609b4-212">Erstellen Sie die Projektmappe, und führen Sie die `OrderClient`-Anwendung aus.</span><span class="sxs-lookup"><span data-stu-id="609b4-212">Build the solution and run the `OrderClient` application.</span></span> <span data-ttu-id="609b4-213">Der folgende Text wird vom Client angezeigt:</span><span class="sxs-lookup"><span data-stu-id="609b4-213">The client will display the following text:</span></span>

    ```output
    Sending start messageWorkflow service is idle...Press [ENTER] to send an add item message to reactivate the workflow service...
    ```

6. <span data-ttu-id="609b4-214">Um zu überprüfen, ob der Workflow Dienst persistent gespeichert wurde, starten Sie den SQL Server Management Studio, indem Sie im **Startmenü** **Alle Programme**, **Microsoft SQL Server 2008**, **SQL Server Management Studio**auswählen.</span><span class="sxs-lookup"><span data-stu-id="609b4-214">To verify that the workflow service has been persisted, start the SQL Server Management Studio by going to the **Start** menu, Selecting **All Programs**, **Microsoft SQL Server 2008**, **SQL Server Management Studio**.</span></span>

    1. <span data-ttu-id="609b4-215">Erweitern Sie im linken Bereich, **Datenbanken**, **sqlpersistencestore**, **views** , und klicken Sie mit der rechten Maustaste auf **System. Activities. DurableInstancing. Instanzen** , und wählen Sie **oberste 1000 Zeilen auswählen**aus.</span><span class="sxs-lookup"><span data-stu-id="609b4-215">In the left hand pane expand, **Databases**, **SQLPersistenceStore**, **Views** and right click **System.Activities.DurableInstancing.Instances** and select **Select Top 1000 Rows**.</span></span> <span data-ttu-id="609b4-216">Vergewissern Sie sich im **Ergebnis** Bereich, dass mindestens eine Instanz aufgeführt ist.</span><span class="sxs-lookup"><span data-stu-id="609b4-216">In the **Results** pane verify you see at least one instance listed.</span></span> <span data-ttu-id="609b4-217">Es kann sein, dass auch Instanzen früherer Ausführungen aufgelistet sind, wenn Fehler bei der Ausführung aufgetreten sind.</span><span class="sxs-lookup"><span data-stu-id="609b4-217">There may be other instances from prior runs if an exception occurred while running.</span></span> <span data-ttu-id="609b4-218">Sie können vorhandene Zeilen löschen, indem Sie mit der rechten Maustaste auf **System. Activities. DurableInstancing. Instance** klicken und **Oberste 200 Zeilen bearbeiten**auswählen, auf die Schaltfläche **Ausführen** klicken, alle Zeilen im Ergebnisbereich auswählen und dann **Löschen**auswählen.</span><span class="sxs-lookup"><span data-stu-id="609b4-218">You can delete existing rows by right clicking **System.Activities.DurableInstancing.Instances** and selecting **Edit Top 200 rows**, pressing the **Execute** button, selecting all rows in the results pane and selecting **delete**.</span></span>  <span data-ttu-id="609b4-219">Um zu überprüfen, ob in der Datenbank die Instanz angezeigt wird, die von Ihrer Anwendung erstellt wurde, können Sie überprüfen, ob die Ansicht für Instanzen vor Ausführung des Clients leer ist.</span><span class="sxs-lookup"><span data-stu-id="609b4-219">To verify the instance displayed in the database is the instance your application created, verify the instances view is empty prior to running the client.</span></span> <span data-ttu-id="609b4-220">Führen Sie die Abfrage (Oberste 1000 Zeilen auswählen) erneut aus, sobald der Client ausgeführt wird, und überprüfen Sie, ob eine neue Instanz hinzugefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="609b4-220">Once the client is running re-run the query (Select Top 1000 Rows) and verify a new instance has been added.</span></span>

7. <span data-ttu-id="609b4-221">Drücken Sie die EINGABETASTE, um die Nachricht zum Hinzufügen des Artikels an den Workflowdienst zu senden.</span><span class="sxs-lookup"><span data-stu-id="609b4-221">Press enter to send the add item message to the workflow service.</span></span> <span data-ttu-id="609b4-222">Der folgende Text wird vom Client angezeigt:</span><span class="sxs-lookup"><span data-stu-id="609b4-222">The client will display the following text:</span></span>

    ```output
    Sending add item messageService returned: Item added to orderPress any key to continue . . .
    ```

## <a name="see-also"></a><span data-ttu-id="609b4-223">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="609b4-223">See also</span></span>

- [<span data-ttu-id="609b4-224">Workflowdienste</span><span class="sxs-lookup"><span data-stu-id="609b4-224">Workflow Services</span></span>](workflow-services.md)
