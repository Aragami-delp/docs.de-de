---
title: Programmieren der WCF-Sicherheit
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- message security [WCF], programming overview
ms.assetid: 739ec222-4eda-4cc9-a470-67e64a7a3f10
ms.openlocfilehash: 1e82fbb266d3789a8d34109c66d9ee1d8a93c70c
ms.sourcegitcommit: 927b7ea6b2ea5a440c8f23e3e66503152eb85591
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/16/2020
ms.locfileid: "81463823"
---
# <a name="programming-wcf-security"></a><span data-ttu-id="c191a-102">Programmieren der WCF-Sicherheit</span><span class="sxs-lookup"><span data-stu-id="c191a-102">Programming WCF Security</span></span>
<span data-ttu-id="c191a-103">In diesem Thema werden die grundlegenden Programmieraufgaben beschrieben, mit denen eine sichere Windows Communication Foundation (WCF)-Anwendung erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="c191a-103">This topic describes the fundamental programming tasks used to create a secure Windows Communication Foundation (WCF) application.</span></span> <span data-ttu-id="c191a-104">In diesem Thema werden nur Authentifizierung, Vertraulichkeit und Integrität behandelt, die gemeinsam als *Übertragungssicherheit*bezeichnet werden.</span><span class="sxs-lookup"><span data-stu-id="c191a-104">This topic covers only authentication, confidentiality, and integrity, collectively known as *transfer security*.</span></span> <span data-ttu-id="c191a-105">In diesem Thema wird die Autorisierung (die Kontrolle des Zugriffs auf Ressourcen oder Dienste) nicht behandelt. Informationen zur Autorisierung finden Sie unter [Autorisierung](../../../../docs/framework/wcf/feature-details/authorization-in-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="c191a-105">This topic does not cover authorization (the control of access to resources or services); for information on authorization, see [Authorization](../../../../docs/framework/wcf/feature-details/authorization-in-wcf.md).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="c191a-106">Eine wertvolle Einführung in Sicherheitskonzepte, insbesondere in Bezug auf WCF, finden Sie in den Lernprogrammen zu MSDN unter [Szenarien, Muster und Implementierungsleitfaden für Webdiensteerweiterungen (WSE) 3.0](https://docs.microsoft.com/previous-versions/msp-n-p/ff648183(v=pandp.10)).</span><span class="sxs-lookup"><span data-stu-id="c191a-106">For a valuable introduction to security concepts, especially in regard to WCF, see the set of patterns and practices tutorials on MSDN at [Scenarios, Patterns, and Implementation Guidance for Web Services Enhancements (WSE) 3.0](https://docs.microsoft.com/previous-versions/msp-n-p/ff648183(v=pandp.10)).</span></span>  
  
 <span data-ttu-id="c191a-107">Die Programmierung der WCF-Sicherheit basiert auf drei Schritten, in die Folgendes gesetzt wird: der Sicherheitsmodus, ein Clientanmeldeinformationstyp und die Anmeldeinformationswerte.</span><span class="sxs-lookup"><span data-stu-id="c191a-107">Programming WCF security is based on three steps setting the following: the security mode, a client credential type, and the credential values.</span></span> <span data-ttu-id="c191a-108">Sie können diese Schritte durch Code oder die Konfiguration durchführen.</span><span class="sxs-lookup"><span data-stu-id="c191a-108">You can perform these steps either through code or configuration.</span></span>  
  
## <a name="setting-the-security-mode"></a><span data-ttu-id="c191a-109">Festlegen des Sicherheitsmodus</span><span class="sxs-lookup"><span data-stu-id="c191a-109">Setting the Security Mode</span></span>  
 <span data-ttu-id="c191a-110">Im Folgenden werden die allgemeinen Schritte für die Programmierung mit dem Sicherheitsmodus in WCF erläutert:</span><span class="sxs-lookup"><span data-stu-id="c191a-110">The following explains the general steps for programming with the security mode in WCF:</span></span>  
  
1. <span data-ttu-id="c191a-111">Wählen Sie eine der vordefinierten Bindungen, die den Anwendungsanforderungen entsprechen.</span><span class="sxs-lookup"><span data-stu-id="c191a-111">Select one of the predefined bindings appropriate to your application requirements.</span></span> <span data-ttu-id="c191a-112">Eine Liste der Bindungsoptionen finden Sie unter [System-Provided Bindings](../../../../docs/framework/wcf/system-provided-bindings.md).</span><span class="sxs-lookup"><span data-stu-id="c191a-112">For a list of the binding choices, see [System-Provided Bindings](../../../../docs/framework/wcf/system-provided-bindings.md).</span></span> <span data-ttu-id="c191a-113">Standardmäßig ist beinahe jede Bindung sicherheitsaktiviert.</span><span class="sxs-lookup"><span data-stu-id="c191a-113">By default, nearly every binding has security enabled.</span></span> <span data-ttu-id="c191a-114">Die einzige Ausnahme <xref:System.ServiceModel.BasicHttpBinding> ist die Klasse (unter Verwendung der Konfiguration, der [ \<grundlegendenHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md)).</span><span class="sxs-lookup"><span data-stu-id="c191a-114">The one exception is the <xref:System.ServiceModel.BasicHttpBinding> class (using configuration, the [\<basicHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md)).</span></span>  
  
     <span data-ttu-id="c191a-115">Durch die von Ihnen ausgewählte Bindung bestimmen Sie auch den Transport.</span><span class="sxs-lookup"><span data-stu-id="c191a-115">The binding you select determines the transport.</span></span> <span data-ttu-id="c191a-116"><xref:System.ServiceModel.WSHttpBinding> verwendet beispielsweise HTTP als Transportmethode, <xref:System.ServiceModel.NetTcpBinding> verwendet TCP.</span><span class="sxs-lookup"><span data-stu-id="c191a-116">For example, <xref:System.ServiceModel.WSHttpBinding> uses HTTP as the transport; <xref:System.ServiceModel.NetTcpBinding> uses TCP.</span></span>  
  
2. <span data-ttu-id="c191a-117">Wählen Sie einen der Sicherheitsmodi für die Bindung aus.</span><span class="sxs-lookup"><span data-stu-id="c191a-117">Select one of the security modes for the binding.</span></span> <span data-ttu-id="c191a-118">Beachten Sie, dass die von Ihnen ausgewählte Bindung auch die Verfügbarkeit der Modi beeinflusst.</span><span class="sxs-lookup"><span data-stu-id="c191a-118">Note that the binding you select determines the available mode choices.</span></span> <span data-ttu-id="c191a-119">Die <xref:System.ServiceModel.WSDualHttpBinding> ermöglicht beispielsweise keine Transportsicherheit. (Sie steht nicht als Option zur Verfügung.)</span><span class="sxs-lookup"><span data-stu-id="c191a-119">For example, the <xref:System.ServiceModel.WSDualHttpBinding> does not allow transport security (it is not an option).</span></span> <span data-ttu-id="c191a-120">Auf ähnliche Weise ermöglichen weder <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> noch <xref:System.ServiceModel.NetNamedPipeBinding> die Nachrichtensicherheit.</span><span class="sxs-lookup"><span data-stu-id="c191a-120">Similarly, neither the <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> nor the <xref:System.ServiceModel.NetNamedPipeBinding> allows message security.</span></span>  
  
     <span data-ttu-id="c191a-121">Sie haben drei Möglichkeiten:</span><span class="sxs-lookup"><span data-stu-id="c191a-121">You have three choices:</span></span>  
  
    1. `Transport`  
  
         <span data-ttu-id="c191a-122">Die Transportsicherheit ist vom Mechanismus abhängig, den die ausgewählte Bindung verwendet.</span><span class="sxs-lookup"><span data-stu-id="c191a-122">Transport security depends on the mechanism that the binding you have selected uses.</span></span> <span data-ttu-id="c191a-123">Wenn Sie beispielsweise `WSHttpBinding` verwenden, wird als Sicherheitsmechanismus Secure Sockets Layer (SSL) verwendet, was auch der Mechanismus für das HTTPS-Protokoll ist.</span><span class="sxs-lookup"><span data-stu-id="c191a-123">For example, if you are using `WSHttpBinding` then the security mechanism is Secure Sockets Layer (SSL) (also the mechanism for the HTTPS protocol).</span></span> <span data-ttu-id="c191a-124">Der Hauptvorteil der Transportsicherheit besteht im Allgemeinen darin, dass sie unabhängig von der Transportmethode einen guten Durchsatz ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="c191a-124">Generally speaking, the main advantage of transport security is that it delivers good throughput no matter which transport you are using.</span></span> <span data-ttu-id="c191a-125">Es gibt jedoch zwei Einschränkungen: Der Transportmechanismus bestimmt den Anmeldeinformationstyp, der zum Authentifizieren eines Benutzers verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="c191a-125">However, it does have two limitations: The first is that the transport mechanism dictates the credential type used to authenticate a user.</span></span> <span data-ttu-id="c191a-126">Dies ist jedoch nur dann von Nachteil, wenn ein Dienst mit anderen Diensten zusammenarbeiten muss, für die unterschiedliche Anmeldeinformationstypen notwendig sind.</span><span class="sxs-lookup"><span data-stu-id="c191a-126">This is a drawback only if a service needs to interoperate with other services that demand different types of credentials.</span></span> <span data-ttu-id="c191a-127">Darüber hinaus wird die Sicherheit nicht auf Nachrichtenebene angewendet, vielmehr wird die Sicherheit per Hop-by-Hop-Methode anstelle einer End-to-End-Methode implementiert.</span><span class="sxs-lookup"><span data-stu-id="c191a-127">The second is that, because the security is not applied at the message level, security is implemented in a hop-by-hop manner rather than end-to-end.</span></span> <span data-ttu-id="c191a-128">Diese zweite Einschränkung ist nur dann ein Problem, wenn der Nachrichtenpfad zwischen Client und Dienst Vermittler umfasst.</span><span class="sxs-lookup"><span data-stu-id="c191a-128">This latter limitation is an issue only if the message path between client and service includes intermediaries.</span></span> <span data-ttu-id="c191a-129">Weitere Informationen zu dem zu verwendenden Transport finden Sie unter [Auswählen eines Transports](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).</span><span class="sxs-lookup"><span data-stu-id="c191a-129">For more information about which transport to use, see [Choosing a Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).</span></span> <span data-ttu-id="c191a-130">Weitere Informationen zur Verwendung der Transportsicherheit finden Sie unter [Übersicht zur Transportsicherheit](../../../../docs/framework/wcf/feature-details/transport-security-overview.md).</span><span class="sxs-lookup"><span data-stu-id="c191a-130">For more information about using transport security, see [Transport Security Overview](../../../../docs/framework/wcf/feature-details/transport-security-overview.md).</span></span>  
  
    2. `Message`  
  
         <span data-ttu-id="c191a-131">Nachrichtensicherheit bedeutet, dass jede Nachricht die notwendigen Header und Daten enthält, um die Nachricht zu sichern.</span><span class="sxs-lookup"><span data-stu-id="c191a-131">Message security means that every message includes the necessary headers and data to keep the message secure.</span></span> <span data-ttu-id="c191a-132">Da die Struktur der Header unterschiedlich ist, können Sie beliebig viele Anmeldeinformationen umfassen.</span><span class="sxs-lookup"><span data-stu-id="c191a-132">Because the composition of the headers varies, you can include any number of credentials.</span></span> <span data-ttu-id="c191a-133">Dies spielt eine Rolle, wenn Sie mit anderen Diensten zusammenarbeiten, die einen bestimmten Anmeldeinformationstyp erfordern, den ein Transportmechanismus nicht bereitstellen kann, oder wenn die Nachricht mit mehr als einem Dienst verwendet werden muss, wobei jeder Dienst einen unterschiedlichen Anmeldeinformationstyp erfordert.</span><span class="sxs-lookup"><span data-stu-id="c191a-133">This becomes a factor if you are interoperating with other services that demand a specific credential type that a transport mechanism can't supply, or if the message must be used with more than one service, where each service demands a different credential type.</span></span>  
  
         <span data-ttu-id="c191a-134">Weitere Informationen finden Sie unter [Nachrichtensicherheit](../../../../docs/framework/wcf/feature-details/message-security-in-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="c191a-134">For more information, see [Message Security](../../../../docs/framework/wcf/feature-details/message-security-in-wcf.md).</span></span>  
  
    3. `TransportWithMessageCredential`  
  
         <span data-ttu-id="c191a-135">Diese Auswahl verwendet die Transportschicht, um die Nachrichtenübertragung zu sichern, während jede Nachricht die komplexen Anmeldeinformationen enthält, die andere Dienste benötigen.</span><span class="sxs-lookup"><span data-stu-id="c191a-135">This choice uses the transport layer to secure the message transfer, while every message includes the rich credentials other services need.</span></span> <span data-ttu-id="c191a-136">Dadurch wird der Leistungsvorteil der Transportsicherheit mit dem Vorteil komplexer Anmeldeinformationen der Nachrichtensicherheit kombiniert.</span><span class="sxs-lookup"><span data-stu-id="c191a-136">This combines the performance advantage of transport security with the rich credentials advantage of message security.</span></span> <span data-ttu-id="c191a-137">Dies ist mit den folgenden Bindungen verfügbar: <xref:System.ServiceModel.BasicHttpBinding>, <xref:System.ServiceModel.WSFederationHttpBinding>, <xref:System.ServiceModel.NetPeerTcpBinding> und <xref:System.ServiceModel.WSHttpBinding>.</span><span class="sxs-lookup"><span data-stu-id="c191a-137">This is available with the following bindings: <xref:System.ServiceModel.BasicHttpBinding>, <xref:System.ServiceModel.WSFederationHttpBinding>, <xref:System.ServiceModel.NetPeerTcpBinding>, and <xref:System.ServiceModel.WSHttpBinding>.</span></span>  
  
3. <span data-ttu-id="c191a-138">Wenn Sie für HTTP eine Transportsicherheit verwenden möchten (d. h. HTTPS), müssen Sie auch den Host mit einem SSL-Zertifikat konfigurieren und SSL auf einem Port aktivieren.</span><span class="sxs-lookup"><span data-stu-id="c191a-138">If you decide to use transport security for HTTP (in other words, HTTPS), you must also configure the host with an SSL certificate and enable SSL on a port.</span></span> <span data-ttu-id="c191a-139">Weitere Informationen finden Sie unter [HTTP Transport Security](../../../../docs/framework/wcf/feature-details/http-transport-security.md).</span><span class="sxs-lookup"><span data-stu-id="c191a-139">For more information, see [HTTP Transport Security](../../../../docs/framework/wcf/feature-details/http-transport-security.md).</span></span>  
  
4. <span data-ttu-id="c191a-140">Wenn Sie <xref:System.ServiceModel.WSHttpBinding> verwenden und keine sichere Sitzung einrichten müssen, legen Sie für die <xref:System.ServiceModel.NonDualMessageSecurityOverHttp.EstablishSecurityContext%2A>-Eigenschaft den Wert `false` fest.</span><span class="sxs-lookup"><span data-stu-id="c191a-140">If you are using the <xref:System.ServiceModel.WSHttpBinding> and do not need to establish a secure session, set the <xref:System.ServiceModel.NonDualMessageSecurityOverHttp.EstablishSecurityContext%2A> property to `false`.</span></span>  
  
     <span data-ttu-id="c191a-141">Eine sichere Sitzung entsteht, wenn ein Client und ein Dienst einen Kanal mithilfe eines symmetrischen Schlüssels erstellen (sowohl Client als auch Server verwenden den gleichen Schlüssel für die Dauer einer Konversation und bis der Dialog geschlossen wird).</span><span class="sxs-lookup"><span data-stu-id="c191a-141">A secure session occurs when a client and service create a channel using a symmetric key (both client and server use the same key for the length of a conversation, until the dialog is closed).</span></span>  
  
## <a name="setting-the-client-credential-type"></a><span data-ttu-id="c191a-142">Festlegen des Clientanmeldeinformationstyps</span><span class="sxs-lookup"><span data-stu-id="c191a-142">Setting the Client Credential Type</span></span>  
 <span data-ttu-id="c191a-143">Wählen Sie wie erforderlich einen Clientanmeldeinformationstyp aus.</span><span class="sxs-lookup"><span data-stu-id="c191a-143">Select a client credential type as appropriate.</span></span> <span data-ttu-id="c191a-144">Weitere Informationen finden Sie unter [Auswählen eines Anmeldeinformationstyps](../../../../docs/framework/wcf/feature-details/selecting-a-credential-type.md).</span><span class="sxs-lookup"><span data-stu-id="c191a-144">For more information, see [Selecting a Credential Type](../../../../docs/framework/wcf/feature-details/selecting-a-credential-type.md).</span></span> <span data-ttu-id="c191a-145">Die folgenden Clientanmeldeinformationstypen sind verfügbar:</span><span class="sxs-lookup"><span data-stu-id="c191a-145">The following client credential types are available:</span></span>  
  
- `Windows`  
  
- `Certificate`  
  
- `Digest`  
  
- `Basic`  
  
- `UserName`  
  
- `NTLM`  
  
- `IssuedToken`  
  
 <span data-ttu-id="c191a-146">Die Art und Weise, wie Sie den Modus festlegen, bestimmt auch die Festlegung des Anmeldeinformationstyps.</span><span class="sxs-lookup"><span data-stu-id="c191a-146">Depending on how you set the mode, you must set the credential type.</span></span> <span data-ttu-id="c191a-147">Wenn Sie beispielsweise `wsHttpBinding` ausgewählt haben und als Modus "Message" festgelegt haben, können Sie auch das `clientCredentialType`-Attribut des Nachrichtenelements auf einen der folgenden Werte festlegen: `None`, `Windows`, `UserName`, `Certificate` und `IssuedToken`, wie im folgenden Konfigurationsbeispiel gezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="c191a-147">For example, if you have selected the `wsHttpBinding`, and have set the mode to "Message," then you can also set the `clientCredentialType` attribute of the Message element to one of the following values: `None`, `Windows`, `UserName`, `Certificate`, and `IssuedToken`, as shown in the following configuration example.</span></span>  
  
```xml  
<system.serviceModel>  
<bindings>  
  <wsHttpBinding>  
    <binding name="myBinding">  
      <security mode="Message"/>  
      <message clientCredentialType="Windows"/>  
    </binding>
  </wsHttpBinding>
</bindings>  
</system.serviceModel>  
```  
  
 <span data-ttu-id="c191a-148">Oder in Code:</span><span class="sxs-lookup"><span data-stu-id="c191a-148">Or in code:</span></span>  
  
 [!code-csharp[c_WsHttpService#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_wshttpservice/cs/source.cs#1)]
 [!code-vb[c_WsHttpService#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_wshttpservice/vb/source.vb#1)]  
  
## <a name="setting-service-credential-values"></a><span data-ttu-id="c191a-149">Festlegen von Dienstanmeldeinformationswerten</span><span class="sxs-lookup"><span data-stu-id="c191a-149">Setting Service Credential Values</span></span>  
 <span data-ttu-id="c191a-150">Nachdem Sie einen Dienstanmeldeinformationstyp ausgewählt haben, müssen Sie die tatsächlichen Anmeldeinformationen für den zu verwendenden Dienst und Client festlegen.</span><span class="sxs-lookup"><span data-stu-id="c191a-150">Once you select a client credential type, you must set the actual credentials for the service and client to use.</span></span> <span data-ttu-id="c191a-151">Für den Dienst werden die Anmeldeinformationen mit der <xref:System.ServiceModel.Description.ServiceCredentials>-Klasse festgelegt und von der <xref:System.ServiceModel.ServiceHostBase.Credentials%2A>-Eigenschaft der <xref:System.ServiceModel.ServiceHostBase>-Klasse zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="c191a-151">On the service, credentials are set using the <xref:System.ServiceModel.Description.ServiceCredentials> class and returned by the <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> property of the <xref:System.ServiceModel.ServiceHostBase> class.</span></span> <span data-ttu-id="c191a-152">Die verwendete Bindung gibt den Dienstanmeldeinformationstyp, den ausgewählten Sicherheitsmodus und den Typ der Clientanmeldeinformationen an.</span><span class="sxs-lookup"><span data-stu-id="c191a-152">The binding in use implies the service credential type, the security mode chosen, and the type of the client credential.</span></span> <span data-ttu-id="c191a-153">Mit dem folgenden Code wird ein Zertifikat für die Dienstanmeldeinformationen festgelegt:</span><span class="sxs-lookup"><span data-stu-id="c191a-153">The following code sets a certificate for a service credential.</span></span>  
  
 [!code-csharp[c_tcpService#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_tcpservice/cs/source.cs#3)]
 [!code-vb[c_tcpService#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_tcpservice/vb/source.vb#3)]  
  
## <a name="setting-client-credential-values"></a><span data-ttu-id="c191a-154">Festlegen der Werte der Clientanmeldeinformationen</span><span class="sxs-lookup"><span data-stu-id="c191a-154">Setting Client Credential Values</span></span>  
 <span data-ttu-id="c191a-155">Für den Client werden die Clientanmeldeinformationswerte mit der <xref:System.ServiceModel.Description.ClientCredentials>-Klasse festgelegt und von der <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A>-Eigenschaft der <xref:System.ServiceModel.ClientBase%601>-Klasse zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="c191a-155">On the client, set client credential values using the <xref:System.ServiceModel.Description.ClientCredentials> class and returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class.</span></span> <span data-ttu-id="c191a-156">Mit dem folgenden Code wird ein Zertifikat als Anmeldeinformationen auf einem Client mit dem TCP-Protokoll festgelegt.</span><span class="sxs-lookup"><span data-stu-id="c191a-156">The following code sets a certificate as a credential on a client using the TCP protocol.</span></span>  
  
 [!code-csharp[c_TcpClient#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_tcpclient/cs/source.cs#1)]
 [!code-vb[c_TcpClient#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_tcpclient/vb/source.vb#1)]  
  
## <a name="see-also"></a><span data-ttu-id="c191a-157">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="c191a-157">See also</span></span>

- [<span data-ttu-id="c191a-158">Basis-WCF-Programmierung</span><span class="sxs-lookup"><span data-stu-id="c191a-158">Basic WCF Programming</span></span>](../../../../docs/framework/wcf/basic-wcf-programming.md)
- [<span data-ttu-id="c191a-159">Häufige Sicherheitsszenarien</span><span class="sxs-lookup"><span data-stu-id="c191a-159">Common Security Scenarios</span></span>](../../../../docs/framework/wcf/feature-details/common-security-scenarios.md)
