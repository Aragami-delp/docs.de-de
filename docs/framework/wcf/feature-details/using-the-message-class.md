---
title: Verwenden der Message-Klasse
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: d1d62bfb-2aa3-4170-b6f8-c93d3afdbbed
ms.openlocfilehash: 142578ef76a70fed27dc0137378b59e228cd25c9
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 06/09/2020
ms.locfileid: "84585648"
---
# <a name="using-the-message-class"></a><span data-ttu-id="e7f12-102">Verwenden der Message-Klasse</span><span class="sxs-lookup"><span data-stu-id="e7f12-102">Using the Message Class</span></span>
<span data-ttu-id="e7f12-103">Die- <xref:System.ServiceModel.Channels.Message> Klasse ist für Windows Communication Foundation (WCF) von grundlegender Bedeutung.</span><span class="sxs-lookup"><span data-stu-id="e7f12-103">The <xref:System.ServiceModel.Channels.Message> class is fundamental to Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="e7f12-104">Die gesamte Kommunikation zwischen Clients und Diensten führt letztlich zu gesendeten und empfangenen <xref:System.ServiceModel.Channels.Message>-Instanzen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-104">All communication between clients and services ultimately results in <xref:System.ServiceModel.Channels.Message> instances being sent and received.</span></span>  
  
 <span data-ttu-id="e7f12-105">Sie würden normalerweise nicht direkt mit der <xref:System.ServiceModel.Channels.Message>-Klasse interagieren.</span><span class="sxs-lookup"><span data-stu-id="e7f12-105">You would not usually interact with the <xref:System.ServiceModel.Channels.Message> class directly.</span></span> <span data-ttu-id="e7f12-106">Stattdessen werden WCF-Dienst modellkonstrukte, z. b. Datenverträge, Nachrichten Verträge und Vorgangs Verträge, verwendet, um eingehende und ausgehende Nachrichten zu beschreiben.</span><span class="sxs-lookup"><span data-stu-id="e7f12-106">Instead, WCF service model constructs, such as data contracts, message contracts, and operation contracts, are used to describe incoming and outgoing messages.</span></span> <span data-ttu-id="e7f12-107">In einigen komplexen Szenarien können Sie jedoch direkt mit der <xref:System.ServiceModel.Channels.Message>-Klasse programmieren.</span><span class="sxs-lookup"><span data-stu-id="e7f12-107">However, in some advanced scenarios you can program using the <xref:System.ServiceModel.Channels.Message> class directly.</span></span> <span data-ttu-id="e7f12-108">Die Verwendung der <xref:System.ServiceModel.Channels.Message>-Klasse kann beispielsweise in den folgenden Fällen erforderlich sein:</span><span class="sxs-lookup"><span data-stu-id="e7f12-108">For example, you might want to use the <xref:System.ServiceModel.Channels.Message> class:</span></span>  
  
- <span data-ttu-id="e7f12-109">Wenn Sie eine alternative Möglichkeit zum Erstellen von ausgehenden Nachrichten Inhalten benötigen (z. b. das Erstellen einer Nachricht direkt aus einer Datei auf einem Datenträger), anstatt .NET Framework Objekte zu serialisieren.</span><span class="sxs-lookup"><span data-stu-id="e7f12-109">When you need an alternative way of creating outgoing message contents (for example, creating a message directly from a file on disk) instead of serializing .NET Framework objects.</span></span>  
  
- <span data-ttu-id="e7f12-110">Wenn Sie eine alternative Methode zur Verwendung eingehender Nachrichteninhalte benötigen (z. b. Wenn Sie eine XSLT-Transformation auf den unformatierten XML-Inhalt anwenden möchten), anstatt Sie in .NET Framework Objekte zu deserialisieren.</span><span class="sxs-lookup"><span data-stu-id="e7f12-110">When you need an alternative way of using incoming message contents (for example, when you want to apply an XSLT transformation to the raw XML contents) instead of deserializing into .NET Framework objects.</span></span>  
  
- <span data-ttu-id="e7f12-111">Wenn Sie Nachrichten allgemein und unabhängig vom Nachrichteninhalt bearbeiten müssen (z. B. zum Routen oder Weiterleiten von Nachrichten beim Erstellen eines Routers, Lastenausgleichsmoduls oder Veröffentlichen-Abonnieren-Systems).</span><span class="sxs-lookup"><span data-stu-id="e7f12-111">When you need to deal with messages in a general way regardless of message contents (for example, when routing or forwarding messages when building a router, load-balancer, or a publish-subscribe system).</span></span>  
  
 <span data-ttu-id="e7f12-112">Machen Sie sich vor der Verwendung der- <xref:System.ServiceModel.Channels.Message> Klasse mit der WCF-Datenübertragungs Architektur in [Datenübertragung Übersicht über die Architektur](data-transfer-architectural-overview.md)vertraut.</span><span class="sxs-lookup"><span data-stu-id="e7f12-112">Before using the <xref:System.ServiceModel.Channels.Message> class, familiarize yourself with the WCF data transfer architecture in [Data Transfer Architectural Overview](data-transfer-architectural-overview.md).</span></span>  
  
 <span data-ttu-id="e7f12-113">Eine <xref:System.ServiceModel.Channels.Message> ist ein Allzweckcontainer für Daten, ihr Design folgt aber eng dem Design einer Nachricht im SOAP-Protokoll.</span><span class="sxs-lookup"><span data-stu-id="e7f12-113">A <xref:System.ServiceModel.Channels.Message> is a general-purpose container for data, but its design closely follows the design of a message in the SOAP protocol.</span></span> <span data-ttu-id="e7f12-114">Wie in SOAP verfügt eine Nachricht über einen Nachrichtentext und einen Header.</span><span class="sxs-lookup"><span data-stu-id="e7f12-114">Just like in SOAP, a message has both a message body and headers.</span></span> <span data-ttu-id="e7f12-115">Der Nachrichtentext enthält die tatsächlichen Nutzlastdaten, während die Header zusätzliche benannte Datencontainer enthalten.</span><span class="sxs-lookup"><span data-stu-id="e7f12-115">The message body contains the actual payload data, while the headers contain additional named data containers.</span></span> <span data-ttu-id="e7f12-116">Die Regeln für das Lesen und Schreiben von Text und Headern sind unterschiedlich, so werden die Header immer im Arbeitsspeicher gepuffert, und der Zugriff ist beliebig oft in beliebiger Reihenfolge möglich, während der Text nur einmal gelesen und in einem Stream übertragen werden kann.</span><span class="sxs-lookup"><span data-stu-id="e7f12-116">The rules for reading and writing the body and the headers are different, for example, the headers are always buffered in memory and may be accessed in any order any number of times, while the body may be read only once and may be streamed.</span></span> <span data-ttu-id="e7f12-117">Normalerweise werden in SOAP der Nachrichtentext dem SOAP-Text und die Nachrichtenheader den SOAP-Headern zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="e7f12-117">Normally, when using SOAP, the message body is mapped to the SOAP body and the message headers are mapped to the SOAP headers.</span></span>  
  
## <a name="using-the-message-class-in-operations"></a><span data-ttu-id="e7f12-118">Verwenden der Meldungsklasse in Vorgängen</span><span class="sxs-lookup"><span data-stu-id="e7f12-118">Using the Message Class in Operations</span></span>  
 <span data-ttu-id="e7f12-119">Sie können die <xref:System.ServiceModel.Channels.Message>-Klasse als Eingabeparameter eines Vorgangs, als den Rückgabewert eines Vorgangs oder beides verwenden.</span><span class="sxs-lookup"><span data-stu-id="e7f12-119">You can use the <xref:System.ServiceModel.Channels.Message> class as an input parameter of an operation, the return value of an operation, or both.</span></span> <span data-ttu-id="e7f12-120">Wenn <xref:System.ServiceModel.Channels.Message> an einer Stelle in einem Vorgang verwendet wird, gelten die folgenden Einschränkungen:</span><span class="sxs-lookup"><span data-stu-id="e7f12-120">If <xref:System.ServiceModel.Channels.Message> is used anywhere in an operation, the following restrictions apply:</span></span>  
  
- <span data-ttu-id="e7f12-121">Der Vorgang kann über keinen `out`-Parameter oder `ref`-Parameter verfügen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-121">The operation cannot have any `out` or `ref` parameters.</span></span>  
  
- <span data-ttu-id="e7f12-122">Es kann nicht mehr als einen `input`-Parameter geben.</span><span class="sxs-lookup"><span data-stu-id="e7f12-122">There cannot be more than one `input` parameter.</span></span> <span data-ttu-id="e7f12-123">Wenn der Parameter vorhanden ist, muss er entweder eine Nachricht oder ein Nachrichtenvertragstyp sein.</span><span class="sxs-lookup"><span data-stu-id="e7f12-123">If the parameter is present, it must be either Message or a message contract type.</span></span>  
  
- <span data-ttu-id="e7f12-124">Der Rückgabetyp muss entweder `void`, `Message` oder ein Nachrichtenvertragstyp sein.</span><span class="sxs-lookup"><span data-stu-id="e7f12-124">The return type must be either `void`, `Message`, or a message contract type.</span></span>  
  
 <span data-ttu-id="e7f12-125">Das folgende Codebeispiel enthält einen gültigen Vorgangsvertrag.</span><span class="sxs-lookup"><span data-stu-id="e7f12-125">The following code example contains a valid operation contract.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#1)]
 [!code-vb[C_UsingTheMessageClass#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#1)]  
  
## <a name="creating-basic-messages"></a><span data-ttu-id="e7f12-126">Erstellen grundlegender Nachrichten</span><span class="sxs-lookup"><span data-stu-id="e7f12-126">Creating Basic Messages</span></span>  
 <span data-ttu-id="e7f12-127">Die <xref:System.ServiceModel.Channels.Message>-Klasse stellt statische `CreateMessage`-Factorymethoden bereit, mit denen Sie grundlegende Nachrichten erstellen können.</span><span class="sxs-lookup"><span data-stu-id="e7f12-127">The <xref:System.ServiceModel.Channels.Message> class provides static `CreateMessage` factory methods that you can use to create basic messages.</span></span>  
  
 <span data-ttu-id="e7f12-128">Alle `CreateMessage`-Überladungen nehmen einen Versionsparameter vom Typ <xref:System.ServiceModel.Channels.MessageVersion> an, der die für die Nachricht zu verwendende SOAP-Version und Version der WS-Adressierung angibt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-128">All `CreateMessage` overloads take a version parameter of type <xref:System.ServiceModel.Channels.MessageVersion> that indicates the SOAP and WS-Addressing versions to use for the message.</span></span> <span data-ttu-id="e7f12-129">Wenn Sie die gleichen Protokollversionen wie die eingehende Nachricht verwenden möchten, können Sie die <xref:System.ServiceModel.OperationContext.IncomingMessageVersion%2A>-Eigenschaft auf der <xref:System.ServiceModel.OperationContext>-Instanz nutzen, die aus der <xref:System.ServiceModel.OperationContext.Current%2A>-Eigenschaft abgerufen wurde.</span><span class="sxs-lookup"><span data-stu-id="e7f12-129">If you want to use the same protocol versions as the incoming message, you can use the <xref:System.ServiceModel.OperationContext.IncomingMessageVersion%2A> property on the <xref:System.ServiceModel.OperationContext> instance obtained from the <xref:System.ServiceModel.OperationContext.Current%2A> property.</span></span> <span data-ttu-id="e7f12-130">Die meisten `CreateMessage`-Überladungen haben außerdem einen Zeichenfolgenparameter, der die für die Nachricht zu verwendende SOAP-Aktion angibt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-130">Most `CreateMessage` overloads also have a string parameter that indicates the SOAP action to use for the message.</span></span> <span data-ttu-id="e7f12-131">Die Version kann auf `None` festgelegt werden, um die Generierung des SOAP-Umschlags zu deaktivieren; die Nachricht besteht nur aus dem Text.</span><span class="sxs-lookup"><span data-stu-id="e7f12-131">Version can be set to `None` to disable SOAP envelope generation; the message consists of only the body.</span></span>  
  
## <a name="creating-messages-from-objects"></a><span data-ttu-id="e7f12-132">Erstellen von Nachrichten aus Objekten</span><span class="sxs-lookup"><span data-stu-id="e7f12-132">Creating Messages from Objects</span></span>  
 <span data-ttu-id="e7f12-133">Die grundlegendste `CreateMessage`-Überladung, die nur eine Version und eine Aktion annimmt, erstellt eine Nachricht, die keinen Text enthält.</span><span class="sxs-lookup"><span data-stu-id="e7f12-133">The most basic `CreateMessage` overload that takes only a version and an action creates a message with an empty body.</span></span> <span data-ttu-id="e7f12-134">Eine weitere Überladung nimmt einen zusätzlichen <xref:System.Object>-Parameter an; es wird eine Nachricht erstellt, deren Text die serialisierte Darstellung des entsprechenden Objekts ist.</span><span class="sxs-lookup"><span data-stu-id="e7f12-134">Another overload takes an additional <xref:System.Object> parameter; this creates a message whose body is the serialized representation of the given object.</span></span> <span data-ttu-id="e7f12-135">Verwenden Sie das <xref:System.Runtime.Serialization.DataContractSerializer> mit Standardeinstellungen für die Serialisierung.</span><span class="sxs-lookup"><span data-stu-id="e7f12-135">Use the <xref:System.Runtime.Serialization.DataContractSerializer> with default settings for serialization.</span></span> <span data-ttu-id="e7f12-136">Wenn Sie ein anderes Serialisierungsprogramm verwenden möchten oder das `DataContractSerializer` anders konfiguriert werden soll, verwenden Sie die `CreateMessage`-Überladung, die auch einen `XmlObjectSerializer`-Parameter annimmt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-136">If you want to use a different serializer, or you want the `DataContractSerializer` configured differently, use the `CreateMessage` overload that also takes an `XmlObjectSerializer` parameter.</span></span>  
  
 <span data-ttu-id="e7f12-137">Sie können z. B. zum Zurückgeben eines Objekts in einer Nachricht den folgenden Code verwenden.</span><span class="sxs-lookup"><span data-stu-id="e7f12-137">For example, to return an object in a message, you can use the following code.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#2)]
 [!code-vb[C_UsingTheMessageClass#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#2)]  
  
## <a name="creating-messages-from-xml-readers"></a><span data-ttu-id="e7f12-138">Erstellen von Nachrichten aus XML-Lesern</span><span class="sxs-lookup"><span data-stu-id="e7f12-138">Creating Messages from XML Readers</span></span>  
 <span data-ttu-id="e7f12-139">Bestimmte `CreateMessage`-Überladungen nehmen einen <xref:System.Xml.XmlReader> oder einen <xref:System.Xml.XmlDictionaryReader> für den Text anstelle eines Objekts an.</span><span class="sxs-lookup"><span data-stu-id="e7f12-139">There are `CreateMessage` overloads that take an <xref:System.Xml.XmlReader> or an <xref:System.Xml.XmlDictionaryReader> for the body instead of an object.</span></span> <span data-ttu-id="e7f12-140">In diesem Fall enthält der Text der Nachricht die XML, die aus dem Lesen des übergebenen XML-Readers resultiert.</span><span class="sxs-lookup"><span data-stu-id="e7f12-140">In this case, the body of the message contains the XML that results from reading from the passed XML reader.</span></span> <span data-ttu-id="e7f12-141">Der folgende Code gibt beispielsweise eine Nachricht mit aus einer XML-Datei gelesenem Textinhalt zurück:</span><span class="sxs-lookup"><span data-stu-id="e7f12-141">For example, the following code returns a message with body contents read from an XML file.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#3)]
 [!code-vb[C_UsingTheMessageClass#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#3)]  
  
 <span data-ttu-id="e7f12-142">Darüber hinaus gibt es `CreateMessage`-Überladungen, die einen <xref:System.Xml.XmlReader> oder einen <xref:System.Xml.XmlDictionaryReader> annehmen, der die gesamte Nachricht und nicht nur den Text darstellt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-142">Additionally, there are `CreateMessage` overloads that take an <xref:System.Xml.XmlReader> or an <xref:System.Xml.XmlDictionaryReader> that represents the entire message and not just the body.</span></span> <span data-ttu-id="e7f12-143">Diese Überladungen nehmen auch einen ganzzahligen `maxSizeOfHeaders`-Parameter an.</span><span class="sxs-lookup"><span data-stu-id="e7f12-143">These overloads also take an integer `maxSizeOfHeaders` parameter.</span></span> <span data-ttu-id="e7f12-144">Header werden immer in den Arbeitsspeicher gepuffert, sobald die Nachricht erstellt wurde, und dieser Parameter begrenzt die stattfindende Pufferung.</span><span class="sxs-lookup"><span data-stu-id="e7f12-144">Headers are always buffered into memory as soon as the message is created, and this parameter limits the amount of buffering that takes place.</span></span> <span data-ttu-id="e7f12-145">Dieser Parameter sollte auf einen sicheren Wert festgelegt werden, wenn die XML von einer nicht vertrauenswürdigen Quelle stammt, um einen möglichen Denial-of-Service-Angriff zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="e7f12-145">It is important to set this parameter to a safe value if the XML is coming from an untrusted source to mitigate the possibility of a denial of service attack.</span></span> <span data-ttu-id="e7f12-146">Die SOAP-Version und die Version der WS-Adressierung der Nachricht, die der XML-Leser darstellt, müssen mit den durch den Versionsparameter angegebenen Versionen übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-146">The SOAP and WS-Addressing versions of the message the XML reader represents must match the versions indicated using the version parameter.</span></span>  
  
## <a name="creating-messages-with-bodywriter"></a><span data-ttu-id="e7f12-147">Erstellen von Nachrichten mit dem Body Writer-Objekt</span><span class="sxs-lookup"><span data-stu-id="e7f12-147">Creating Messages with BodyWriter</span></span>  
 <span data-ttu-id="e7f12-148">Eine `CreateMessage`-Überladung nimmt eine `BodyWriter`-Instanz an, um den Text der Nachricht zu beschreiben.</span><span class="sxs-lookup"><span data-stu-id="e7f12-148">One `CreateMessage` overload takes a `BodyWriter` instance to describe the body of the message.</span></span> <span data-ttu-id="e7f12-149">Ein `BodyWriter` ist eine abstrakte Klasse, die abgeleitet werden kann, um das Erstellen von Nachrichtentexten anzupassen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-149">A `BodyWriter` is an abstract class that can be derived to customize how message bodies are created.</span></span> <span data-ttu-id="e7f12-150">Sie können eine eigene abgeleitete `BodyWriter`-Klasse erstellen, um Nachrichtentexte benutzerdefiniert zu beschreiben.</span><span class="sxs-lookup"><span data-stu-id="e7f12-150">You can create your own `BodyWriter` derived class to describe message bodies in a custom way.</span></span> <span data-ttu-id="e7f12-151">Sie müssen die `BodyWriter.OnWriteBodyContents`-Methode überschreiben, die einen <xref:System.Xml.XmlDictionaryWriter> annimmt; diese Methode ist für das Schreiben des Textes zuständig.</span><span class="sxs-lookup"><span data-stu-id="e7f12-151">You must override the `BodyWriter.OnWriteBodyContents` method that takes an <xref:System.Xml.XmlDictionaryWriter>; this method is responsible for writing out the body.</span></span>  
  
 <span data-ttu-id="e7f12-152">Body Writer-Objekte können gepuffert oder nicht gepuffert (gestreamt) sein.</span><span class="sxs-lookup"><span data-stu-id="e7f12-152">Body writers can be buffered or non-buffered (streamed).</span></span> <span data-ttu-id="e7f12-153">Gepufferte Body Writer-Objekte schreiben ihren Inhalt beliebig oft, während gestreamte Objekte den Inhalt nur einmal schreiben können.</span><span class="sxs-lookup"><span data-stu-id="e7f12-153">Buffered body writers can write out their contents any number of times, while streamed ones can write out their contents only once.</span></span> <span data-ttu-id="e7f12-154">Die `IsBuffered`-Eigenschaft gibt an, ob ein Body Writer-Objekt gepuffert ist oder nicht.</span><span class="sxs-lookup"><span data-stu-id="e7f12-154">The `IsBuffered` property indicates whether a body writer is buffered or not.</span></span> <span data-ttu-id="e7f12-155">Sie können dies für das Body Writer-Objekt festlegen, indem Sie den geschützten `BodyWriter`-Konstruktor aufrufen, der einen booleschen `isBuffered`-Parameter annimmt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-155">You can set this for your body writer by calling the protected `BodyWriter` constructor that takes an `isBuffered` boolean parameter.</span></span> <span data-ttu-id="e7f12-156">Body Writer-Objekte unterstützen das Erstellen eines gepufferten Body Writer-Objekts aus einem nicht gepufferten Body Writer-Objekt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-156">Body writers support creating a buffered body writer from a non-buffered body writer.</span></span> <span data-ttu-id="e7f12-157">Sie können die `OnCreateBufferedCopy`-Methode überschreiben, um diesen Prozess anzupassen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-157">You can override the `OnCreateBufferedCopy` method to customize this process.</span></span> <span data-ttu-id="e7f12-158">Standardmäßig wird ein Speicherpuffer verwendet, der das von `OnWriteBodyContents` zurückgegebene XML enthält.</span><span class="sxs-lookup"><span data-stu-id="e7f12-158">By default, an in-memory buffer that contains the XML returned by `OnWriteBodyContents` is used.</span></span> <span data-ttu-id="e7f12-159">`OnCreateBufferedCopy` akzeptiert einen ganzzahligen `maxBufferSize`-Parameter. Wenn Sie diese Methode überschreiben, dürfen Sie keine Puffer erstellen, die diese maximale Größe überschreiten.</span><span class="sxs-lookup"><span data-stu-id="e7f12-159">`OnCreateBufferedCopy` takes a `maxBufferSize` integer parameter; if you override this method, you must not create buffers larger than this maximum size.</span></span>  
  
 <span data-ttu-id="e7f12-160">Die `BodyWriter`-Klasse bietet die `WriteBodyContents`-Methode und die `CreateBufferedCopy`-Methode, die im Grunde einfache Wrapper um die `OnWriteBodyContents`-Methode bzw. die `OnCreateBufferedCopy`-Methode sind.</span><span class="sxs-lookup"><span data-stu-id="e7f12-160">The `BodyWriter` class provides the `WriteBodyContents` and `CreateBufferedCopy` methods, which are essentially thin wrappers around `OnWriteBodyContents` and `OnCreateBufferedCopy` methods, respectively.</span></span> <span data-ttu-id="e7f12-161">Diese Methoden führen eine Zustandsprüfung durch, um sicherzustellen, dass auf ein nicht gepuffertes Body Writer-Objekt höchstens einmal zugegriffen wird.</span><span class="sxs-lookup"><span data-stu-id="e7f12-161">These methods perform state checking to ensure that a non-buffered body writer is not accessed more than once.</span></span> <span data-ttu-id="e7f12-162">Diese Methoden werden nur direkt aufgerufen, wenn benutzerdefinierte abgeleitete `Message`-Klassen erstellt werden, die auf `BodyWriters` basieren.</span><span class="sxs-lookup"><span data-stu-id="e7f12-162">These methods are called directly only when creating custom `Message` derived classes based on `BodyWriters`.</span></span>  
  
## <a name="creating-fault-messages"></a><span data-ttu-id="e7f12-163">Erstellen von Fehlermeldungen</span><span class="sxs-lookup"><span data-stu-id="e7f12-163">Creating Fault Messages</span></span>  
 <span data-ttu-id="e7f12-164">Sie können bestimmte `CreateMessage`-Überladungen verwenden, um SOAP-Fehlermeldungen zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-164">You can use certain `CreateMessage` overloads to create SOAP fault messages.</span></span> <span data-ttu-id="e7f12-165">Die grundlegendste dieser Überladungen nimmt ein <xref:System.ServiceModel.Channels.MessageFault>-Objekt an, das den Fehler beschreibt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-165">The most basic of these takes a <xref:System.ServiceModel.Channels.MessageFault> object that describes the fault.</span></span> <span data-ttu-id="e7f12-166">Andere Überladungen werden aus Gründen der Benutzerfreundlichkeit bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-166">Other overloads are provided for convenience.</span></span> <span data-ttu-id="e7f12-167">Die erste solcher Überladungen nimmt einen `FaultCode` und eine Zeichenfolge der Ursache an und erstellt einen `MessageFault` mit `MessageFault.CreateFault` unter Verwendung dieser Informationen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-167">The first such overload takes a `FaultCode` and a reason string and creates a `MessageFault` using `MessageFault.CreateFault` using this information.</span></span> <span data-ttu-id="e7f12-168">Die andere Überladung nimmt eine Detailobjekt an und übergibt es auch zusammen mit dem Fehlercode und der Ursache an `CreateFault`.</span><span class="sxs-lookup"><span data-stu-id="e7f12-168">The other overload takes a detail object and also passes it to `CreateFault` together with the fault code and the reason.</span></span> <span data-ttu-id="e7f12-169">So gibt beispielsweise der folgende Vorgang einen Fehler zurück:</span><span class="sxs-lookup"><span data-stu-id="e7f12-169">For example, the following operation returns a fault.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#4)]
 [!code-vb[C_UsingTheMessageClass#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#4)]  
  
## <a name="extracting-message-body-data"></a><span data-ttu-id="e7f12-170">Extrahieren von Nachrichtentextdaten</span><span class="sxs-lookup"><span data-stu-id="e7f12-170">Extracting Message Body Data</span></span>  
 <span data-ttu-id="e7f12-171">Die `Message`-Klasse unterstützt mehrere Methoden zum Extrahieren von Informationen aus dem Text.</span><span class="sxs-lookup"><span data-stu-id="e7f12-171">The `Message` class supports multiple ways of extracting information from its body.</span></span> <span data-ttu-id="e7f12-172">Diese können in die folgenden Kategorien klassifiziert werden:</span><span class="sxs-lookup"><span data-stu-id="e7f12-172">These can be classified into the following categories:</span></span>  
  
- <span data-ttu-id="e7f12-173">Einmaliges Abrufen des gesamten Nachrichtentexts in einen XML-Writer.</span><span class="sxs-lookup"><span data-stu-id="e7f12-173">Getting the entire message body written out at once to an XML writer.</span></span> <span data-ttu-id="e7f12-174">Dies wird als *Schreiben einer Nachricht*bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="e7f12-174">This is referred to as *writing a message*.</span></span>  
  
- <span data-ttu-id="e7f12-175">Laufenlassen eines XML-Readers über den Nachrichtentext.</span><span class="sxs-lookup"><span data-stu-id="e7f12-175">Getting an XML reader over the message body.</span></span> <span data-ttu-id="e7f12-176">Dies ermöglicht es Ihnen, später nach Bedarf Stück für Stück auf den Nachrichtentext zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-176">This enables you to later access the message body piece-by-piece as required.</span></span> <span data-ttu-id="e7f12-177">Dies wird als *Lesen einer Nachricht*bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="e7f12-177">This is referred to as *reading a message*.</span></span>  
  
- <span data-ttu-id="e7f12-178">Die gesamte Nachricht, einschließlich des Texts, kann in einen Puffer im Arbeitsspeicher vom <xref:System.ServiceModel.Channels.MessageBuffer>-Typ kopiert werden.</span><span class="sxs-lookup"><span data-stu-id="e7f12-178">The entire message, including its body, can be copied to an in-memory buffer of the <xref:System.ServiceModel.Channels.MessageBuffer> type.</span></span> <span data-ttu-id="e7f12-179">Dies wird als *Kopieren einer Nachricht*bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="e7f12-179">This is referred to as *copying a message*.</span></span>  
  
 <span data-ttu-id="e7f12-180">Sie können unabhängig von der Zugriffsmethode nur einmal auf den Text einer `Message` zugreifen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-180">You can access the body of a `Message` only once, regardless of how it is accessed.</span></span> <span data-ttu-id="e7f12-181">Ein Nachrichtenobjekt verfügt über eine `State`-Eigenschaft, die anfänglich auf "Erstellt" festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="e7f12-181">A message object has a `State` property, which is initially set to Created.</span></span> <span data-ttu-id="e7f12-182">Mit den drei zuvor beschriebenen Zugriffsmethoden wird der Zustand auf "Geschrieben", "Gelesen" bzw. "Kopiert" festgelegt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-182">The three access methods described in the preceding list set the state to Written, Read, and Copied, respectively.</span></span> <span data-ttu-id="e7f12-183">Darüber hinaus kann eine `Close`-Methode den Zustand auf "Geschlossen" festlegen, wenn der Inhalt des Nachrichtentexts nicht mehr benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="e7f12-183">Additionally, a `Close` method can set the state to Closed when the message body contents are no longer required.</span></span> <span data-ttu-id="e7f12-184">Auf den Nachrichtentext kann nur im Zustand "Erstellt" zugegriffen werden, und eine Rückkehr zu diesem Zustand ist nach einer Zustandsänderung nicht mehr möglich.</span><span class="sxs-lookup"><span data-stu-id="e7f12-184">The message body can be accessed only in the Created state, and there is no way to go back to the Created state after the state has changed.</span></span>  
  
## <a name="writing-messages"></a><span data-ttu-id="e7f12-185">Schreiben von Nachrichten</span><span class="sxs-lookup"><span data-stu-id="e7f12-185">Writing Messages</span></span>  
 <span data-ttu-id="e7f12-186">Die <xref:System.ServiceModel.Channels.Message.WriteBodyContents%28System.Xml.XmlDictionaryWriter%29>-Methode schreibt den Inhalt des Texts einer bestimmten `Message`-Instanz in einen angegebenen XML-Writer.</span><span class="sxs-lookup"><span data-stu-id="e7f12-186">The <xref:System.ServiceModel.Channels.Message.WriteBodyContents%28System.Xml.XmlDictionaryWriter%29> method writes out the body contents of a given `Message` instance to a given XML writer.</span></span> <span data-ttu-id="e7f12-187">Die- <xref:System.ServiceModel.Channels.Message.WriteBody%2A> Methode führt dasselbe aus, mit der Ausnahme, dass Sie den Textkörper Inhalt im entsprechenden Wrapper Element einschließt (z `soap:body` . b. <>).</span><span class="sxs-lookup"><span data-stu-id="e7f12-187">The <xref:System.ServiceModel.Channels.Message.WriteBody%2A> method does the same, except that it encloses the body contents in the appropriate wrapper element (for example, <`soap:body`>).</span></span> <span data-ttu-id="e7f12-188">Schließlich schreibt <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> die ganze Nachricht, einschließlich des umfassenden SOAP-Umschlags und der Header.</span><span class="sxs-lookup"><span data-stu-id="e7f12-188">Finally, <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> writes out the entire message, including the wrapping SOAP envelope and the headers.</span></span> <span data-ttu-id="e7f12-189">Wenn SOAP ausgeschaltet ist ( <xref:System.ServiceModel.Channels.Message.Version> ist <xref:System.ServiceModel.Channels.MessageVersion.None?displayProperty=nameWithType> ), führen alle drei Methoden dasselbe aus: Sie schreiben den Nachrichtentext Inhalt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-189">If SOAP is turned off (<xref:System.ServiceModel.Channels.Message.Version> is <xref:System.ServiceModel.Channels.MessageVersion.None?displayProperty=nameWithType>), all three methods do the same thing: they write out the message body contents.</span></span>  
  
 <span data-ttu-id="e7f12-190">Beispielsweise schreibt der folgende Code der Text einer eingehenden Nachricht in eine Datei.</span><span class="sxs-lookup"><span data-stu-id="e7f12-190">For example, the following code writes out the body of an incoming message to a file.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#5)]
 [!code-vb[C_UsingTheMessageClass#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#5)]  
  
 <span data-ttu-id="e7f12-191">Zwei zusätzliche Hilfsmethoden schreiben bestimmte SOAP-Startelement-Tags.</span><span class="sxs-lookup"><span data-stu-id="e7f12-191">Two additional helper methods write out certain SOAP start element tags.</span></span> <span data-ttu-id="e7f12-192">Diese Methoden haben keinen Zugriff auf den Nachrichtentext, der Nachrichtenzustand wird also nicht geändert.</span><span class="sxs-lookup"><span data-stu-id="e7f12-192">These methods do not access the message body and so they do not change the message state.</span></span> <span data-ttu-id="e7f12-193">Dazu gehören:</span><span class="sxs-lookup"><span data-stu-id="e7f12-193">These include:</span></span>  
  
- <span data-ttu-id="e7f12-194"><xref:System.ServiceModel.Channels.Message.WriteStartBody%2A> schreibt das Start-Textelement, z. B. `<soap:Body>`.</span><span class="sxs-lookup"><span data-stu-id="e7f12-194"><xref:System.ServiceModel.Channels.Message.WriteStartBody%2A> writes the start body element, for example, `<soap:Body>`.</span></span>  
  
- <span data-ttu-id="e7f12-195"><xref:System.ServiceModel.Channels.Message.WriteStartEnvelope%2A> schreibt das Start-Umschlagelement, z. B. `<soap:Envelope>`.</span><span class="sxs-lookup"><span data-stu-id="e7f12-195"><xref:System.ServiceModel.Channels.Message.WriteStartEnvelope%2A> writes the start envelope element, for example, `<soap:Envelope>`.</span></span>  
  
 <span data-ttu-id="e7f12-196">Rufen Sie zum Schreiben der jeweiligen Endelement-Tags `WriteEndElement` auf dem entsprechenden XML-Writer auf.</span><span class="sxs-lookup"><span data-stu-id="e7f12-196">To write the corresponding end element tags, call `WriteEndElement` on the corresponding XML writer.</span></span> <span data-ttu-id="e7f12-197">Diese Methoden werden selten direkt aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-197">These methods are rarely called directly.</span></span>  
  
## <a name="reading-messages"></a><span data-ttu-id="e7f12-198">Lesen von Nachrichten</span><span class="sxs-lookup"><span data-stu-id="e7f12-198">Reading Messages</span></span>  
 <span data-ttu-id="e7f12-199">Die primäre Methode zum Lesen eines Nachrichtentexts ist das Aufrufen von <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A>.</span><span class="sxs-lookup"><span data-stu-id="e7f12-199">The primary way to read a message body is to call <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A>.</span></span> <span data-ttu-id="e7f12-200">Ein <xref:System.Xml.XmlDictionaryReader> wird zurückgegeben, mit dem Sie den Nachrichtentext lesen können.</span><span class="sxs-lookup"><span data-stu-id="e7f12-200">You get back an <xref:System.Xml.XmlDictionaryReader> that you can use to read the message body.</span></span> <span data-ttu-id="e7f12-201">Beachten Sie, dass die <xref:System.ServiceModel.Channels.Message> in den Zustand "Gelesen" übergeht, sobald <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> aufgerufen wird, und nicht, wenn Sie den XML-Reader verwenden.</span><span class="sxs-lookup"><span data-stu-id="e7f12-201">Note that the <xref:System.ServiceModel.Channels.Message> transitions to the Read state as soon as <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> is called, and not when you use the returned XML reader.</span></span>  
  
 <span data-ttu-id="e7f12-202">Die <xref:System.ServiceModel.Channels.Message.GetBody%2A>-Methode ermöglicht Ihnen auch den Zugriff auf den Nachrichtentext als typisiertes Objekt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-202">The <xref:System.ServiceModel.Channels.Message.GetBody%2A> method also enables you to access the message body as a typed object.</span></span> <span data-ttu-id="e7f12-203">Intern verwendet diese Methode `GetReaderAtBodyContents`, daher geht die Nachricht auch in den <xref:System.ServiceModel.Channels.MessageState.Read>-Zustand über (siehe die <xref:System.ServiceModel.Channels.Message.State%2A>-Eigenschaft).</span><span class="sxs-lookup"><span data-stu-id="e7f12-203">Internally, this method uses `GetReaderAtBodyContents`, and so it also transitions the message state to the <xref:System.ServiceModel.Channels.MessageState.Read> state (see the <xref:System.ServiceModel.Channels.Message.State%2A> property).</span></span>  
  
 <span data-ttu-id="e7f12-204">Es wird empfohlen, die <xref:System.ServiceModel.Channels.Message.IsEmpty%2A>-Eigenschaft zu überprüfen, wobei in diesem Fall die Nachricht keinen Text enthält und <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> eine <xref:System.InvalidOperationException> auslöst.</span><span class="sxs-lookup"><span data-stu-id="e7f12-204">It is good practice to check the <xref:System.ServiceModel.Channels.Message.IsEmpty%2A> property, in which case the message body is empty and <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> throws an <xref:System.InvalidOperationException>.</span></span> <span data-ttu-id="e7f12-205">Wenn es sich um eine empfangene Nachricht handelt (beispielsweise um die Antwort), sollten Sie auch <xref:System.ServiceModel.Channels.Message.IsFault%2A> überprüfen, wodurch angegeben wird, ob die Nachricht einen Fehler enthält.</span><span class="sxs-lookup"><span data-stu-id="e7f12-205">Also, if it is a received message (for example, the reply), you may also want to check <xref:System.ServiceModel.Channels.Message.IsFault%2A>, which indicates whether the message contains a fault.</span></span>  
  
 <span data-ttu-id="e7f12-206">Die grundlegendste Überladung von <xref:System.ServiceModel.Channels.Message.GetBody%2A> deserialisiert den Nachrichtentext in eine Instanz eines Typs (angegeben durch den generischen Parameter) unter Verwendung eines <xref:System.Runtime.Serialization.DataContractSerializer>, konfiguriert mit den Standardeinstellungen und mit deaktiviertem <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A>-Kontingent.</span><span class="sxs-lookup"><span data-stu-id="e7f12-206">The most basic overload of <xref:System.ServiceModel.Channels.Message.GetBody%2A> deserializes the message body into an instance of a type (indicated by the generic parameter) using a <xref:System.Runtime.Serialization.DataContractSerializer> configured with the default settings and with the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A> quota disabled.</span></span> <span data-ttu-id="e7f12-207">Wenn Sie eine andere Serialisierungs-Engine verwenden oder das `DataContractSerializer` nicht standardmäßig konfigurieren möchten, verwenden Sie die <xref:System.ServiceModel.Channels.Message.GetBody%2A>-Überladung, die ein <xref:System.Runtime.Serialization.XmlObjectSerializer> annimmt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-207">If you want to use a different serialization engine, or configure the `DataContractSerializer` in a non-default way, use the <xref:System.ServiceModel.Channels.Message.GetBody%2A> overload that takes an <xref:System.Runtime.Serialization.XmlObjectSerializer>.</span></span>  
  
 <span data-ttu-id="e7f12-208">Der folgende Code extrahiert beispielsweise Daten aus einem Nachrichtentext, der ein serialisiertes `Person`-Objekt enthält, und gibt den Namen der Person aus.</span><span class="sxs-lookup"><span data-stu-id="e7f12-208">For example, the following code extracts data from a message body that contains a serialized `Person` object and prints out the person’s name.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#6)]
 [!code-vb[C_UsingTheMessageClass#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#6)]  
  
## <a name="copying-a-message-into-a-buffer"></a><span data-ttu-id="e7f12-209">Kopieren einer Nachricht in einen Puffer</span><span class="sxs-lookup"><span data-stu-id="e7f12-209">Copying a Message into a Buffer</span></span>  
 <span data-ttu-id="e7f12-210">Manchmal ist es erforderlich, mehrmals auf den Nachrichtentext zuzugreifen, beispielsweise um die gleiche Nachricht an mehrere Ziele als Teil eines Verleger-Abonnent-Systems weiterzuleiten.</span><span class="sxs-lookup"><span data-stu-id="e7f12-210">Sometimes it is necessary to access the message body more than once, for example, to forward the same message to multiple destinations as part of a publisher-subscriber system.</span></span> <span data-ttu-id="e7f12-211">In diesem Fall ist es notwendig, die gesamte Nachricht (einschließlich des Textes) im Arbeitsspeicher zu puffern.</span><span class="sxs-lookup"><span data-stu-id="e7f12-211">In this case, it is necessary to buffer the entire message (including the body) in memory.</span></span> <span data-ttu-id="e7f12-212">Sie können dazu <xref:System.ServiceModel.Channels.Message.CreateBufferedCopy%28System.Int32%29> aufrufen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-212">You can do this by calling <xref:System.ServiceModel.Channels.Message.CreateBufferedCopy%28System.Int32%29>.</span></span> <span data-ttu-id="e7f12-213">Diese Methode nimmt einen ganzzahligen Parameter an, der die maximale Puffergröße darstellt, und erstellt einen Puffer mit maximal dieser Größe.</span><span class="sxs-lookup"><span data-stu-id="e7f12-213">This method takes an integer parameter that represents the maximum buffer size, and creates a buffer not larger than this size.</span></span> <span data-ttu-id="e7f12-214">Legen Sie dafür einen sicheren Wert fest, wenn die Nachricht von einer nicht vertrauenswürdigen Quelle stammt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-214">It is important to set this to a safe value if the message is coming from an untrusted source.</span></span>  
  
 <span data-ttu-id="e7f12-215">Der Puffer wird als <xref:System.ServiceModel.Channels.MessageBuffer>-Instanz zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="e7f12-215">The buffer is returned as a <xref:System.ServiceModel.Channels.MessageBuffer> instance.</span></span> <span data-ttu-id="e7f12-216">Es gibt mehrere Möglichkeiten, um auf Daten im Puffer zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-216">You can access data in the buffer in several ways.</span></span> <span data-ttu-id="e7f12-217">Die primäre Methode ist, <xref:System.ServiceModel.Channels.Message.CreateMessage%2A> aufzurufen, um `Message`-Instanzen aus dem Puffer zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-217">The primary way is to call <xref:System.ServiceModel.Channels.Message.CreateMessage%2A> to create `Message` instances from the buffer.</span></span>  
  
 <span data-ttu-id="e7f12-218">Eine weitere Methode ist das Implementieren der <xref:System.Xml.XPath.IXPathNavigable>-Schnittstelle, die die <xref:System.ServiceModel.Channels.MessageBuffer>-Klasse implementiert, um direkt auf die zugrunde liegende XML zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-218">Another way to access the data in the buffer is to implement the <xref:System.Xml.XPath.IXPathNavigable> interface that the <xref:System.ServiceModel.Channels.MessageBuffer> class implements to access the underlying XML directly.</span></span> <span data-ttu-id="e7f12-219">Einige <xref:System.ServiceModel.Channels.MessageBuffer.CreateNavigator%2A>-Überladungen ermöglichen das Erstellen von durch ein Knotenkontingent geschützten <xref:System.Xml.XPath>-Navigatoren, die die Anzahl der aufrufbaren XML-Knoten beschränken.</span><span class="sxs-lookup"><span data-stu-id="e7f12-219">Some <xref:System.ServiceModel.Channels.MessageBuffer.CreateNavigator%2A> overloads allow you to create <xref:System.Xml.XPath> navigators protected by a node quota, limiting the number of XML nodes that can be visited.</span></span> <span data-ttu-id="e7f12-220">Dies hilft, Denial-of-Service-Angriffe auf der Grundlage von längerer Verarbeitungszeit zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="e7f12-220">This helps prevent denial of service attacks based on lengthy processing time.</span></span> <span data-ttu-id="e7f12-221">Dieses Kontingent ist standardmäßig deaktiviert.</span><span class="sxs-lookup"><span data-stu-id="e7f12-221">This quote is disabled by default.</span></span> <span data-ttu-id="e7f12-222">Mit einigen `CreateNavigator`-Überladungen können Sie angeben, wie viele Leerstellen in der XML mit der <xref:System.Xml.XmlSpace>-Enumeration behandelt werden soll, wobei der Standard `XmlSpace.None` ist.</span><span class="sxs-lookup"><span data-stu-id="e7f12-222">Some `CreateNavigator` overloads allow you to specify how white space should be handled in the XML using the <xref:System.Xml.XmlSpace> enumeration, with the default being `XmlSpace.None`.</span></span>  
  
 <span data-ttu-id="e7f12-223">Die letzte Methode zum Zugreifen auf den Inhalt eines Nachrichtenpuffers ist das Schreiben des Inhalts in einen Stream mit <xref:System.ServiceModel.Channels.Message.WriteMessage%2A>.</span><span class="sxs-lookup"><span data-stu-id="e7f12-223">A final way to access the contents of a message buffer is to write out its contents to a stream using <xref:System.ServiceModel.Channels.Message.WriteMessage%2A>.</span></span>  
  
 <span data-ttu-id="e7f12-224">Das folgende Beispiel demonstriert das Arbeiten mit einem `MessageBuffer`: Eine eingehende Nachricht wird an mehrere Empfänger weitergeleitet und anschließend in einer Datei protokolliert.</span><span class="sxs-lookup"><span data-stu-id="e7f12-224">The following example demonstrates the process of working with a `MessageBuffer`: an incoming message is forwarded to multiple recipients, and then logged to a file.</span></span> <span data-ttu-id="e7f12-225">Ohne Pufferung ist dies nicht möglich, da dann der Zugriff auf den Nachrichtentext nur einmal möglich ist.</span><span class="sxs-lookup"><span data-stu-id="e7f12-225">Without buffering, this is not possible, because the message body can then be accessed only once.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#7)]
 [!code-vb[C_UsingTheMessageClass#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#7)]  
  
 <span data-ttu-id="e7f12-226">Die `MessageBuffer`-Klasse verfügt über andere erwähnenswerte Member.</span><span class="sxs-lookup"><span data-stu-id="e7f12-226">The `MessageBuffer` class has other members worth noting.</span></span> <span data-ttu-id="e7f12-227">Die <xref:System.ServiceModel.Channels.MessageBuffer.Close%2A>-Methode kann aufgerufen werden, um Ressourcen freizugeben, wenn der Pufferinhalt nicht mehr benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="e7f12-227">The <xref:System.ServiceModel.Channels.MessageBuffer.Close%2A> method can be called to free resources when the buffer contents are no longer required.</span></span> <span data-ttu-id="e7f12-228">Die <xref:System.ServiceModel.Channels.MessageBuffer.BufferSize%2A>-Eigenschaft gibt die Größe des reservierten Puffers zurück.</span><span class="sxs-lookup"><span data-stu-id="e7f12-228">The <xref:System.ServiceModel.Channels.MessageBuffer.BufferSize%2A> property returns the size of the allocated buffer.</span></span> <span data-ttu-id="e7f12-229">Die <xref:System.ServiceModel.Channels.MessageBuffer.MessageContentType%2A>-Eigenschaft gibt den MIME-Inhaltstyp der Nachricht zurück.</span><span class="sxs-lookup"><span data-stu-id="e7f12-229">The <xref:System.ServiceModel.Channels.MessageBuffer.MessageContentType%2A> property returns the MIME content type of the message.</span></span>  
  
## <a name="accessing-the-message-body-for-debugging"></a><span data-ttu-id="e7f12-230">Zugreifen auf den Nachrichtentext zum Debuggen</span><span class="sxs-lookup"><span data-stu-id="e7f12-230">Accessing the Message Body for Debugging</span></span>  
 <span data-ttu-id="e7f12-231">Zum Debuggen können Sie die <xref:System.ServiceModel.Channels.Message.ToString%2A>-Methode aufrufen, um eine Darstellung der Nachricht als Zeichenfolge abzurufen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-231">For debugging purposes, you can call the <xref:System.ServiceModel.Channels.Message.ToString%2A> method to get a representation of the message as a string.</span></span> <span data-ttu-id="e7f12-232">Diese Darstellung stimmt im Allgemeinen mit der Darstellung einer Nachricht überein, wenn sie mit dem Textencoder codiert worden wäre, außer dass die XML zur Lesbarkeit besser formatiert wäre.</span><span class="sxs-lookup"><span data-stu-id="e7f12-232">This representation generally matches the way a message would look on the wire if it were encoded with the text encoder, except that the XML would be better formatted for human readability.</span></span> <span data-ttu-id="e7f12-233">Die einzige Ausnahme ist der Nachrichtentext.</span><span class="sxs-lookup"><span data-stu-id="e7f12-233">The one exception to this is the message body.</span></span> <span data-ttu-id="e7f12-234">Der Text kann nur einmal gelesen werden, und `ToString` ändert den Nachrichtenzustand nicht.</span><span class="sxs-lookup"><span data-stu-id="e7f12-234">The body can be read only once, and `ToString` does not change the message state.</span></span> <span data-ttu-id="e7f12-235">Daher ist die `ToString` Methode möglicherweise nicht in der Lage, auf den Text zuzugreifen und einen Platzhalter zu ersetzen (z. b. "..." oder drei Punkte) anstelle des Nachrichten Texts.</span><span class="sxs-lookup"><span data-stu-id="e7f12-235">Therefore, the `ToString` method might not be able to access the body and might substitute a placeholder (for example, "…" or three dots) instead of the message body.</span></span> <span data-ttu-id="e7f12-236">Verwenden Sie deswegen `ToString` nicht zum Protokollieren von Nachrichten, wenn der Textinhalt der Nachrichten wichtig ist.</span><span class="sxs-lookup"><span data-stu-id="e7f12-236">Therefore, do not use `ToString` to log messages if the body content of the messages is important.</span></span>  
  
## <a name="accessing-other-message-parts"></a><span data-ttu-id="e7f12-237">Zugreifen auf andere Nachrichtenteile</span><span class="sxs-lookup"><span data-stu-id="e7f12-237">Accessing Other Message Parts</span></span>  
 <span data-ttu-id="e7f12-238">Für den Zugriff auf andere Informationen zur Nachricht als den Textinhalt werden verschiedene Eigenschaften bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-238">Various properties are provided to access information about the message other than its body contents.</span></span> <span data-ttu-id="e7f12-239">Diese können jedoch nicht aufgerufen werden, wenn die Nachricht geschlossen wurde:</span><span class="sxs-lookup"><span data-stu-id="e7f12-239">However, these cannot be called once the message has been closed:</span></span>  
  
- <span data-ttu-id="e7f12-240">Die <xref:System.ServiceModel.Channels.Message.Headers%2A>-Eigenschaft stellt die Nachrichtenheader dar.</span><span class="sxs-lookup"><span data-stu-id="e7f12-240">The <xref:System.ServiceModel.Channels.Message.Headers%2A> property represents the message headers.</span></span> <span data-ttu-id="e7f12-241">Weitere Informationen finden Sie weiter unten in diesem Thema im Abschnitt "arbeiten mit Headern".</span><span class="sxs-lookup"><span data-stu-id="e7f12-241">See the section on "Working with Headers" later in this topic.</span></span>  
  
- <span data-ttu-id="e7f12-242">Die <xref:System.ServiceModel.Channels.Message.Properties%2A>-Eigenschaft stellt die Eigenschaften der Nachricht dar, die Teile an die Nachricht angehängter benannter Daten sind, die beim Senden der Nachricht im Allgemeinen nicht ausgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="e7f12-242">The <xref:System.ServiceModel.Channels.Message.Properties%2A> property represents the message properties, which are pieces of named data attached to the message that do not generally get emitted when the message is sent.</span></span> <span data-ttu-id="e7f12-243">Weitere Informationen finden Sie im Abschnitt "Arbeiten mit Eigenschaften" weiter unten in diesem Thema.</span><span class="sxs-lookup"><span data-stu-id="e7f12-243">See the section on "Working with Properties" later in this topic.</span></span>  
  
- <span data-ttu-id="e7f12-244">Die <xref:System.ServiceModel.Channels.Message.Version%2A>-Eigenschaft gibt die der Nachricht zugeordnete SOAP-Version und Version der WS-Adressierung an, oder `None`, wenn SOAP deaktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="e7f12-244">The <xref:System.ServiceModel.Channels.Message.Version%2A> property indicates the SOAP and WS-Addressing version associated with the message, or `None` if SOAP is disabled.</span></span>  
  
- <span data-ttu-id="e7f12-245">Die <xref:System.ServiceModel.Channels.Message.IsFault%2A>-Eigenschaft gibt `true` zurück, wenn die Nachricht eine SOAP-Fehlermeldung ist.</span><span class="sxs-lookup"><span data-stu-id="e7f12-245">The <xref:System.ServiceModel.Channels.Message.IsFault%2A> property returns `true` if the message is a SOAP fault message.</span></span>  
  
- <span data-ttu-id="e7f12-246">Die <xref:System.ServiceModel.Channels.Message.IsEmpty%2A>-Eigenschaft gibt `true` zurück, wenn die Nachricht keinen Text enthält.</span><span class="sxs-lookup"><span data-stu-id="e7f12-246">The <xref:System.ServiceModel.Channels.Message.IsEmpty%2A> property returns `true` if the message is empty.</span></span>  
  
 <span data-ttu-id="e7f12-247">Sie können mithilfe der <xref:System.ServiceModel.Channels.Message.GetBodyAttribute%28System.String%2CSystem.String%29>-Methode auf ein bestimmtes, mit einem bestimmten Namen und Namespace bezeichnetes Attribut im Textwrapperelement (z. B. `<soap:Body>`) zugreifen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-247">You can use the <xref:System.ServiceModel.Channels.Message.GetBodyAttribute%28System.String%2CSystem.String%29> method to access a particular attribute on the body wrapper element (for example, `<soap:Body>`) identified by a particular name and namespace.</span></span> <span data-ttu-id="e7f12-248">Wenn ein solches Attribut nicht gefunden wurde, wird `null` zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="e7f12-248">If such an attribute is not found, `null` is returned.</span></span> <span data-ttu-id="e7f12-249">Diese Methode kann nur dann aufgerufen werden, wenn sich die `Message` im Zustand "Erstellt" befindet (wenn noch nicht auf den Nachrichtentext zugegriffen wurde).</span><span class="sxs-lookup"><span data-stu-id="e7f12-249">This method can be called only when the `Message` is in the Created state (when the message body has not yet been accessed).</span></span>  
  
## <a name="working-with-headers"></a><span data-ttu-id="e7f12-250">Arbeiten mit Headern</span><span class="sxs-lookup"><span data-stu-id="e7f12-250">Working with Headers</span></span>  
 <span data-ttu-id="e7f12-251">Eine `Message` kann eine beliebige Anzahl von benannten XML-Fragmenten enthalten, die als *Header*bezeichnet werden.</span><span class="sxs-lookup"><span data-stu-id="e7f12-251">A `Message` can contain any number of named XML fragments, called *headers*.</span></span> <span data-ttu-id="e7f12-252">Jedes Fragment wird normalerweise einem SOAP-Header zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="e7f12-252">Each fragment normally maps to a SOAP header.</span></span> <span data-ttu-id="e7f12-253">Der Zugriff auf Header erfolgt über die `Headers`-Eigenschaft des Typs <xref:System.ServiceModel.Channels.MessageHeaders>.</span><span class="sxs-lookup"><span data-stu-id="e7f12-253">Headers are accessed through the `Headers` property of type <xref:System.ServiceModel.Channels.MessageHeaders>.</span></span> <span data-ttu-id="e7f12-254"><xref:System.ServiceModel.Channels.MessageHeaders> ist eine Auflistung von <xref:System.ServiceModel.Channels.MessageHeaderInfo>-Objekten, und auf einzelne Header kann über die <xref:System.Collections.IEnumerable>-Schnittstelle oder durch den Indexer zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="e7f12-254"><xref:System.ServiceModel.Channels.MessageHeaders> is a collection of <xref:System.ServiceModel.Channels.MessageHeaderInfo> objects, and individual headers can be accessed through its <xref:System.Collections.IEnumerable> interface or through its indexer.</span></span> <span data-ttu-id="e7f12-255">Im folgenden Code werden z. B. die Namen aller Header in einer `Message` aufgelistet.</span><span class="sxs-lookup"><span data-stu-id="e7f12-255">For example, the following code lists the names of all the headers in a `Message`.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#8)]
 [!code-vb[C_UsingTheMessageClass#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#8)]  
  
#### <a name="adding-removing-finding-headers"></a><span data-ttu-id="e7f12-256">Hinzufügen, Entfernen und Suchen von Headern</span><span class="sxs-lookup"><span data-stu-id="e7f12-256">Adding, Removing, Finding Headers</span></span>  
 <span data-ttu-id="e7f12-257">Sie können einen neuen Header am Ende aller vorhandenen Header mit der <xref:System.ServiceModel.Channels.MessageHeaders.Add%2A>-Methode hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-257">You can add a new header at the end of all existing headers using the <xref:System.ServiceModel.Channels.MessageHeaders.Add%2A> method.</span></span> <span data-ttu-id="e7f12-258">Sie können die <xref:System.ServiceModel.Channels.MessageHeaders.Insert%2A>-Methode verwenden, um einen Header an einem bestimmten Index einzufügen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-258">You can use the <xref:System.ServiceModel.Channels.MessageHeaders.Insert%2A> method to insert a header at a particular index.</span></span> <span data-ttu-id="e7f12-259">Vorhandene Header werden für das eingefügte Element verschoben.</span><span class="sxs-lookup"><span data-stu-id="e7f12-259">Existing headers are shifted for the inserted item.</span></span> <span data-ttu-id="e7f12-260">Header werden nach ihrem Index geordnet, dabei ist der erste verfügbare Index 0.</span><span class="sxs-lookup"><span data-stu-id="e7f12-260">Headers are ordered according to their index, and the first available index is 0.</span></span> <span data-ttu-id="e7f12-261">Sie können mithilfe der verschiedenen <xref:System.ServiceModel.Channels.MessageHeaders.CopyHeadersFrom%2A>-Methodenüberladungen Header aus einer anderen `Message`- oder `MessageHeaders`-Instanz hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-261">You can use the various <xref:System.ServiceModel.Channels.MessageHeaders.CopyHeadersFrom%2A> method overloads to add headers from a different `Message` or `MessageHeaders` instance.</span></span> <span data-ttu-id="e7f12-262">Einige Überladungen kopieren einen einzelnen Header, während andere alle Header kopieren.</span><span class="sxs-lookup"><span data-stu-id="e7f12-262">Some overloads copy one individual header, while others copy all of them.</span></span> <span data-ttu-id="e7f12-263">Mit der <xref:System.ServiceModel.Channels.MessageHeaders.Clear%2A>-Methode werden alle Header entfernt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-263">The <xref:System.ServiceModel.Channels.MessageHeaders.Clear%2A> method removes all headers.</span></span> <span data-ttu-id="e7f12-264">Die <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAt%2A>-Methode entfernt einen Header an einem bestimmten Index (alle nachfolgenden Header werden verschoben).</span><span class="sxs-lookup"><span data-stu-id="e7f12-264">The <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAt%2A> method removes a header at a particular index (shifting all headers after it).</span></span> <span data-ttu-id="e7f12-265">Die <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAll%2A>-Methode entfernt alle Header mit einem bestimmten Namen und Namespace.</span><span class="sxs-lookup"><span data-stu-id="e7f12-265">The <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAll%2A> method removes all headers with a particular name and namespace.</span></span>  
  
 <span data-ttu-id="e7f12-266">Rufen Sie mit der <xref:System.ServiceModel.Channels.MessageHeaders.FindHeader%2A>-Methode einen bestimmten Header ab.</span><span class="sxs-lookup"><span data-stu-id="e7f12-266">Retrieve a particular header using the <xref:System.ServiceModel.Channels.MessageHeaders.FindHeader%2A> method.</span></span> <span data-ttu-id="e7f12-267">Diese Methode nimmt den Namen und Namespace des zu suchenden Headers an, und gibt seinen Index zurück.</span><span class="sxs-lookup"><span data-stu-id="e7f12-267">This method takes the name and namespace of the header to find, and returns its index.</span></span> <span data-ttu-id="e7f12-268">Wenn der Header mehrmals auftritt, wird eine Ausnahme ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="e7f12-268">If the header occurs more than once, an exception is thrown.</span></span> <span data-ttu-id="e7f12-269">Wenn der Header nicht gefunden wurde, wird -1 zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="e7f12-269">If the header is not found, it returns -1.</span></span>  
  
 <span data-ttu-id="e7f12-270">Im SOAP-Headermodell können Header einen `Actor`-Wert aufweisen, der den gewünschten Empfänger des Headers angibt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-270">In the SOAP header model, headers can have an `Actor` value that specifies the intended recipient of the header.</span></span> <span data-ttu-id="e7f12-271">Die grundlegendste `FindHeader`-Überladung sucht nur Header, die für den letzten Empfänger der Nachricht vorgesehen sind.</span><span class="sxs-lookup"><span data-stu-id="e7f12-271">The most basic `FindHeader` overload searches only headers intended for the ultimate receiver of the message.</span></span> <span data-ttu-id="e7f12-272">Mit einer anderen Überladung können Sie jedoch angeben, welche `Actor`-Werte in der Suche enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="e7f12-272">However, another overload enables you to specify which `Actor` values are included in the search.</span></span> <span data-ttu-id="e7f12-273">Weitere Informationen finden Sie in der SOAP-Spezifikation.</span><span class="sxs-lookup"><span data-stu-id="e7f12-273">For more information, see the SOAP specification.</span></span>  
  
 <span data-ttu-id="e7f12-274">Eine <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29>-Methode wird für das Kopieren von Headern aus einer <xref:System.ServiceModel.Channels.MessageHeaders>-Auflistung zu einem Array von <xref:System.ServiceModel.Channels.MessageHeaderInfo>-Objekten bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-274">A <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29> method is provided to copy headers from a <xref:System.ServiceModel.Channels.MessageHeaders> collection to an array of <xref:System.ServiceModel.Channels.MessageHeaderInfo> objects.</span></span>  
  
 <span data-ttu-id="e7f12-275">Für den Zugriff auf die XML-Daten in einem Header können Sie <xref:System.ServiceModel.Channels.MessageHeaders.GetReaderAtHeader%2A> aufrufen und einen XML-Leser für den Headerindex zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="e7f12-275">To access the XML data in a header, you can call <xref:System.ServiceModel.Channels.MessageHeaders.GetReaderAtHeader%2A> and return an XML reader for the specific header index.</span></span> <span data-ttu-id="e7f12-276">Verwenden Sie zum Deserialisieren des Headerinhalts in ein Objekt <xref:System.ServiceModel.Channels.MessageHeaders.GetHeader%60%601%28System.Int32%29> oder eine der anderen Überladungen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-276">If you want to deserialize the header contents into an object, use <xref:System.ServiceModel.Channels.MessageHeaders.GetHeader%60%601%28System.Int32%29> or one of the other overloads.</span></span> <span data-ttu-id="e7f12-277">Die grundlegendsten Überladungen deserialisieren Header mit dem <xref:System.Runtime.Serialization.DataContractSerializer>, der standardmäßig konfiguriert wurde.</span><span class="sxs-lookup"><span data-stu-id="e7f12-277">The most basic overloads deserialize headers using the <xref:System.Runtime.Serialization.DataContractSerializer> configured in the default way.</span></span> <span data-ttu-id="e7f12-278">Wenn Sie ein anderes Serialisierungsprogramm oder eine andere Konfiguration von `DataContractSerializer` verwenden möchten, nutzen Sie eine der Überladungen, die ein `XmlObjectSerializer` akzeptieren.</span><span class="sxs-lookup"><span data-stu-id="e7f12-278">If you want to use a different serializer or a different configuration of the `DataContractSerializer`, use one of the overloads that take an `XmlObjectSerializer`.</span></span> <span data-ttu-id="e7f12-279">Einige Überladungen akzeptieren auch den Headernamen, Namespace und optional eine Liste von `Actor`-Werte anstelle eines Index; dies ist eine Kombination von `FindHeader` und `GetHeader`.</span><span class="sxs-lookup"><span data-stu-id="e7f12-279">There are also overloads that take the header name, namespace, and optionally a list of `Actor` values instead of an index; this is a combination of `FindHeader` and `GetHeader`.</span></span>  
  
## <a name="working-with-properties"></a><span data-ttu-id="e7f12-280">Arbeiten mit Eigenschaften</span><span class="sxs-lookup"><span data-stu-id="e7f12-280">Working with Properties</span></span>  
 <span data-ttu-id="e7f12-281">Eine `Message`-Instanz kann eine beliebige Anzahl von benannten Objekten beliebiger Typen enthalten.</span><span class="sxs-lookup"><span data-stu-id="e7f12-281">A `Message` instance can contain an arbitrary number of named objects of arbitrary types.</span></span> <span data-ttu-id="e7f12-282">Auf diese Auflistung wird über die `Properties`-Eigenschaft vom Typ `MessageProperties` zugegriffen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-282">This collection is accessed through the `Properties` property of type `MessageProperties`.</span></span> <span data-ttu-id="e7f12-283">Die Auflistung implementiert die <xref:System.Collections.Generic.IDictionary%602>-Schnittstelle und fungiert als Zuordnung von <xref:System.String> zu <xref:System.Object>.</span><span class="sxs-lookup"><span data-stu-id="e7f12-283">The collection implements the <xref:System.Collections.Generic.IDictionary%602> interface and acts as a mapping from <xref:System.String> to <xref:System.Object>.</span></span> <span data-ttu-id="e7f12-284">Normalerweise werden Eigenschaftswerte keinem Teil der Nachricht bei der Übertragung direkt zugeordnet, sondern stellen verschiedene Nachrichten Verarbeitungshinweise für die verschiedenen Kanäle im WCF-Kanal Stapel oder für das <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29> Dienst Framework bereit.</span><span class="sxs-lookup"><span data-stu-id="e7f12-284">Normally, property values do not map directly to any part of the message on the wire, but rather provide various message processing hints to the various channels in the WCF channel stack or to the <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29> service framework.</span></span> <span data-ttu-id="e7f12-285">Ein Beispiel finden Sie unter [Übersicht über Datenübertragung Architektur](data-transfer-architectural-overview.md).</span><span class="sxs-lookup"><span data-stu-id="e7f12-285">For an example, see [Data Transfer Architectural Overview](data-transfer-architectural-overview.md).</span></span>  
  
## <a name="inheriting-from-the-message-class"></a><span data-ttu-id="e7f12-286">Erben von der Meldungsklasse</span><span class="sxs-lookup"><span data-stu-id="e7f12-286">Inheriting from the Message Class</span></span>  
 <span data-ttu-id="e7f12-287">Erstellen Sie eine von der `CreateMessage`-Klasse abgeleitete Klasse, wenn die mit `Message` erstellten integrierten Nachrichtentypen nicht den Anforderungen entsprechen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-287">If the built-in message types created using `CreateMessage` do not meet your requirements, create a class that derives from the `Message` class.</span></span>  
  
### <a name="defining-the-message-body-contents"></a><span data-ttu-id="e7f12-288">Definieren des Nachrichtentextinhalts</span><span class="sxs-lookup"><span data-stu-id="e7f12-288">Defining the Message Body Contents</span></span>  
 <span data-ttu-id="e7f12-289">Für den Zugriff auf Daten innerhalb eines Nachrichtentexts gibt es drei grundlegende Verfahren: Schreiben, Lesen und Kopieren in einen Puffer.</span><span class="sxs-lookup"><span data-stu-id="e7f12-289">Three primary techniques exist for accessing data within a message body: writing, reading, and copying it to a buffer.</span></span> <span data-ttu-id="e7f12-290">Diese Verfahren führen im Endeffekt dazu, dass die <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A>-Methode, die <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents%2A>-Methode bzw. die <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A>-Methode in der abgeleiteten `Message`-Klasse aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="e7f12-290">These operations ultimately result in the <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A>, <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents%2A>, and <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> methods being called, respectively, on your derived class of `Message`.</span></span> <span data-ttu-id="e7f12-291">Die `Message`-Basisklasse stellt sicher, dass für jede `Message`-Instanz nur eine dieser Methoden aufgerufen wird und dieser Vorgang jeweils nur einmal stattfindet.</span><span class="sxs-lookup"><span data-stu-id="e7f12-291">The base `Message` class guarantees that only one of these methods is called for each `Message` instance, and that it is not called more than once.</span></span> <span data-ttu-id="e7f12-292">Die Basisklasse stellt auch sicher, dass die Methoden nicht für eine geschlossene Nachricht aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="e7f12-292">The base class also ensures that the methods are not called on a closed message.</span></span> <span data-ttu-id="e7f12-293">Es ist nicht erforderlich, den Nachrichtenzustand in der Implementierung zu verfolgen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-293">There is no need to track the message state in your implementation.</span></span>  
  
 <span data-ttu-id="e7f12-294"><xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> ist eine abstrakte Methode und muss implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="e7f12-294"><xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> is an abstract method and must be implemented.</span></span> <span data-ttu-id="e7f12-295">Die grundlegendste Weise zum Definieren des Textinhalts der Nachricht ist, mit dieser Methode zu schreiben.</span><span class="sxs-lookup"><span data-stu-id="e7f12-295">The most basic way to define the body contents of your message is to write using this method.</span></span> <span data-ttu-id="e7f12-296">Zum Beispiel enthält die folgende Nachricht 100.000 Zufallszahlen von 1 bis 20.</span><span class="sxs-lookup"><span data-stu-id="e7f12-296">For example, the following message contains 100,000 random numbers from 1 to 20.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#9)]
 [!code-vb[C_UsingTheMessageClass#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#9)]  
  
 <span data-ttu-id="e7f12-297">Die <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents>-Methode und die <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A>-Methode verfügen über Standardimplementierungen, die in den meisten Fällen funktionieren.</span><span class="sxs-lookup"><span data-stu-id="e7f12-297">The <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> and <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> methods have default implementations that work for most cases.</span></span> <span data-ttu-id="e7f12-298">Die Standardimplementierungen rufen <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> auf, speichern die Ergebnisse im Puffer und arbeiten mit dem resultierenden Puffer.</span><span class="sxs-lookup"><span data-stu-id="e7f12-298">The default implementations call <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A>, buffer the results, and work with the resulting buffer.</span></span> <span data-ttu-id="e7f12-299">In einigen Fällen genügt dies möglicherweise nicht.</span><span class="sxs-lookup"><span data-stu-id="e7f12-299">However, in some cases this may not be enough.</span></span> <span data-ttu-id="e7f12-300">In vorhergehenden Beispiel führt das Lesen der Nachricht dazu, dass 100.000 XML-Elemente im Puffer gespeichert werden, was unter Umständen nicht wünschenswert ist.</span><span class="sxs-lookup"><span data-stu-id="e7f12-300">In the preceding example, reading the message results in 100,000 XML elements being buffered, which might not be desirable.</span></span> <span data-ttu-id="e7f12-301">Es kann empfehlenswert sein, <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> zu überschreiben, um eine benutzerdefinierte abgeleitete <xref:System.Xml.XmlDictionaryReader>Klasse zurückzugeben, die Zufallszahlen bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-301">You might want to override <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> to return a custom <xref:System.Xml.XmlDictionaryReader> derived class that serves up random numbers.</span></span> <span data-ttu-id="e7f12-302">Sie können dann überschreiben, <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> um den von der-Methode zurückgegebenen Reader zu verwenden <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> , wie im folgenden Beispiel gezeigt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-302">You can then override <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> to use the reader that the <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> method returns, as shown in the following example.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#10)]
 [!code-vb[C_UsingTheMessageClass#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#10)]  
  
 <span data-ttu-id="e7f12-303">Auf ähnliche Weise können Sie `OnCreateBufferedCopy` überschreiben, um eine eigene abgeleitete `MessageBuffer`-Klasse zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="e7f12-303">Similarly, you might want to override `OnCreateBufferedCopy` to return your own `MessageBuffer` derived class.</span></span>  
  
 <span data-ttu-id="e7f12-304">Zusätzlich zum Bereitstellen von Nachrichtentextinhalt muss die abgeleitete Nachrichtenklasse auch die `Version`-Eigenschaft, die `Headers`-Eigenschaft und die `Properties`-Eigenschaft überschreiben.</span><span class="sxs-lookup"><span data-stu-id="e7f12-304">In addition to providing message body contents, your message derived class must also override the `Version`, `Headers`, and `Properties` properties.</span></span>  
  
 <span data-ttu-id="e7f12-305">Beachten Sie, dass beim Erstellen der Kopie einer Nachricht die Kopie die Nachrichtenheader aus dem Original verwendet.</span><span class="sxs-lookup"><span data-stu-id="e7f12-305">Note that if you create a copy of a message, the copy uses the message headers from the original.</span></span>  
  
### <a name="other-members-that-can-be-overridden"></a><span data-ttu-id="e7f12-306">Andere Member, die überschrieben werden können</span><span class="sxs-lookup"><span data-stu-id="e7f12-306">Other Members that Can Be Overridden</span></span>  
 <span data-ttu-id="e7f12-307">Sie können die <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A> Methoden, <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A> und überschreiben, <xref:System.ServiceModel.Channels.Message.OnWriteStartBody%2A> um anzugeben, wie die Start Tags für den SOAP-Umschlag, SOAP-Header und SOAP-Body-Element geschrieben werden. Diese entsprechen normalerweise `<soap:Envelope>` , `<soap:Header>` und `<soap:Body>` .</span><span class="sxs-lookup"><span data-stu-id="e7f12-307">You can override the <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A>, <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A>, and <xref:System.ServiceModel.Channels.Message.OnWriteStartBody%2A> methods to specify how the SOAP envelope, SOAP headers, and SOAP body element start tags are written out. These normally correspond to `<soap:Envelope>`, `<soap:Header>`, and `<soap:Body>`.</span></span> <span data-ttu-id="e7f12-308">Diese Methoden sollten normalerweise nichts schreiben, wenn die <xref:System.ServiceModel.Channels.Message.Version>-Eigenschaft <xref:System.ServiceModel.Channels.MessageVersion.None> zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-308">These methods should normally not write anything out if the <xref:System.ServiceModel.Channels.Message.Version> property returns <xref:System.ServiceModel.Channels.MessageVersion.None>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="e7f12-309">Die Standardimplementierung von `OnGetReaderAtBodyContents` ruft `OnWriteStartEnvelope` und `OnWriteStartBody` auf, bevor `OnWriteBodyContents` aufgerufen wird und die Ergebnisse im Puffer gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="e7f12-309">The default implementation of `OnGetReaderAtBodyContents` calls `OnWriteStartEnvelope` and `OnWriteStartBody` before calling `OnWriteBodyContents` and buffering the results.</span></span> <span data-ttu-id="e7f12-310">Header werden nicht geschrieben.</span><span class="sxs-lookup"><span data-stu-id="e7f12-310">Headers are not written out.</span></span>  
  
 <span data-ttu-id="e7f12-311">Überschreiben Sie die <xref:System.ServiceModel.Channels.Message.OnWriteMessage%2A>-Methode, um das Verfahren zu ändern, wie die gesamte Nachricht aus den verschiedenen Teilen erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="e7f12-311">Override the <xref:System.ServiceModel.Channels.Message.OnWriteMessage%2A> method to change the way the entire message is constructed from its various pieces.</span></span> <span data-ttu-id="e7f12-312">Die `OnWriteMessage`-Methode wird aus <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> und aus der <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A>-Standardimplementierung aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-312">The `OnWriteMessage` method is called from <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> and from the default <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> implementation.</span></span> <span data-ttu-id="e7f12-313">Beachten Sie, dass das Überschreiben von <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> keine empfohlene Vorgehensweise ist.</span><span class="sxs-lookup"><span data-stu-id="e7f12-313">Note that overriding <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> is not a best practice.</span></span> <span data-ttu-id="e7f12-314">Es ist besser, die entsprechenden `On`-Methoden zu überschreiben, z. B <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A>, <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A> und <xref:System.ServiceModel.Channels.BodyWriter.OnWriteBodyContents%2A>.</span><span class="sxs-lookup"><span data-stu-id="e7f12-314">It is better to override the appropriate `On` methods (for example, <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A>, <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A>, and <xref:System.ServiceModel.Channels.BodyWriter.OnWriteBodyContents%2A>.</span></span>  
  
 <span data-ttu-id="e7f12-315">Überschreiben Sie <xref:System.ServiceModel.Channels.Message.OnBodyToString%2A>, um zu überschreiben, wie der Nachrichtentext während des Debuggens dargestellt wird.</span><span class="sxs-lookup"><span data-stu-id="e7f12-315">Override <xref:System.ServiceModel.Channels.Message.OnBodyToString%2A> to override how your message body is represented during debugging.</span></span> <span data-ttu-id="e7f12-316">Der Standard ist die Darstellung als drei Punkte ("…").</span><span class="sxs-lookup"><span data-stu-id="e7f12-316">The default is to represent it as three dots ("…").</span></span> <span data-ttu-id="e7f12-317">Diese Methode kann mehrfach ausgerufen werden, wenn der Nachrichtenzustand nicht "Geschlossen" lautet.</span><span class="sxs-lookup"><span data-stu-id="e7f12-317">Note that this method can be called multiple times when the message state is anything other than Closed.</span></span> <span data-ttu-id="e7f12-318">Eine Implementierung dieser Methode sollte nie eine Aktion verursachen, die nur einmal ausgeführt werden muss (wie das Lesen eines Vorwärtsstreams).</span><span class="sxs-lookup"><span data-stu-id="e7f12-318">An implementation of this method should never cause any action that must be performed only once (such as reading from a forward-only stream).</span></span>  
  
 <span data-ttu-id="e7f12-319">Überschreiben Sie die <xref:System.ServiceModel.Channels.Message.OnGetBodyAttribute%2A>-Methode, um den Zugriff auf Attribute im SOAP-Textelement zuzulassen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-319">Override the <xref:System.ServiceModel.Channels.Message.OnGetBodyAttribute%2A> method to allow access to attributes on the SOAP body element.</span></span> <span data-ttu-id="e7f12-320">Diese Methode kann beliebig oft aufgerufen werden, der `Message`-Basistyp stellt jedoch sicher, dass sie nur dann aufgerufen wird, wenn der Zustand der Nachricht "Erstellt" lautet.</span><span class="sxs-lookup"><span data-stu-id="e7f12-320">This method can be called any number of times, but the `Message` base type guarantees that it is only called when the message is in the Created state.</span></span> <span data-ttu-id="e7f12-321">Es ist nicht erforderlich, den Zustand in einer Implementierung zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="e7f12-321">It is not required to check the state in an implementation.</span></span> <span data-ttu-id="e7f12-322">Die Standardimplementierung gibt immer `null` zurück, was bedeutet, dass im Textelement keine Attribute vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="e7f12-322">The default implementation always returns `null`, which indicates that there are no attributes on the body element.</span></span>  
  
 <span data-ttu-id="e7f12-323">Soll das `Message`-Objekt eine spezielle Bereinigung ausführen, wenn der Nachrichtentext nicht mehr benötigt wird, können Sie <xref:System.ServiceModel.Channels.Message.OnClose%2A> überschreiben.</span><span class="sxs-lookup"><span data-stu-id="e7f12-323">If your `Message` object must do any special cleanup when the message body is no longer required, you can override <xref:System.ServiceModel.Channels.Message.OnClose%2A>.</span></span> <span data-ttu-id="e7f12-324">Bei der Standardimplementierung wird keine Aktion ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="e7f12-324">The default implementation does nothing.</span></span>  
  
 <span data-ttu-id="e7f12-325">Die `IsEmpty`-Eigenschaft und die `IsFault`-Eigenschaft können überschrieben werden.</span><span class="sxs-lookup"><span data-stu-id="e7f12-325">The `IsEmpty` and `IsFault` properties can be overridden.</span></span> <span data-ttu-id="e7f12-326">Standardmäßig geben beide `false` zurück.</span><span class="sxs-lookup"><span data-stu-id="e7f12-326">By default, both return `false`.</span></span>
