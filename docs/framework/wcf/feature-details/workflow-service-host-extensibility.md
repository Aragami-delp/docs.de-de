---
title: Erweiterbarkeit des Workflowdiensthosts
ms.date: 03/30/2017
ms.assetid: c0e8f7bb-cb13-49ec-852f-b85d7c23972f
ms.openlocfilehash: eb35b9211bc55ee66f5bb5600ef86f40d4145191
ms.sourcegitcommit: 927b7ea6b2ea5a440c8f23e3e66503152eb85591
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/16/2020
ms.locfileid: "81464006"
---
# <a name="workflow-service-host-extensibility"></a><span data-ttu-id="689ff-102">Erweiterbarkeit des Workflowdiensthosts</span><span class="sxs-lookup"><span data-stu-id="689ff-102">Workflow Service Host Extensibility</span></span>
[!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] <span data-ttu-id="689ff-103">stellt die <xref:System.ServiceModel.Activities.WorkflowServiceHost>-Klasse zum Hosten von Workflowdiensten bereit.</span><span class="sxs-lookup"><span data-stu-id="689ff-103">provides the <xref:System.ServiceModel.Activities.WorkflowServiceHost> class for hosting workflow services.</span></span> <span data-ttu-id="689ff-104">Diese Klasse wird verwendet, wenn Sie einen Workflowdienst in einer verwalteten Anwendung oder einem Windows-Dienst selbst hosten.</span><span class="sxs-lookup"><span data-stu-id="689ff-104">This class is used when you are self-hosting a workflow service in a managed application or a Windows service.</span></span> <span data-ttu-id="689ff-105">Diese Klasse wird auch verwendet, wenn Sie einen Workflow unter Internetinformationsdienste (IIS) oder dem Windows-Prozessaktivierungsdienst (WAS) hosten.</span><span class="sxs-lookup"><span data-stu-id="689ff-105">This class is also used when hosting a workflow service with Internet Information Services (IIS) or Windows Process Activation Service (WAS).</span></span> <span data-ttu-id="689ff-106">Die <xref:System.ServiceModel.Activities.WorkflowServiceHost>-Klasse stellt Erweiterungspunkte bereit, mit denen Sie benutzerdefinierte Erweiterungen hinzufügen, das Leerlaufverhalten ändern und andere Workflows als Dienstworkflows (die keine Messagingaktivitäten nutzen) hosten können.</span><span class="sxs-lookup"><span data-stu-id="689ff-106">The <xref:System.ServiceModel.Activities.WorkflowServiceHost> class provides extension points that allow you to add custom extensions, change the idle behavior, and host non-service workflows (workflows that do not use messaging activities).</span></span>  
  
## <a name="workflow-service-host-extensions"></a><span data-ttu-id="689ff-107">Erweiterungen des Workflowdiensthosts</span><span class="sxs-lookup"><span data-stu-id="689ff-107">Workflow Service Host Extensions</span></span>  
 <span data-ttu-id="689ff-108"><xref:System.ServiceModel.Activities.WorkflowServiceHost> enthält eine <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A>-Eigenschaft vom Typ <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager>, der Methoden zum Hinzufügen von Erweiterungen zu <xref:System.ServiceModel.Activities.WorkflowServiceHost> bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="689ff-108">The <xref:System.ServiceModel.Activities.WorkflowServiceHost> contains a <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> property of type <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager> that provides methods to add extensions to the <xref:System.ServiceModel.Activities.WorkflowServiceHost>.</span></span> <span data-ttu-id="689ff-109">Verwenden Sie die <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A>-Methode zum Hinzufügen einer Erweiterung für jede Workflowdienstinstanz.</span><span class="sxs-lookup"><span data-stu-id="689ff-109">Use the <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> method to add an extension for each workflow service instance.</span></span> <span data-ttu-id="689ff-110">Der angegebene Delegat wird aufgerufen, um eine neue Erweiterung zu erstellen, wenn eine Workflowdienstinstanz erstellt oder aus einem Persistenzspeicher geladen wird.</span><span class="sxs-lookup"><span data-stu-id="689ff-110">The delegate specified is called to create a new extension when a workflow service instance is created or loaded from a persistence store.</span></span> <span data-ttu-id="689ff-111">Verwenden Sie die <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A>-Methode, um eine Erweiterung für jeden Workflowdiensthost hinzuzufügen. Eine Instanz der Erweiterung wird für alle Workflowdienstinstanzen genutzt.</span><span class="sxs-lookup"><span data-stu-id="689ff-111">Use the <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> method to add an extension for each workflow service host, one instance of the extension is shared for all workflow service instances.</span></span>  
  
## <a name="react-to-unhandled-exceptions"></a><span data-ttu-id="689ff-112">Reagieren auf unbehandelte Ausnahmen</span><span class="sxs-lookup"><span data-stu-id="689ff-112">React to Unhandled Exceptions</span></span>  
 <span data-ttu-id="689ff-113">Das Verhalten <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> ermöglicht das Angeben der Aktion, die ausgeführt werden soll, wenn innerhalb eines Workflowdiensts eine nicht behandelte Ausnahme auftritt.</span><span class="sxs-lookup"><span data-stu-id="689ff-113">The <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> enables you to specify the action to take if an unhandled exception occurs within a workflow service.</span></span> <span data-ttu-id="689ff-114">Die <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior.Action%2A>-Eigenschaft gibt einen der <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction>-Werte an.</span><span class="sxs-lookup"><span data-stu-id="689ff-114">The <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior.Action%2A> property specifies one of the <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction> values:</span></span>  
  
- <span data-ttu-id="689ff-115"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Abandon> – Bricht die Workflowdienstinstanz ab.</span><span class="sxs-lookup"><span data-stu-id="689ff-115"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Abandon> – Aborts the workflow service instance.</span></span>  
  
- <span data-ttu-id="689ff-116"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.AbandonAndSuspend> – Führt einen Rollback zum letzten beibehaltenen Zustand aus, und unterbricht die Ausführung der Workflowdienstinstanz.</span><span class="sxs-lookup"><span data-stu-id="689ff-116"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.AbandonAndSuspend> – Rolls back to the last persisted state and suspends the workflow service instance.</span></span> <span data-ttu-id="689ff-117">Dies ist nur der Fall, wenn der Workflow bereits mindestens einmal beibehalten wurde.</span><span class="sxs-lookup"><span data-stu-id="689ff-117">This only occurs if the workflow has already been persisted at least once.</span></span> <span data-ttu-id="689ff-118">Falls nicht, wird die Workflowinstanz abgebrochen.</span><span class="sxs-lookup"><span data-stu-id="689ff-118">If not the workflow instance is aborted.</span></span>  
  
- <span data-ttu-id="689ff-119"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel> – Bricht die Instanz ab.</span><span class="sxs-lookup"><span data-stu-id="689ff-119"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel> – Cancels the instance.</span></span>  
  
- <span data-ttu-id="689ff-120"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Terminate> – Beendet die Instanz.</span><span class="sxs-lookup"><span data-stu-id="689ff-120"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Terminate> – Terminates the instance.</span></span>  
  
 <span data-ttu-id="689ff-121">Dieses Verhalten kann im Code konfiguriert werden, wie im folgenden Beispiel gezeigt.</span><span class="sxs-lookup"><span data-stu-id="689ff-121">This behavior can be configured in code as shown in the following example.</span></span>  
  
```csharp  
host.Description.Behaviors.Add(new WorkflowUnhandledExceptionBehavior { Action = WorkflowUnhandledExceptionAction.Abandon });  
```  
  
 <span data-ttu-id="689ff-122">Es kann jedoch auch in einer Konfigurationsdatei konfiguriert werden, wie im folgenden Beispiel gezeigt.</span><span class="sxs-lookup"><span data-stu-id="689ff-122">It can also be configured in a configuration file as shown in the following example.</span></span>  
  
```xml
<behaviors>  
      <serviceBehaviors>  
        <behavior>  
          <serviceMetadata httpGetEnabled="True"/>  
          <serviceDebug includeExceptionDetailInFaults="False" />  
          <workflowUnhandledExceptionBehavior action="Abandon" />
        </behavior>  
      </serviceBehaviors>  
</behaviors>
```  
  
## <a name="hosting-non-service-workflows"></a><span data-ttu-id="689ff-123">Hosten von anderen Workflows als Dienstworkflows</span><span class="sxs-lookup"><span data-stu-id="689ff-123">Hosting Non-Service Workflows</span></span>  
 <span data-ttu-id="689ff-124">Mithilfe von <xref:System.ServiceModel.Activities.WorkflowServiceHost> können andere Workflows als Dienstworkflows gehostet werden. Außerdem können Workflows gehostet werden, die entweder nicht mit einer <xref:System.ServiceModel.Activities.Receive>-Aktivität beginnen oder die keine Messagingaktivitäten verwenden.</span><span class="sxs-lookup"><span data-stu-id="689ff-124"><xref:System.ServiceModel.Activities.WorkflowServiceHost> can be used to host non-service workflows, or workflows that either do not begin with a <xref:System.ServiceModel.Activities.Receive> activity or workflows that do not use the messaging activities.</span></span> <span data-ttu-id="689ff-125">Workflowdienste beginnen normalerweise mit einer <xref:System.ServiceModel.Activities.Receive>-Aktivität.</span><span class="sxs-lookup"><span data-stu-id="689ff-125">Workflow services normally begin with a <xref:System.ServiceModel.Activities.Receive> activity.</span></span> <span data-ttu-id="689ff-126">Wenn der <xref:System.ServiceModel.Activities.WorkflowServiceHost> eine Nachricht für einen Workflowdienst empfängt, wird eine neue Workflowdienstinstanz erstellt, falls diese nicht bereits ausgeführt wird (oder beibehalten wurde).</span><span class="sxs-lookup"><span data-stu-id="689ff-126">When the <xref:System.ServiceModel.Activities.WorkflowServiceHost> receives a message for a workflow service, if it is not already running (or persisted) a new workflow service instance is created.</span></span> <span data-ttu-id="689ff-127">Falls ein Workflow nicht mit einer Empfangsaktivität beginnt, kann er nicht mit dem Senden einer Nachricht gestartet werden, da keine Aktivität zum Empfangen der Nachricht vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="689ff-127">If a workflow does not begin with a Receive activity, it cannot be started by sending a message because there is no activity to receive the message.</span></span> <span data-ttu-id="689ff-128">Um einen anderen Workflow als einen Dienstworkflow zu hosten, leiten Sie eine Klasse von <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> ab und überschreiben <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A>, <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A> und <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A>.</span><span class="sxs-lookup"><span data-stu-id="689ff-128">To host a non-service workflow, derive a class from <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> and override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A>, <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A>, and <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A>.</span></span> <span data-ttu-id="689ff-129">Überschreiben Sie <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A>, wenn Sie eine bevorzugte Instanz-ID bereitstellen möchten.</span><span class="sxs-lookup"><span data-stu-id="689ff-129">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A> if you want to provide a preferred instance ID.</span></span> <span data-ttu-id="689ff-130">Überschreiben Sie <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A>, um einen benutzerdefinierten Workflowerstellungskontext zu erstellen oder eine Instanz des vorhandenen <xref:System.ServiceModel.Activities.WorkflowCreationContext>-Objekts aufzufüllen.</span><span class="sxs-lookup"><span data-stu-id="689ff-130">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A> to create a custom workflow creation context or populate an instance of the existing <xref:System.ServiceModel.Activities.WorkflowCreationContext>.</span></span> <span data-ttu-id="689ff-131">Überschreiben Sie <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A>, um das Lesezeichen manuell aus der eingehenden Nachricht zu extrahieren.</span><span class="sxs-lookup"><span data-stu-id="689ff-131">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A> to manually extract the bookmark from the incoming message.</span></span> <span data-ttu-id="689ff-132">Wenn Sie diese Methode überschreiben, müssen Sie in ihrem Text <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> aufrufen, um auf die an den WorkflowHostingEndpoint gesendete Nachricht zu antworten.</span><span class="sxs-lookup"><span data-stu-id="689ff-132">If you override this method, you must invoke <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> in its body so as to respond to the message sent to the WorkflowHostingEndpoint.</span></span> <span data-ttu-id="689ff-133">Andernfalls wird möglicherweise der <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A>-Grenzwert schließlich überschritten.</span><span class="sxs-lookup"><span data-stu-id="689ff-133">If you do not do so, a <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> limit may be eventually exceeded.</span></span> <span data-ttu-id="689ff-134">In bidirektionalen Verträgen können Sie eventuell feststellen, dass der Aufruf von <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> fehlschlägt, weil der Client keine Antwort empfangen kann.</span><span class="sxs-lookup"><span data-stu-id="689ff-134">In two-way contracts, you may be able to detect your   failure to invoke <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> because of the client’s failure to receive a response.</span></span> <span data-ttu-id="689ff-135">Bei unidirektionalen Verträgen erkennen Sie eventuell erst, wenn es zu spät ist, d. h. nachdem die <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A>-Drosselungsgrenze überschritten wurde, dass <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> nicht aufgerufen werden kann.</span><span class="sxs-lookup"><span data-stu-id="689ff-135">In one-way contracts, you may not recognize the mistake of failing to call <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> until it’s too late, after the <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> throttle limit is exceeded.</span></span> <span data-ttu-id="689ff-136">Weitere Informationen finden Sie im [WorkflowHostingEndpoint-Resume-Lesezeichen](../../../../docs/framework/windows-workflow-foundation/samples/workflowhostingendpoint-resume-bookmark.md)Um eine neue Instanz eines Nicht-Dienstworkflows zu erstellen, deklarieren Sie einen Servicevertrag, der einen Vorgang definiert, der eine neue Instanz erstellt.</span><span class="sxs-lookup"><span data-stu-id="689ff-136">For more information, please see the [WorkflowHostingEndpoint Resume Bookmark](../../../../docs/framework/windows-workflow-foundation/samples/workflowhostingendpoint-resume-bookmark.md)To create a new instance of a non-service workflow, declare a service contract that defines an operation that creates a new instance.</span></span> <span data-ttu-id="689ff-137">Der Erstellungsvorgang sollte\<eine IDictionary-Zeichenfolge, ein Objekt> verwenden, um alle erforderlichen Workflowparameter zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="689ff-137">The creation operation should take an IDictionary\<string, object> to pass any required workflow parameters.</span></span> <span data-ttu-id="689ff-138">Dieser Vertrag wird implizit von der Klasse implementiert, die von <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> abgeleitet wurde.</span><span class="sxs-lookup"><span data-stu-id="689ff-138">This contract is implicitly implemented by the <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>-derived class.</span></span> <span data-ttu-id="689ff-139">Fügen Sie dem Host beim Hosten des Workflows eine Instanz der von <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> abgeleiteten Klasse hinzu, indem Sie <xref:System.ServiceModel.Activities.WorkflowServiceHost.AddServiceEndpoint%2A> aufrufen, und rufen Sie dann <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A> auf.</span><span class="sxs-lookup"><span data-stu-id="689ff-139">When hosting the workflow, add an instance of the <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>-derived class to the host by calling <xref:System.ServiceModel.Activities.WorkflowServiceHost.AddServiceEndpoint%2A> and call <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A>.</span></span> <span data-ttu-id="689ff-140">Um eine Instanz des Workflows zu erstellen, erstellen Sie für Ihren Dienstvertrag ein <xref:System.ServiceModel.ChannelFactory%601>-Objekt, und rufen Sie anschließend <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A> auf.</span><span class="sxs-lookup"><span data-stu-id="689ff-140">To create an instance of the workflow, create a <xref:System.ServiceModel.ChannelFactory%601> of your service contract type and call <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A>.</span></span> <span data-ttu-id="689ff-141">Sie können dann den im Dienstvertrag definierten Erstellungsvorgang aufrufen.</span><span class="sxs-lookup"><span data-stu-id="689ff-141">You can then call the create operation defined in your service contract.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="689ff-142">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="689ff-142">See also</span></span>

- [<span data-ttu-id="689ff-143">Workflowdienste</span><span class="sxs-lookup"><span data-stu-id="689ff-143">Workflow Services</span></span>](../../../../docs/framework/wcf/feature-details/workflow-services.md)
- [<span data-ttu-id="689ff-144">Messagingaktivitäten</span><span class="sxs-lookup"><span data-stu-id="689ff-144">Messaging Activities</span></span>](../../../../docs/framework/wcf/feature-details/messaging-activities.md)
