---
title: Senden und Empfangen von Fehlern
description: Erfahren Sie, wie ein Dienst-oder Duplex Client SOAP-Fehler senden kann, wenn ein Fehlerzustand auftritt und wie eine Client-oder Dienst Anwendung diese Fehler verarbeitet.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- handling faults [WCF], sending
ms.assetid: 7be6fb96-ce2a-450b-aebe-f932c6a4bc5d
ms.openlocfilehash: 23f63fde2755a29cd545d3aefe699cad8dbecb3b
ms.sourcegitcommit: 358a28048f36a8dca39a9fe6e6ac1f1913acadd5
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 06/23/2020
ms.locfileid: "85244321"
---
# <a name="sending-and-receiving-faults"></a><span data-ttu-id="06a1b-103">Senden und Empfangen von Fehlern</span><span class="sxs-lookup"><span data-stu-id="06a1b-103">Sending and Receiving Faults</span></span>

<span data-ttu-id="06a1b-104">SOAP-Fehler vermitteln Informationen über Fehlerbedingungen von einem Dienst an einen Client und bei Duplexkommunikation von einem Client an einen Dienst in einem interoperablen Verfahren.</span><span class="sxs-lookup"><span data-stu-id="06a1b-104">SOAP faults convey error condition information from a service to a client and in the duplex case from a client to a service in an interoperable way.</span></span> <span data-ttu-id="06a1b-105">In der Regel definiert ein Dienst benutzerdefinierten Fehlerinhalt und legt fest, welche Vorgänge ihn zurückgeben können.</span><span class="sxs-lookup"><span data-stu-id="06a1b-105">Typically a service defines custom fault content and specifies which operations can return them.</span></span> <span data-ttu-id="06a1b-106">(Weitere Informationen finden Sie unter [definieren und Angeben von Fehlern](defining-and-specifying-faults.md).) In diesem Thema wird erläutert, wie ein Dienst oder ein Duplex Client diese Fehler senden kann, wenn die entsprechende Fehlerbedingung aufgetreten ist und wie eine Client-oder Dienst Anwendung diese Fehler verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="06a1b-106">(For more information, see [Defining and Specifying Faults](defining-and-specifying-faults.md).) This topic discusses how a service or duplex client can send those faults when the corresponding error condition has occurred and how a client or service application handles these faults.</span></span> <span data-ttu-id="06a1b-107">Eine Übersicht über die Fehlerbehandlung in Windows Communication Foundation (WCF)-Anwendungen finden Sie unter [angeben und behandeln von Fehlern in Verträgen und Diensten](specifying-and-handling-faults-in-contracts-and-services.md).</span><span class="sxs-lookup"><span data-stu-id="06a1b-107">For an overview of error handling in Windows Communication Foundation (WCF) applications, see [Specifying and Handling Faults in Contracts and Services](specifying-and-handling-faults-in-contracts-and-services.md).</span></span>

## <a name="sending-soap-faults"></a><span data-ttu-id="06a1b-108">Senden von SOAP-Fehlern</span><span class="sxs-lookup"><span data-stu-id="06a1b-108">Sending SOAP Faults</span></span>

<span data-ttu-id="06a1b-109">Bei deklarierten SOAP-Fehlern verfügt ein Vorgang über ein <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType>, das einen benutzerdefinierten SOAP-Fehlertyp angibt.</span><span class="sxs-lookup"><span data-stu-id="06a1b-109">Declared SOAP faults are those in which an operation has a <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> that specifies a custom SOAP fault type.</span></span> <span data-ttu-id="06a1b-110">Nicht deklarierte SOAP-Fehler sind Fehler, die nicht im Vertrag eines Vorgangs festgelegt sind.</span><span class="sxs-lookup"><span data-stu-id="06a1b-110">Undeclared SOAP faults are those that are not specified in the contract for an operation.</span></span>

### <a name="sending-declared-faults"></a><span data-ttu-id="06a1b-111">Senden von deklarierten Fehlern</span><span class="sxs-lookup"><span data-stu-id="06a1b-111">Sending Declared Faults</span></span>

<span data-ttu-id="06a1b-112">Um einen deklarierten SOAP-Fehler zu senden, erkennen Sie die Fehlerbedingung, zu der der SOAP-Fehler passt, und lösen Sie eine neue <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> aus, bei der der Typparameter ein neues Objekt des Typs ist, der im <xref:System.ServiceModel.FaultContractAttribute> für diesen Vorgang angegeben ist.</span><span class="sxs-lookup"><span data-stu-id="06a1b-112">To send a declared SOAP fault, detect the error condition for which the SOAP fault is appropriate and throw a new <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> where the type parameter is a new object of the type specified in the <xref:System.ServiceModel.FaultContractAttribute> for that operation.</span></span> <span data-ttu-id="06a1b-113">Im folgenden Codebeispiel wird veranschaulicht, wie mit dem <xref:System.ServiceModel.FaultContractAttribute> angegeben werden kann, dass der `SampleMethod`-Vorgang einen SOAP-Fehler mit dem Detailtyp `GreetingFault` zurückgeben kann.</span><span class="sxs-lookup"><span data-stu-id="06a1b-113">The following code example shows the use of <xref:System.ServiceModel.FaultContractAttribute> to specify that the `SampleMethod` operation can return a SOAP fault with the detail type of `GreetingFault`.</span></span>

[!code-csharp[FaultContractAttribute#4](../../../samples/snippets/csharp/VS_Snippets_CFX/faultcontractattribute/cs/services.cs#4)]
[!code-vb[FaultContractAttribute#4](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faultcontractattribute/vb/services.vb#4)]

<span data-ttu-id="06a1b-114">Um die `GreetingFault`-Fehlerinformation an den Client zu übermitteln, fangen Sie die entsprechende Fehlerbedingung ab, und lösen Sie eine <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> vom Typ `GreetingFault` mit einem neuen `GreetingFault`-Objekt als Argument aus, wie im folgenden Codebeispiel dargestellt.</span><span class="sxs-lookup"><span data-stu-id="06a1b-114">To convey the `GreetingFault` error information to the client, catch the appropriate error condition and throw a new <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> of type `GreetingFault` with a new `GreetingFault` object as the argument, as in the following code example.</span></span> <span data-ttu-id="06a1b-115">Wenn es sich bei dem Client um eine WCF-Client Anwendung handelt, wird dies als verwaltete Ausnahme angezeigt, bei der der Typ <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> vom Typ ist `GreetingFault` .</span><span class="sxs-lookup"><span data-stu-id="06a1b-115">If the client is an WCF client application, it experiences this as a managed exception where the type is <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> of type `GreetingFault`.</span></span>

[!code-csharp[FaultContractAttribute#5](../../../samples/snippets/csharp/VS_Snippets_CFX/faultcontractattribute/cs/services.cs#5)]
[!code-vb[FaultContractAttribute#5](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faultcontractattribute/vb/services.vb#5)]

### <a name="sending-undeclared-faults"></a><span data-ttu-id="06a1b-116">Senden von undeklarierten Fehlern</span><span class="sxs-lookup"><span data-stu-id="06a1b-116">Sending Undeclared Faults</span></span>

<span data-ttu-id="06a1b-117">Das Senden von nicht deklarierten Fehlern kann sehr nützlich sein, um Probleme in WCF-Anwendungen schnell zu diagnostizieren und zu debuggen, aber seine Nützlichkeit als Debugtool ist eingeschränkt</span><span class="sxs-lookup"><span data-stu-id="06a1b-117">Sending undeclared faults can be very useful to quickly diagnose and debug problems in WCF applications, but its usefulness as a debugging tool is limited.</span></span> <span data-ttu-id="06a1b-118">Allgemeiner gesagt, ist es empfehlenswert, beim Debuggen die <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType>-Eigenschaft zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="06a1b-118">More generally, when debugging it is recommended that you use the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="06a1b-119">Wenn Sie diesen Wert auf true festlegen, erfahren Clients solche Fehler als <xref:System.ServiceModel.FaultException%601>-Ausnahmen des Typs <xref:System.ServiceModel.ExceptionDetail>.</span><span class="sxs-lookup"><span data-stu-id="06a1b-119">When you set this value to true, clients experience such faults as <xref:System.ServiceModel.FaultException%601> exceptions of type <xref:System.ServiceModel.ExceptionDetail>.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="06a1b-120">Da verwaltete Ausnahmen interne Anwendungsinformationen verfügbar machen können, <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> kann das Festlegen <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> von oder auf das `true` Abrufen von Informationen über interne Dienst Vorgangs Ausnahmen, einschließlich personenbezogener oder anderer sensibler Informationen, ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="06a1b-120">Because managed exceptions can expose internal application information, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` can permit WCF clients to obtain information about internal service operation exceptions, including personally identifiable or other sensitive information.</span></span>
>
> <span data-ttu-id="06a1b-121">Daher wird die Festlegung von <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> für <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> oder `true` nur für das vorübergehende Debuggen einer Dienstanwendung empfohlen.</span><span class="sxs-lookup"><span data-stu-id="06a1b-121">Therefore, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` is only recommended as a way of temporarily debugging a service application.</span></span> <span data-ttu-id="06a1b-122">Außerdem beinhaltet die WSDL für eine Methode, die nicht behandelte verwaltete Ausnahmen auf diese Weise zurückgibt, keinen Vertrag für die <xref:System.ServiceModel.FaultException%601> vom Typ <xref:System.ServiceModel.ExceptionDetail>.</span><span class="sxs-lookup"><span data-stu-id="06a1b-122">In addition, the WSDL for a method that returns unhandled managed exceptions in this way does not contain the contract for the <xref:System.ServiceModel.FaultException%601> of type <xref:System.ServiceModel.ExceptionDetail>.</span></span> <span data-ttu-id="06a1b-123">Clients müssen die Möglichkeit eines unbekannten SOAP-Fehlers erwarten (zurückgegeben an WCF-Clients als <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> Objekte), um die Debuginformationen ordnungsgemäß abzurufen.</span><span class="sxs-lookup"><span data-stu-id="06a1b-123">Clients must expect the possibility of an unknown SOAP fault (returned to WCF clients as <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> objects) to obtain the debugging information properly.</span></span>

<span data-ttu-id="06a1b-124">Um einen undeklarierten SOAP-Fehler zu senden, lösen Sie ein <xref:System.ServiceModel.FaultException?displayProperty=nameWithType>-Objekt aus (d. h. nicht den generischen Typ <xref:System.ServiceModel.FaultException%601>), und übergeben Sie die Zeichenfolge dem Konstruktor.</span><span class="sxs-lookup"><span data-stu-id="06a1b-124">To send an undeclared SOAP fault, throw a <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> object (that is, not the generic type <xref:System.ServiceModel.FaultException%601>) and pass the string to the constructor.</span></span> <span data-ttu-id="06a1b-125">Diese wird für die WCF-Client Anwendungen als Ausnahme ausgelöst, <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> Wenn die Zeichenfolge durch Aufrufen der- <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType> Methode verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="06a1b-125">This is exposed to the WCF client applications as a thrown <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> exception where the string is available by calling the <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType> method.</span></span>

> [!NOTE]
> <span data-ttu-id="06a1b-126">Wenn Sie einen SOAP-Fehler vom Typ Zeichenfolge deklarieren und dies dann in Ihrem Service als <xref:System.ServiceModel.FaultException%601> auslösen, wobei der Typparameter eine <xref:System.String?displayProperty=nameWithType> ist, wird der Zeichenfolgenwert der <xref:System.ServiceModel.FaultException%601.Detail%2A?displayProperty=nameWithType>-Eigenschaft zugewiesen und ist nicht über <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType> verfügbar.</span><span class="sxs-lookup"><span data-stu-id="06a1b-126">If you declare a SOAP fault of type string, and then throw this in your service as a <xref:System.ServiceModel.FaultException%601> where the type parameter is a <xref:System.String?displayProperty=nameWithType> the string value is assigned to the <xref:System.ServiceModel.FaultException%601.Detail%2A?displayProperty=nameWithType> property, and is not available from <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType>.</span></span>

## <a name="handling-faults"></a><span data-ttu-id="06a1b-127">Behandeln von Fehlern</span><span class="sxs-lookup"><span data-stu-id="06a1b-127">Handling Faults</span></span>

<span data-ttu-id="06a1b-128">In WCF-Clients werden SOAP-Fehler, die während der Kommunikation auftreten, die für Client Anwendungen von Interesse sind, als verwaltete Ausnahmen ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="06a1b-128">In WCF clients, SOAP faults that occur during communication that are of interest to client applications are raised as managed exceptions.</span></span> <span data-ttu-id="06a1b-129">Es gibt zwar viele Ausnahmen, die während der Ausführung eines beliebigen Programms auftreten können, Anwendungen, die das WCF-Client Programmiermodell verwenden, können jedoch erwarten, dass Ausnahmen der folgenden beiden Typen als Ergebnis der Kommunikation behandelt werden.</span><span class="sxs-lookup"><span data-stu-id="06a1b-129">While there are many exceptions that can occur during the execution of any program, applications using the WCF client programming model can expect to handle exceptions of the following two types as a result of communication.</span></span>

- <xref:System.TimeoutException>

- <xref:System.ServiceModel.CommunicationException>

<span data-ttu-id="06a1b-130"><xref:System.TimeoutException>-Objekte werden ausgelöst, wenn ein Vorgang das angegebene Zeitlimit überschreitet.</span><span class="sxs-lookup"><span data-stu-id="06a1b-130"><xref:System.TimeoutException> objects are thrown when an operation exceeds the specified timeout period.</span></span>

<span data-ttu-id="06a1b-131"><xref:System.ServiceModel.CommunicationException>-Objekte werden ausgelöst, wenn entweder beim Dienst oder beim Client eine behebbare Kommunikationsfehlerbedingung besteht.</span><span class="sxs-lookup"><span data-stu-id="06a1b-131"><xref:System.ServiceModel.CommunicationException> objects are thrown when there is some recoverable communication error condition on either the service or the client.</span></span>

<span data-ttu-id="06a1b-132">Die <xref:System.ServiceModel.CommunicationException>-Klasse verfügt über zwei wichtige abgeleitete Typen: <xref:System.ServiceModel.FaultException> und den generischen <xref:System.ServiceModel.FaultException%601>-Typ.</span><span class="sxs-lookup"><span data-stu-id="06a1b-132">The <xref:System.ServiceModel.CommunicationException> class has two important derived types, <xref:System.ServiceModel.FaultException> and the generic <xref:System.ServiceModel.FaultException%601> type.</span></span>

<span data-ttu-id="06a1b-133"><xref:System.ServiceModel.FaultException>-Ausnahmen werden ausgelöst, wenn ein Listener einen Fehler empfängt, der in dem Vorgangsvertrag nicht erwartet oder festgelegt ist; dies geschieht normalerweise, wenn die Anwendung gedebuggt wird und die <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType>-Eigenschaft des Diensts auf `true` festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="06a1b-133"><xref:System.ServiceModel.FaultException> exceptions are thrown when a listener receives a fault that is not expected or specified in the operation contract; usually this occurs when the application is being debugged and the service has the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property set to `true`.</span></span>

<span data-ttu-id="06a1b-134">Am Client werden <xref:System.ServiceModel.FaultException%601>-Ausnahmen ausgelöst, wenn ein im Vorgangsvertrag angegebener Fehler als Antwort auf einen bidirektionalen Vorgang empfangen wird (d. h. eine Methode mit einem <xref:System.ServiceModel.OperationContractAttribute>-Attribut, bei dem <xref:System.ServiceModel.OperationContractAttribute.IsOneWay%2A> auf `false` festgelegt ist).</span><span class="sxs-lookup"><span data-stu-id="06a1b-134"><xref:System.ServiceModel.FaultException%601> exceptions are thrown on the client when a fault that is specified in the operation contract is received in response to a two-way operation (that is, a method with an <xref:System.ServiceModel.OperationContractAttribute> attribute with <xref:System.ServiceModel.OperationContractAttribute.IsOneWay%2A> set to `false`).</span></span>

> [!NOTE]
> <span data-ttu-id="06a1b-135">Wenn für einen WCF-Dienst die- <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> Eigenschaft oder die- <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> Eigenschaft auf festgelegt ist, hat `true` der Client diese als nicht deklarierten <xref:System.ServiceModel.FaultException%601> Typ <xref:System.ServiceModel.ExceptionDetail> .</span><span class="sxs-lookup"><span data-stu-id="06a1b-135">When an WCF service has the <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property set to `true` the client experiences this as an undeclared <xref:System.ServiceModel.FaultException%601> of type <xref:System.ServiceModel.ExceptionDetail>.</span></span> <span data-ttu-id="06a1b-136">Clients können diesen bestimmten Fehler entweder abfangen oder den Fehler in einem Catch-Block für <xref:System.ServiceModel.FaultException> behandeln.</span><span class="sxs-lookup"><span data-stu-id="06a1b-136">Clients can either catch this specific fault or handle the fault in a catch block for <xref:System.ServiceModel.FaultException>.</span></span>

<span data-ttu-id="06a1b-137">In der Regel sind nur <xref:System.ServiceModel.FaultException%601>-, <xref:System.TimeoutException>- und <xref:System.ServiceModel.CommunicationException>-Ausnahmen für Clients und Dienste relevant.</span><span class="sxs-lookup"><span data-stu-id="06a1b-137">Typically, only <xref:System.ServiceModel.FaultException%601>, <xref:System.TimeoutException>, and <xref:System.ServiceModel.CommunicationException> exceptions are of interest to clients and services.</span></span>

> [!NOTE]
> <span data-ttu-id="06a1b-138">Es treten natürlich andere Ausnahmen auf.</span><span class="sxs-lookup"><span data-stu-id="06a1b-138">Other exceptions, of course, do occur.</span></span> <span data-ttu-id="06a1b-139">Unerwartete Ausnahmen schließen schwerwiegende Fehler wie <xref:System.OutOfMemoryException?displayProperty=nameWithType> ein; in der Regel sollten Anwendungen solche Methoden nicht abfangen.</span><span class="sxs-lookup"><span data-stu-id="06a1b-139">Unexpected exceptions include catastrophic failures like <xref:System.OutOfMemoryException?displayProperty=nameWithType>; typically applications should not catch such methods.</span></span>

### <a name="catch-fault-exceptions-in-the-correct-order"></a><span data-ttu-id="06a1b-140">Abfangen von Fehlerausnahmen in der richtigen Reihenfolge</span><span class="sxs-lookup"><span data-stu-id="06a1b-140">Catch Fault Exceptions in the Correct Order</span></span>

<span data-ttu-id="06a1b-141">Da <xref:System.ServiceModel.FaultException%601> von <xref:System.ServiceModel.FaultException> abgeleitet wird und <xref:System.ServiceModel.FaultException> von <xref:System.ServiceModel.CommunicationException> abgeleitet wird, müssen diese Ausnahmen in der richtigen Reihenfolge abgefangen werden.</span><span class="sxs-lookup"><span data-stu-id="06a1b-141">Because <xref:System.ServiceModel.FaultException%601> derives from <xref:System.ServiceModel.FaultException>, and <xref:System.ServiceModel.FaultException> derives from <xref:System.ServiceModel.CommunicationException>, it is important to catch these exceptions in the proper order.</span></span> <span data-ttu-id="06a1b-142">Bei einem try/catch-Block, bei dem zuerst <xref:System.ServiceModel.CommunicationException> abgefangen wird, werden z. B. alle angegebenen und nicht angegebenen SOAP-Fehler dort behandelt; nachfolgende catch-Blöcke zum Behandeln einer benutzerdefinierten <xref:System.ServiceModel.FaultException%601>-Ausnahme werden niemals aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="06a1b-142">If, for example, you have a try/catch block in which you first catch <xref:System.ServiceModel.CommunicationException>, all specified and unspecified SOAP faults are handled there; any subsequent catch blocks to handle a custom <xref:System.ServiceModel.FaultException%601> exception are never invoked.</span></span>

<span data-ttu-id="06a1b-143">Vergessen Sie nicht, dass ein Vorgang eine beliebige Anzahl angegebener Fehler zurückgeben kann.</span><span class="sxs-lookup"><span data-stu-id="06a1b-143">Remember that one operation can return any number of specified faults.</span></span> <span data-ttu-id="06a1b-144">Jeder Fehler ist ein eindeutiger Typ und muss getrennt behandelt werden.</span><span class="sxs-lookup"><span data-stu-id="06a1b-144">Each fault is a unique type and must be handled separately.</span></span>

### <a name="handle-exceptions-when-closing-the-channel"></a><span data-ttu-id="06a1b-145">Behandeln von Ausnahmen beim Schließen des Kanals</span><span class="sxs-lookup"><span data-stu-id="06a1b-145">Handle Exceptions When Closing the Channel</span></span>

<span data-ttu-id="06a1b-146">Der größte Teil der vorherigen Erörterung ist mit Fehlern zu tun, die im Verlauf der Verarbeitung von Anwendungs Nachrichten gesendet werden, d. h. Nachrichten, die vom Client explizit gesendet werden, wenn die Client Anwendung Vorgänge für das WCF-Client Objekt aufruft.</span><span class="sxs-lookup"><span data-stu-id="06a1b-146">Most of the preceding discussion has to do with faults sent in the course of processing application messages, that is, messages explicitly sent by the client when the client application calls operations on the WCF client object.</span></span>

<span data-ttu-id="06a1b-147">Sogar lokale Objekte, die das Objekt verwerfen, können Ausnahmen, die während des Wiederverwendungsprozesses auftreten, entweder auslösen oder maskieren.</span><span class="sxs-lookup"><span data-stu-id="06a1b-147">Even with local objects disposing the object can either raise or mask exceptions that occur during the recycling process.</span></span> <span data-ttu-id="06a1b-148">Ein ähnliches Problem kann auftreten, wenn Sie WCF-Client Objekte verwenden.</span><span class="sxs-lookup"><span data-stu-id="06a1b-148">Something similar can occur when you use WCF client objects.</span></span> <span data-ttu-id="06a1b-149">Wenn Sie Vorgänge aufrufen, senden Sie Nachrichten über eine hergestellte Verbindung.</span><span class="sxs-lookup"><span data-stu-id="06a1b-149">When you call operations you are sending messages over an established connection.</span></span> <span data-ttu-id="06a1b-150">Das Schließen des Kanals kann Ausnahmen auslösen, wenn die Verbindung nicht ordnungsgemäß getrennt wird oder bereits getrennt ist, selbst wenn alle Vorgänge ordnungsgemäß zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="06a1b-150">Closing the channel can throw exceptions if the connection cannot be cleanly closed or is already closed, even if all the operations returned properly.</span></span>

<span data-ttu-id="06a1b-151">In der Regel werden Clientobjektkanäle auf eine der folgenden Möglichkeiten geschlossen:</span><span class="sxs-lookup"><span data-stu-id="06a1b-151">Typically, client object channels are closed in one of the following ways:</span></span>

- <span data-ttu-id="06a1b-152">Wenn das WCF-Client Objekt wieder verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="06a1b-152">When the WCF client object is recycled.</span></span>

- <span data-ttu-id="06a1b-153">Wenn die Clientanwendung <xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> aufruft.</span><span class="sxs-lookup"><span data-stu-id="06a1b-153">When the client application calls <xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType>.</span></span>

- <span data-ttu-id="06a1b-154">Wenn die Clientanwendung <xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> aufruft.</span><span class="sxs-lookup"><span data-stu-id="06a1b-154">When the client application calls <xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType>.</span></span>

- <span data-ttu-id="06a1b-155">Wenn die Clientanwendung einen Vorgang aufruft, bei dem es sich um einen Vorgang handelt, der eine Sitzung beendet.</span><span class="sxs-lookup"><span data-stu-id="06a1b-155">When the client application calls an operation that is a terminating operation for a session.</span></span>

<span data-ttu-id="06a1b-156">In jedem Fall weist das Schließen des Kanals den Kanal an zu beginnen, alle zugrunde liegenden Kanäle zu schließen, die möglicherweise Nachrichten senden, um eine komplexe Funktionalität auf Anwendungsebene zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="06a1b-156">In all cases, closing the channel instructs the channel to begin closing any underlying channels that may be sending messages to support complex functionality at the application level.</span></span> <span data-ttu-id="06a1b-157">Wenn z. B. ein Vertrag Sitzungen erfordert, versucht eine Bindung eine Sitzung einzurichten, indem Nachrichten mit dem Dienstkanal ausgetauscht werden, bis eine Sitzung eingerichtet ist.</span><span class="sxs-lookup"><span data-stu-id="06a1b-157">For example, when a contract requires sessions a binding attempts to establish a session by exchanging messages with the service channel until a session is established.</span></span> <span data-ttu-id="06a1b-158">Wenn der Kanal geschlossen wird, benachrichtigt der zugrunde liegende Sitzungskanal den Dienst, dass die Sitzung beendet wird.</span><span class="sxs-lookup"><span data-stu-id="06a1b-158">When the channel is closed, the underlying session channel notifies the service that the session is terminated.</span></span> <span data-ttu-id="06a1b-159">Wenn der Kanal bereits abgebrochen oder geschlossen ist oder aus anderen Gründen nicht verwendet werden kann (z. B. wenn ein Netzwerkkabel abgezogen wird), kann der Clientkanal dem Dienstkanal in diesem Fall nicht mitteilen, dass die Sitzung beendet wird, und dies kann zu einer Ausnahme führen.</span><span class="sxs-lookup"><span data-stu-id="06a1b-159">In this case, if the channel has already aborted, closed, or is otherwise unusable (for example, when a network cable is unplugged), the client channel cannot inform the service channel that the session is terminated and an exception can result.</span></span>

### <a name="abort-the-channel-if-necessary"></a><span data-ttu-id="06a1b-160">Abbrechen des Kanals (falls erforderlich)</span><span class="sxs-lookup"><span data-stu-id="06a1b-160">Abort the Channel If Necessary</span></span>

<span data-ttu-id="06a1b-161">Da das Schließen des Kanals auch Ausnahmen auslösen kann, wird empfohlen, den Kanal, der für den Aufruf in dem catch-Block verwendet wurde, zusätzlich zum Abfangen von Fehlerausnahmen in der richtigen Reihenfolge abzubrechen.</span><span class="sxs-lookup"><span data-stu-id="06a1b-161">Because closing the channel can also throw exceptions, then, it is recommended that in addition to catching fault exceptions in the correct order, it is important to abort the channel that was used in making the call in the catch block.</span></span>

<span data-ttu-id="06a1b-162">Wenn der Fehler Fehlerinformationen übermittelt, die für einen Vorgang spezifisch sind, und andere ihn möglicherweise verwenden können, muss der Kanal nicht abgebrochen werden (obwohl dies selten vorkommt).</span><span class="sxs-lookup"><span data-stu-id="06a1b-162">If the fault conveys error information specific to an operation and it remains possible that others can use it, there is no need to abort the channel (although these cases are rare).</span></span> <span data-ttu-id="06a1b-163">In allen anderen Fällen wird empfohlen, den Kanal abzubrechen.</span><span class="sxs-lookup"><span data-stu-id="06a1b-163">In all other cases, it is recommended that you abort the channel.</span></span> <span data-ttu-id="06a1b-164">Ein Beispiel, das alle diese Punkte veranschaulicht, finden Sie unter [erwartete Ausnahmen](./samples/expected-exceptions.md).</span><span class="sxs-lookup"><span data-stu-id="06a1b-164">For a sample that demonstrates all of these points, see [Expected Exceptions](./samples/expected-exceptions.md).</span></span>

<span data-ttu-id="06a1b-165">Das folgende Codebeispiel veranschaulicht die Behandlung von SOAP-Fehlerausnahmen in einer grundlegenden Clientanwendung einschließlich eines deklarierten Fehlers und eines undeklarierten Fehlers.</span><span class="sxs-lookup"><span data-stu-id="06a1b-165">The following code example shows how to handle SOAP fault exceptions in a basic client application, including a declared fault and an undeclared fault.</span></span>

> [!NOTE]
> <span data-ttu-id="06a1b-166">Dieser Beispielcode verwendet kein `using`-Konstrukt.</span><span class="sxs-lookup"><span data-stu-id="06a1b-166">This sample code does not use the `using` construct.</span></span> <span data-ttu-id="06a1b-167">Da durch die Schließung von Kanälen Ausnahmen ausgelöst werden können, wird empfohlen, dass Anwendungen zuerst einen WCF-Client erstellen und dann den WCF-Client im selben try-Block öffnen, verwenden und schließen.</span><span class="sxs-lookup"><span data-stu-id="06a1b-167">Because closing channels can throw exceptions, it is recommended that applications create a WCF client first, and then open, use, and close the WCF client in the same try block.</span></span> <span data-ttu-id="06a1b-168">Weitere Informationen finden Sie unter [Übersicht über den WCF-Client](wcf-client-overview.md) und Verwenden von [Schließen und Abbrechen zum Freigeben von WCF-Client Ressourcen](./samples/use-close-abort-release-wcf-client-resources.md).</span><span class="sxs-lookup"><span data-stu-id="06a1b-168">For details, see [WCF Client Overview](wcf-client-overview.md) and [Use Close and Abort to release WCF client resources](./samples/use-close-abort-release-wcf-client-resources.md).</span></span>

[!code-csharp[FaultContractAttribute#3](../../../samples/snippets/csharp/VS_Snippets_CFX/faultcontractattribute/cs/client.cs#3)]
[!code-vb[FaultContractAttribute#3](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faultcontractattribute/vb/client.vb#3)]

## <a name="see-also"></a><span data-ttu-id="06a1b-169">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="06a1b-169">See also</span></span>

- <xref:System.ServiceModel.FaultException>
- <xref:System.ServiceModel.FaultException%601>
- <xref:System.ServiceModel.CommunicationException?displayProperty=nameWithType>
- [<span data-ttu-id="06a1b-170">Erwartete Ausnahmen</span><span class="sxs-lookup"><span data-stu-id="06a1b-170">Expected Exceptions</span></span>](./samples/expected-exceptions.md)
- [<span data-ttu-id="06a1b-171">Freigeben von WCF-Clientressourcen mit „Close“ und „Abort“</span><span class="sxs-lookup"><span data-stu-id="06a1b-171">Use Close and Abort to release WCF client resources</span></span>](./samples/use-close-abort-release-wcf-client-resources.md)
